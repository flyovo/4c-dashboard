{"remainingRequest":"/Users/id-repair/Documents/SEOL/4c-dashboard/node_modules/babel-loader/lib/index.js!/Users/id-repair/Documents/SEOL/4c-dashboard/node_modules/echarts/lib/echarts.js","dependencies":[{"path":"/Users/id-repair/Documents/SEOL/4c-dashboard/node_modules/echarts/lib/echarts.js","mtime":499162500000},{"path":"/Users/id-repair/Documents/SEOL/4c-dashboard/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/id-repair/Documents/SEOL/4c-dashboard/node_modules/babel-loader/lib/index.js","mtime":315532800000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:cmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LmNvbmNhdC5qcyIpOwoKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLnJlZ2V4cC5leGVjLmpzIik7CgpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMuc3RyaW5nLnNwbGl0LmpzIik7CgpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkubWFwLmpzIik7CgpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMuc3RyaW5nLnN1Yi5qcyIpOwoKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LnNwbGljZS5qcyIpOwoKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LnNsaWNlLmpzIik7CgovKgoqIExpY2Vuc2VkIHRvIHRoZSBBcGFjaGUgU29mdHdhcmUgRm91bmRhdGlvbiAoQVNGKSB1bmRlciBvbmUKKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxpY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKKiBkaXN0cmlidXRlZCB3aXRoIHRoaXMgd29yayBmb3IgYWRkaXRpb25hbCBpbmZvcm1hdGlvbgoqIHJlZ2FyZGluZyBjb3B5cmlnaHQgb3duZXJzaGlwLiAgVGhlIEFTRiBsaWNlbnNlcyB0aGlzIGZpbGUKKiB0byB5b3UgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiogIkxpY2Vuc2UiKTsgeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZQoqIHdpdGggdGhlIExpY2Vuc2UuICBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQKKgoqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wCioKKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsCiogc29mdHdhcmUgZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4KKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKKiBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLiAgU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUKKiBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kIGxpbWl0YXRpb25zCiogdW5kZXIgdGhlIExpY2Vuc2UuCiovCnZhciBfY29uZmlnID0gcmVxdWlyZSgiLi9jb25maWciKTsKCnZhciBfX0RFVl9fID0gX2NvbmZpZy5fX0RFVl9fOwoKdmFyIHpyZW5kZXIgPSByZXF1aXJlKCJ6cmVuZGVyL2xpYi96cmVuZGVyIik7Cgp2YXIgenJVdGlsID0gcmVxdWlyZSgienJlbmRlci9saWIvY29yZS91dGlsIik7Cgp2YXIgY29sb3JUb29sID0gcmVxdWlyZSgienJlbmRlci9saWIvdG9vbC9jb2xvciIpOwoKdmFyIGVudiA9IHJlcXVpcmUoInpyZW5kZXIvbGliL2NvcmUvZW52Iik7Cgp2YXIgdGltc29ydCA9IHJlcXVpcmUoInpyZW5kZXIvbGliL2NvcmUvdGltc29ydCIpOwoKdmFyIEV2ZW50ZnVsID0gcmVxdWlyZSgienJlbmRlci9saWIvbWl4aW4vRXZlbnRmdWwiKTsKCnZhciBHbG9iYWxNb2RlbCA9IHJlcXVpcmUoIi4vbW9kZWwvR2xvYmFsIik7Cgp2YXIgRXh0ZW5zaW9uQVBJID0gcmVxdWlyZSgiLi9FeHRlbnNpb25BUEkiKTsKCnZhciBDb29yZGluYXRlU3lzdGVtTWFuYWdlciA9IHJlcXVpcmUoIi4vQ29vcmRpbmF0ZVN5c3RlbSIpOwoKdmFyIE9wdGlvbk1hbmFnZXIgPSByZXF1aXJlKCIuL21vZGVsL09wdGlvbk1hbmFnZXIiKTsKCnZhciBiYWNrd2FyZENvbXBhdCA9IHJlcXVpcmUoIi4vcHJlcHJvY2Vzc29yL2JhY2t3YXJkQ29tcGF0Iik7Cgp2YXIgZGF0YVN0YWNrID0gcmVxdWlyZSgiLi9wcm9jZXNzb3IvZGF0YVN0YWNrIik7Cgp2YXIgQ29tcG9uZW50TW9kZWwgPSByZXF1aXJlKCIuL21vZGVsL0NvbXBvbmVudCIpOwoKdmFyIFNlcmllc01vZGVsID0gcmVxdWlyZSgiLi9tb2RlbC9TZXJpZXMiKTsKCnZhciBDb21wb25lbnRWaWV3ID0gcmVxdWlyZSgiLi92aWV3L0NvbXBvbmVudCIpOwoKdmFyIENoYXJ0VmlldyA9IHJlcXVpcmUoIi4vdmlldy9DaGFydCIpOwoKdmFyIGdyYXBoaWMgPSByZXF1aXJlKCIuL3V0aWwvZ3JhcGhpYyIpOwoKdmFyIG1vZGVsVXRpbCA9IHJlcXVpcmUoIi4vdXRpbC9tb2RlbCIpOwoKdmFyIF90aHJvdHRsZSA9IHJlcXVpcmUoIi4vdXRpbC90aHJvdHRsZSIpOwoKdmFyIHRocm90dGxlID0gX3Rocm90dGxlLnRocm90dGxlOwoKdmFyIHNlcmllc0NvbG9yID0gcmVxdWlyZSgiLi92aXN1YWwvc2VyaWVzQ29sb3IiKTsKCnZhciBhcmlhID0gcmVxdWlyZSgiLi92aXN1YWwvYXJpYSIpOwoKdmFyIGxvYWRpbmdEZWZhdWx0ID0gcmVxdWlyZSgiLi9sb2FkaW5nL2RlZmF1bHQiKTsKCnZhciBTY2hlZHVsZXIgPSByZXF1aXJlKCIuL3N0cmVhbS9TY2hlZHVsZXIiKTsKCnZhciBsaWdodFRoZW1lID0gcmVxdWlyZSgiLi90aGVtZS9saWdodCIpOwoKdmFyIGRhcmtUaGVtZSA9IHJlcXVpcmUoIi4vdGhlbWUvZGFyayIpOwoKcmVxdWlyZSgiLi9jb21wb25lbnQvZGF0YXNldCIpOwoKdmFyIG1hcERhdGFTdG9yYWdlID0gcmVxdWlyZSgiLi9jb29yZC9nZW8vbWFwRGF0YVN0b3JhZ2UiKTsKLyoKKiBMaWNlbnNlZCB0byB0aGUgQXBhY2hlIFNvZnR3YXJlIEZvdW5kYXRpb24gKEFTRikgdW5kZXIgb25lCiogb3IgbW9yZSBjb250cmlidXRvciBsaWNlbnNlIGFncmVlbWVudHMuICBTZWUgdGhlIE5PVElDRSBmaWxlCiogZGlzdHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3JtYXRpb24KKiByZWdhcmRpbmcgY29weXJpZ2h0IG93bmVyc2hpcC4gIFRoZSBBU0YgbGljZW5zZXMgdGhpcyBmaWxlCiogdG8geW91IHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZQoqICJMaWNlbnNlIik7IHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2UKKiB3aXRoIHRoZSBMaWNlbnNlLiAgWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CioKKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAoqCiogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAoqIHNvZnR3YXJlIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuCiogIkFTIElTIiBCQVNJUywgV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZCiogS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlCiogc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZCBsaW1pdGF0aW9ucwoqIHVuZGVyIHRoZSBMaWNlbnNlLgoqLwoKCnZhciBhc3NlcnQgPSB6clV0aWwuYXNzZXJ0Owp2YXIgZWFjaCA9IHpyVXRpbC5lYWNoOwp2YXIgaXNGdW5jdGlvbiA9IHpyVXRpbC5pc0Z1bmN0aW9uOwp2YXIgaXNPYmplY3QgPSB6clV0aWwuaXNPYmplY3Q7CnZhciBwYXJzZUNsYXNzVHlwZSA9IENvbXBvbmVudE1vZGVsLnBhcnNlQ2xhc3NUeXBlOwp2YXIgdmVyc2lvbiA9ICc0LjkuMCc7CnZhciBkZXBlbmRlbmNpZXMgPSB7CiAgenJlbmRlcjogJzQuMy4yJwp9Owp2YXIgVEVTVF9GUkFNRV9SRU1BSU5fVElNRSA9IDE7CnZhciBQUklPUklUWV9QUk9DRVNTT1JfRklMVEVSID0gMTAwMDsKdmFyIFBSSU9SSVRZX1BST0NFU1NPUl9TRVJJRVNfRklMVEVSID0gODAwOwp2YXIgUFJJT1JJVFlfUFJPQ0VTU09SX0RBVEFTVEFDSyA9IDkwMDsKdmFyIFBSSU9SSVRZX1BST0NFU1NPUl9TVEFUSVNUSUMgPSA1MDAwOwp2YXIgUFJJT1JJVFlfVklTVUFMX0xBWU9VVCA9IDEwMDA7CnZhciBQUklPUklUWV9WSVNVQUxfUFJPR1JFU1NJVkVfTEFZT1VUID0gMTEwMDsKdmFyIFBSSU9SSVRZX1ZJU1VBTF9HTE9CQUwgPSAyMDAwOwp2YXIgUFJJT1JJVFlfVklTVUFMX0NIQVJUID0gMzAwMDsKdmFyIFBSSU9SSVRZX1ZJU1VBTF9QT1NUX0NIQVJUX0xBWU9VVCA9IDM1MDA7CnZhciBQUklPUklUWV9WSVNVQUxfQ09NUE9ORU5UID0gNDAwMDsgLy8gRklYTUUKLy8gbmVjZXNzYXJ5PwoKdmFyIFBSSU9SSVRZX1ZJU1VBTF9CUlVTSCA9IDUwMDA7CnZhciBQUklPUklUWSA9IHsKICBQUk9DRVNTT1I6IHsKICAgIEZJTFRFUjogUFJJT1JJVFlfUFJPQ0VTU09SX0ZJTFRFUiwKICAgIFNFUklFU19GSUxURVI6IFBSSU9SSVRZX1BST0NFU1NPUl9TRVJJRVNfRklMVEVSLAogICAgU1RBVElTVElDOiBQUklPUklUWV9QUk9DRVNTT1JfU1RBVElTVElDCiAgfSwKICBWSVNVQUw6IHsKICAgIExBWU9VVDogUFJJT1JJVFlfVklTVUFMX0xBWU9VVCwKICAgIFBST0dSRVNTSVZFX0xBWU9VVDogUFJJT1JJVFlfVklTVUFMX1BST0dSRVNTSVZFX0xBWU9VVCwKICAgIEdMT0JBTDogUFJJT1JJVFlfVklTVUFMX0dMT0JBTCwKICAgIENIQVJUOiBQUklPUklUWV9WSVNVQUxfQ0hBUlQsCiAgICBQT1NUX0NIQVJUX0xBWU9VVDogUFJJT1JJVFlfVklTVUFMX1BPU1RfQ0hBUlRfTEFZT1VULAogICAgQ09NUE9ORU5UOiBQUklPUklUWV9WSVNVQUxfQ09NUE9ORU5ULAogICAgQlJVU0g6IFBSSU9SSVRZX1ZJU1VBTF9CUlVTSAogIH0KfTsgLy8gTWFpbiBwcm9jZXNzIGhhdmUgdGhyZWUgZW50cmllczogYHNldE9wdGlvbmAsIGBkaXNwYXRjaEFjdGlvbmAgYW5kIGByZXNpemVgLAovLyB3aGVyZSB0aGV5IG11c3Qgbm90IGJlIGludm9rZWQgbmVzdGVkbHksIGV4Y2VwdCB0aGUgb25seSBjYXNlOiBpbnZva2UKLy8gZGlzcGF0Y2hBY3Rpb24gd2l0aCB1cGRhdGVNZXRob2QgIm5vbmUiIGluIG1haW4gcHJvY2Vzcy4KLy8gVGhpcyBmbGFnIGlzIHVzZWQgdG8gY2Fycnkgb3V0IHRoaXMgcnVsZS4KLy8gQWxsIGV2ZW50cyB3aWxsIGJlIHRyaWdnZXJlZCBvdXQgc2lkZSBtYWluIHByb2Nlc3MgKGkuZS4gd2hlbiAhdGhpc1tJTl9NQUlOX1BST0NFU1NdKS4KCnZhciBJTl9NQUlOX1BST0NFU1MgPSAnX19mbGFnSW5NYWluUHJvY2Vzcyc7CnZhciBPUFRJT05fVVBEQVRFRCA9ICdfX29wdGlvblVwZGF0ZWQnOwp2YXIgQUNUSU9OX1JFRyA9IC9eW2EtekEtWjAtOV9dKyQvOwoKZnVuY3Rpb24gY3JlYXRlUmVnaXN0ZXJFdmVudFdpdGhMb3dlcmNhc2VOYW1lKG1ldGhvZCwgaWdub3JlRGlzcG9zZWQpIHsKICByZXR1cm4gZnVuY3Rpb24gKGV2ZW50TmFtZSwgaGFuZGxlciwgY29udGV4dCkgewogICAgaWYgKCFpZ25vcmVEaXNwb3NlZCAmJiB0aGlzLl9kaXNwb3NlZCkgewogICAgICBkaXNwb3NlZFdhcm5pbmcodGhpcy5pZCk7CiAgICAgIHJldHVybjsKICAgIH0gLy8gRXZlbnQgbmFtZSBpcyBhbGwgbG93ZXJjYXNlCgoKICAgIGV2ZW50TmFtZSA9IGV2ZW50TmFtZSAmJiBldmVudE5hbWUudG9Mb3dlckNhc2UoKTsKICAgIEV2ZW50ZnVsLnByb3RvdHlwZVttZXRob2RdLmNhbGwodGhpcywgZXZlbnROYW1lLCBoYW5kbGVyLCBjb250ZXh0KTsKICB9Owp9Ci8qKgogKiBAbW9kdWxlIGVjaGFydHN+TWVzc2FnZUNlbnRlcgogKi8KCgpmdW5jdGlvbiBNZXNzYWdlQ2VudGVyKCkgewogIEV2ZW50ZnVsLmNhbGwodGhpcyk7Cn0KCk1lc3NhZ2VDZW50ZXIucHJvdG90eXBlLm9uID0gY3JlYXRlUmVnaXN0ZXJFdmVudFdpdGhMb3dlcmNhc2VOYW1lKCdvbicsIHRydWUpOwpNZXNzYWdlQ2VudGVyLnByb3RvdHlwZS5vZmYgPSBjcmVhdGVSZWdpc3RlckV2ZW50V2l0aExvd2VyY2FzZU5hbWUoJ29mZicsIHRydWUpOwpNZXNzYWdlQ2VudGVyLnByb3RvdHlwZS5vbmUgPSBjcmVhdGVSZWdpc3RlckV2ZW50V2l0aExvd2VyY2FzZU5hbWUoJ29uZScsIHRydWUpOwp6clV0aWwubWl4aW4oTWVzc2FnZUNlbnRlciwgRXZlbnRmdWwpOwovKioKICogQG1vZHVsZSBlY2hhcnRzfkVDaGFydHMKICovCgpmdW5jdGlvbiBFQ2hhcnRzKGRvbSwgdGhlbWUsIG9wdHMpIHsKICBvcHRzID0gb3B0cyB8fCB7fTsgLy8gR2V0IHRoZW1lIGJ5IG5hbWUKCiAgaWYgKHR5cGVvZiB0aGVtZSA9PT0gJ3N0cmluZycpIHsKICAgIHRoZW1lID0gdGhlbWVTdG9yYWdlW3RoZW1lXTsKICB9CiAgLyoqCiAgICogQHR5cGUge3N0cmluZ30KICAgKi8KCgogIHRoaXMuaWQ7CiAgLyoqCiAgICogR3JvdXAgaWQKICAgKiBAdHlwZSB7c3RyaW5nfQogICAqLwoKICB0aGlzLmdyb3VwOwogIC8qKgogICAqIEB0eXBlIHtIVE1MRWxlbWVudH0KICAgKiBAcHJpdmF0ZQogICAqLwoKICB0aGlzLl9kb20gPSBkb207CiAgdmFyIGRlZmF1bHRSZW5kZXJlciA9ICdjYW52YXMnOwogIC8qKgogICAqIEB0eXBlIHttb2R1bGU6enJlbmRlci9aUmVuZGVyfQogICAqIEBwcml2YXRlCiAgICovCgogIHZhciB6ciA9IHRoaXMuX3pyID0genJlbmRlci5pbml0KGRvbSwgewogICAgcmVuZGVyZXI6IG9wdHMucmVuZGVyZXIgfHwgZGVmYXVsdFJlbmRlcmVyLAogICAgZGV2aWNlUGl4ZWxSYXRpbzogb3B0cy5kZXZpY2VQaXhlbFJhdGlvLAogICAgd2lkdGg6IG9wdHMud2lkdGgsCiAgICBoZWlnaHQ6IG9wdHMuaGVpZ2h0CiAgfSk7CiAgLyoqCiAgICogRXhwZWN0IDYwIGZwcy4KICAgKiBAdHlwZSB7RnVuY3Rpb259CiAgICogQHByaXZhdGUKICAgKi8KCiAgdGhpcy5fdGhyb3R0bGVkWnJGbHVzaCA9IHRocm90dGxlKHpyVXRpbC5iaW5kKHpyLmZsdXNoLCB6ciksIDE3KTsKICB2YXIgdGhlbWUgPSB6clV0aWwuY2xvbmUodGhlbWUpOwogIHRoZW1lICYmIGJhY2t3YXJkQ29tcGF0KHRoZW1lLCB0cnVlKTsKICAvKioKICAgKiBAdHlwZSB7T2JqZWN0fQogICAqIEBwcml2YXRlCiAgICovCgogIHRoaXMuX3RoZW1lID0gdGhlbWU7CiAgLyoqCiAgICogQHR5cGUge0FycmF5Ljxtb2R1bGU6ZWNoYXJ0cy92aWV3L0NoYXJ0Pn0KICAgKiBAcHJpdmF0ZQogICAqLwoKICB0aGlzLl9jaGFydHNWaWV3cyA9IFtdOwogIC8qKgogICAqIEB0eXBlIHtPYmplY3QuPHN0cmluZywgbW9kdWxlOmVjaGFydHMvdmlldy9DaGFydD59CiAgICogQHByaXZhdGUKICAgKi8KCiAgdGhpcy5fY2hhcnRzTWFwID0ge307CiAgLyoqCiAgICogQHR5cGUge0FycmF5Ljxtb2R1bGU6ZWNoYXJ0cy92aWV3L0NvbXBvbmVudD59CiAgICogQHByaXZhdGUKICAgKi8KCiAgdGhpcy5fY29tcG9uZW50c1ZpZXdzID0gW107CiAgLyoqCiAgICogQHR5cGUge09iamVjdC48c3RyaW5nLCBtb2R1bGU6ZWNoYXJ0cy92aWV3L0NvbXBvbmVudD59CiAgICogQHByaXZhdGUKICAgKi8KCiAgdGhpcy5fY29tcG9uZW50c01hcCA9IHt9OwogIC8qKgogICAqIEB0eXBlIHttb2R1bGU6ZWNoYXJ0cy9Db29yZGluYXRlU3lzdGVtfQogICAqIEBwcml2YXRlCiAgICovCgogIHRoaXMuX2Nvb3JkU3lzTWdyID0gbmV3IENvb3JkaW5hdGVTeXN0ZW1NYW5hZ2VyKCk7CiAgLyoqCiAgICogQHR5cGUge21vZHVsZTplY2hhcnRzL0V4dGVuc2lvbkFQSX0KICAgKiBAcHJpdmF0ZQogICAqLwoKICB2YXIgYXBpID0gdGhpcy5fYXBpID0gY3JlYXRlRXh0ZW5zaW9uQVBJKHRoaXMpOyAvLyBTb3J0IG9uIGRlbWFuZAoKICBmdW5jdGlvbiBwcmlvcml0eVNvcnRGdW5jKGEsIGIpIHsKICAgIHJldHVybiBhLl9fcHJpbyAtIGIuX19wcmlvOwogIH0KCiAgdGltc29ydCh2aXN1YWxGdW5jcywgcHJpb3JpdHlTb3J0RnVuYyk7CiAgdGltc29ydChkYXRhUHJvY2Vzc29yRnVuY3MsIHByaW9yaXR5U29ydEZ1bmMpOwogIC8qKgogICAqIEB0eXBlIHttb2R1bGU6ZWNoYXJ0cy9zdHJlYW0vU2NoZWR1bGVyfQogICAqLwoKICB0aGlzLl9zY2hlZHVsZXIgPSBuZXcgU2NoZWR1bGVyKHRoaXMsIGFwaSwgZGF0YVByb2Nlc3NvckZ1bmNzLCB2aXN1YWxGdW5jcyk7CiAgRXZlbnRmdWwuY2FsbCh0aGlzLCB0aGlzLl9lY0V2ZW50UHJvY2Vzc29yID0gbmV3IEV2ZW50UHJvY2Vzc29yKCkpOwogIC8qKgogICAqIEB0eXBlIHttb2R1bGU6ZWNoYXJ0c35NZXNzYWdlQ2VudGVyfQogICAqIEBwcml2YXRlCiAgICovCgogIHRoaXMuX21lc3NhZ2VDZW50ZXIgPSBuZXcgTWVzc2FnZUNlbnRlcigpOyAvLyBJbml0IG1vdXNlIGV2ZW50cwoKICB0aGlzLl9pbml0RXZlbnRzKCk7IC8vIEluIGNhc2Ugc29tZSBwZW9wbGUgd3JpdGUgYHdpbmRvdy5vbnJlc2l6ZSA9IGNoYXJ0LnJlc2l6ZWAKCgogIHRoaXMucmVzaXplID0genJVdGlsLmJpbmQodGhpcy5yZXNpemUsIHRoaXMpOyAvLyBDYW4ndCBkaXNwYXRjaCBhY3Rpb24gZHVyaW5nIHJlbmRlcmluZyBwcm9jZWR1cmUKCiAgdGhpcy5fcGVuZGluZ0FjdGlvbnMgPSBbXTsKICB6ci5hbmltYXRpb24ub24oJ2ZyYW1lJywgdGhpcy5fb25mcmFtZSwgdGhpcyk7CiAgYmluZFJlbmRlcmVkRXZlbnQoenIsIHRoaXMpOyAvLyBFQ2hhcnRzIGluc3RhbmNlIGNhbiBiZSB1c2VkIGFzIHZhbHVlLgoKICB6clV0aWwuc2V0QXNQcmltaXRpdmUodGhpcyk7Cn0KCnZhciBlY2hhcnRzUHJvdG8gPSBFQ2hhcnRzLnByb3RvdHlwZTsKCmVjaGFydHNQcm90by5fb25mcmFtZSA9IGZ1bmN0aW9uICgpIHsKICBpZiAodGhpcy5fZGlzcG9zZWQpIHsKICAgIHJldHVybjsKICB9CgogIHZhciBzY2hlZHVsZXIgPSB0aGlzLl9zY2hlZHVsZXI7IC8vIExhenkgdXBkYXRlCgogIGlmICh0aGlzW09QVElPTl9VUERBVEVEXSkgewogICAgdmFyIHNpbGVudCA9IHRoaXNbT1BUSU9OX1VQREFURURdLnNpbGVudDsKICAgIHRoaXNbSU5fTUFJTl9QUk9DRVNTXSA9IHRydWU7CiAgICBwcmVwYXJlKHRoaXMpOwogICAgdXBkYXRlTWV0aG9kcy51cGRhdGUuY2FsbCh0aGlzKTsKICAgIHRoaXNbSU5fTUFJTl9QUk9DRVNTXSA9IGZhbHNlOwogICAgdGhpc1tPUFRJT05fVVBEQVRFRF0gPSBmYWxzZTsKICAgIGZsdXNoUGVuZGluZ0FjdGlvbnMuY2FsbCh0aGlzLCBzaWxlbnQpOwogICAgdHJpZ2dlclVwZGF0ZWRFdmVudC5jYWxsKHRoaXMsIHNpbGVudCk7CiAgfSAvLyBBdm9pZCBkbyBib3RoIGxhenkgdXBkYXRlIGFuZCBwcm9ncmVzcyBpbiBvbmUgZnJhbWUuCiAgZWxzZSBpZiAoc2NoZWR1bGVyLnVuZmluaXNoZWQpIHsKICAgICAgLy8gU3RyZWFtIHByb2dyZXNzLgogICAgICB2YXIgcmVtYWluVGltZSA9IFRFU1RfRlJBTUVfUkVNQUlOX1RJTUU7CiAgICAgIHZhciBlY01vZGVsID0gdGhpcy5fbW9kZWw7CiAgICAgIHZhciBhcGkgPSB0aGlzLl9hcGk7CiAgICAgIHNjaGVkdWxlci51bmZpbmlzaGVkID0gZmFsc2U7CgogICAgICBkbyB7CiAgICAgICAgdmFyIHN0YXJ0VGltZSA9ICtuZXcgRGF0ZSgpOwogICAgICAgIHNjaGVkdWxlci5wZXJmb3JtU2VyaWVzVGFza3MoZWNNb2RlbCk7IC8vIEN1cnJlbnRseSBkYXRhUHJvY2Vzc29yRnVuY3MgZG8gbm90IGNoZWNrIHRocmVzaG9sZC4KCiAgICAgICAgc2NoZWR1bGVyLnBlcmZvcm1EYXRhUHJvY2Vzc29yVGFza3MoZWNNb2RlbCk7CiAgICAgICAgdXBkYXRlU3RyZWFtTW9kZXModGhpcywgZWNNb2RlbCk7IC8vIERvIG5vdCB1cGRhdGUgY29vcmRpbmF0ZSBzeXN0ZW0gaGVyZS4gQmVjYXVzZSB0aGF0IGNvb3JkIHN5c3RlbSB1cGRhdGUgaW4KICAgICAgICAvLyBlYWNoIGZyYW1lIGlzIG5vdCBhIGdvb2QgdXNlciBleHBlcmllbmNlLiBTbyB3ZSBmb2xsb3cgdGhlIHJ1bGUgdGhhdAogICAgICAgIC8vIHRoZSBleHRlbnQgb2YgdGhlIGNvb3JkaW5hdGUgc3lzdGVtIGlzIGRldGVybWluIGluIHRoZSBmaXJzdCBmcmFtZSAodGhlCiAgICAgICAgLy8gZnJhbWUgaXMgZXhlY3V0ZWQgaW1tZWRpZXRlbHkgYWZ0ZXIgdGFzayByZXNldC4KICAgICAgICAvLyB0aGlzLl9jb29yZFN5c01nci51cGRhdGUoZWNNb2RlbCwgYXBpKTsKICAgICAgICAvLyBjb25zb2xlLmxvZygnLS0tIGVjIGZyYW1lIHZpc3VhbCAtLS0nLCByZW1haW5UaW1lKTsKCiAgICAgICAgc2NoZWR1bGVyLnBlcmZvcm1WaXN1YWxUYXNrcyhlY01vZGVsKTsKICAgICAgICByZW5kZXJTZXJpZXModGhpcywgdGhpcy5fbW9kZWwsIGFwaSwgJ3JlbWFpbicpOwogICAgICAgIHJlbWFpblRpbWUgLT0gK25ldyBEYXRlKCkgLSBzdGFydFRpbWU7CiAgICAgIH0gd2hpbGUgKHJlbWFpblRpbWUgPiAwICYmIHNjaGVkdWxlci51bmZpbmlzaGVkKTsgLy8gQ2FsbCBmbHVzaCBleHBsaWNpdGx5IGZvciB0cmlnZ2VyIGZpbmlzaGVkIGV2ZW50LgoKCiAgICAgIGlmICghc2NoZWR1bGVyLnVuZmluaXNoZWQpIHsKICAgICAgICB0aGlzLl96ci5mbHVzaCgpOwogICAgICB9IC8vIEVsc2UsIHpyIGZsdXNoaW5nIGJlIGVuc3VlIHdpdGhpbiB0aGUgc2FtZSBmcmFtZSwKICAgICAgLy8gYmVjYXVzZSB6ciBmbHVzaGluZyBpcyBhZnRlciBvbmZyYW1lIGV2ZW50LgoKICAgIH0KfTsKLyoqCiAqIEByZXR1cm4ge0hUTUxFbGVtZW50fQogKi8KCgplY2hhcnRzUHJvdG8uZ2V0RG9tID0gZnVuY3Rpb24gKCkgewogIHJldHVybiB0aGlzLl9kb207Cn07Ci8qKgogKiBAcmV0dXJuIHttb2R1bGU6enJlbmRlcn5aUmVuZGVyfQogKi8KCgplY2hhcnRzUHJvdG8uZ2V0WnIgPSBmdW5jdGlvbiAoKSB7CiAgcmV0dXJuIHRoaXMuX3pyOwp9OwovKioKICogVXNhZ2U6CiAqIGNoYXJ0LnNldE9wdGlvbihvcHRpb24sIG5vdE1lcmdlLCBsYXp5VXBkYXRlKTsKICogY2hhcnQuc2V0T3B0aW9uKG9wdGlvbiwgewogKiAgICAgbm90TWVyZ2U6IC4uLiwKICogICAgIGxhenlVcGRhdGU6IC4uLiwKICogICAgIHNpbGVudDogLi4uCiAqIH0pOwogKgogKiBAcGFyYW0ge09iamVjdH0gb3B0aW9uCiAqIEBwYXJhbSB7T2JqZWN0fGJvb2xlYW59IFtvcHRzXSBvcHRzIG9yIG5vdE1lcmdlLgogKiBAcGFyYW0ge2Jvb2xlYW59IFtvcHRzLm5vdE1lcmdlPWZhbHNlXQogKiBAcGFyYW0ge2Jvb2xlYW59IFtvcHRzLmxhenlVcGRhdGU9ZmFsc2VdIFVzZWZ1bCB3aGVuIHNldE9wdGlvbiBmcmVxdWVudGx5LgogKi8KCgplY2hhcnRzUHJvdG8uc2V0T3B0aW9uID0gZnVuY3Rpb24gKG9wdGlvbiwgbm90TWVyZ2UsIGxhenlVcGRhdGUpIHsKICBpZiAodGhpcy5fZGlzcG9zZWQpIHsKICAgIGRpc3Bvc2VkV2FybmluZyh0aGlzLmlkKTsKICAgIHJldHVybjsKICB9CgogIHZhciBzaWxlbnQ7CgogIGlmIChpc09iamVjdChub3RNZXJnZSkpIHsKICAgIGxhenlVcGRhdGUgPSBub3RNZXJnZS5sYXp5VXBkYXRlOwogICAgc2lsZW50ID0gbm90TWVyZ2Uuc2lsZW50OwogICAgbm90TWVyZ2UgPSBub3RNZXJnZS5ub3RNZXJnZTsKICB9CgogIHRoaXNbSU5fTUFJTl9QUk9DRVNTXSA9IHRydWU7CgogIGlmICghdGhpcy5fbW9kZWwgfHwgbm90TWVyZ2UpIHsKICAgIHZhciBvcHRpb25NYW5hZ2VyID0gbmV3IE9wdGlvbk1hbmFnZXIodGhpcy5fYXBpKTsKICAgIHZhciB0aGVtZSA9IHRoaXMuX3RoZW1lOwogICAgdmFyIGVjTW9kZWwgPSB0aGlzLl9tb2RlbCA9IG5ldyBHbG9iYWxNb2RlbCgpOwogICAgZWNNb2RlbC5zY2hlZHVsZXIgPSB0aGlzLl9zY2hlZHVsZXI7CiAgICBlY01vZGVsLmluaXQobnVsbCwgbnVsbCwgdGhlbWUsIG9wdGlvbk1hbmFnZXIpOwogIH0KCiAgdGhpcy5fbW9kZWwuc2V0T3B0aW9uKG9wdGlvbiwgb3B0aW9uUHJlcHJvY2Vzc29yRnVuY3MpOwoKICBpZiAobGF6eVVwZGF0ZSkgewogICAgdGhpc1tPUFRJT05fVVBEQVRFRF0gPSB7CiAgICAgIHNpbGVudDogc2lsZW50CiAgICB9OwogICAgdGhpc1tJTl9NQUlOX1BST0NFU1NdID0gZmFsc2U7CiAgfSBlbHNlIHsKICAgIHByZXBhcmUodGhpcyk7CiAgICB1cGRhdGVNZXRob2RzLnVwZGF0ZS5jYWxsKHRoaXMpOyAvLyBFbnN1cmUgenIgcmVmcmVzaCBzeWNocm9ub3VzbHksIGFuZCB0aGVuIHBpeGVsIGluIGNhbnZhcyBjYW4gYmUKICAgIC8vIGZldGNoZWQgYWZ0ZXIgYHNldE9wdGlvbmAuCgogICAgdGhpcy5fenIuZmx1c2goKTsKCiAgICB0aGlzW09QVElPTl9VUERBVEVEXSA9IGZhbHNlOwogICAgdGhpc1tJTl9NQUlOX1BST0NFU1NdID0gZmFsc2U7CiAgICBmbHVzaFBlbmRpbmdBY3Rpb25zLmNhbGwodGhpcywgc2lsZW50KTsKICAgIHRyaWdnZXJVcGRhdGVkRXZlbnQuY2FsbCh0aGlzLCBzaWxlbnQpOwogIH0KfTsKLyoqCiAqIEBERVBSRUNBVEVECiAqLwoKCmVjaGFydHNQcm90by5zZXRUaGVtZSA9IGZ1bmN0aW9uICgpIHsKICBjb25zb2xlLmVycm9yKCdFQ2hhcnRzI3NldFRoZW1lKCkgaXMgREVQUkVDQVRFRCBpbiBFQ2hhcnRzIDMuMCcpOwp9OwovKioKICogQHJldHVybiB7bW9kdWxlOmVjaGFydHMvbW9kZWwvR2xvYmFsfQogKi8KCgplY2hhcnRzUHJvdG8uZ2V0TW9kZWwgPSBmdW5jdGlvbiAoKSB7CiAgcmV0dXJuIHRoaXMuX21vZGVsOwp9OwovKioKICogQHJldHVybiB7T2JqZWN0fQogKi8KCgplY2hhcnRzUHJvdG8uZ2V0T3B0aW9uID0gZnVuY3Rpb24gKCkgewogIHJldHVybiB0aGlzLl9tb2RlbCAmJiB0aGlzLl9tb2RlbC5nZXRPcHRpb24oKTsKfTsKLyoqCiAqIEByZXR1cm4ge251bWJlcn0KICovCgoKZWNoYXJ0c1Byb3RvLmdldFdpZHRoID0gZnVuY3Rpb24gKCkgewogIHJldHVybiB0aGlzLl96ci5nZXRXaWR0aCgpOwp9OwovKioKICogQHJldHVybiB7bnVtYmVyfQogKi8KCgplY2hhcnRzUHJvdG8uZ2V0SGVpZ2h0ID0gZnVuY3Rpb24gKCkgewogIHJldHVybiB0aGlzLl96ci5nZXRIZWlnaHQoKTsKfTsKLyoqCiAqIEByZXR1cm4ge251bWJlcn0KICovCgoKZWNoYXJ0c1Byb3RvLmdldERldmljZVBpeGVsUmF0aW8gPSBmdW5jdGlvbiAoKSB7CiAgcmV0dXJuIHRoaXMuX3pyLnBhaW50ZXIuZHByIHx8IHdpbmRvdy5kZXZpY2VQaXhlbFJhdGlvIHx8IDE7Cn07Ci8qKgogKiBHZXQgY2FudmFzIHdoaWNoIGhhcyBhbGwgdGhpbmcgcmVuZGVyZWQKICogQHBhcmFtIHtPYmplY3R9IG9wdHMKICogQHBhcmFtIHtzdHJpbmd9IFtvcHRzLmJhY2tncm91bmRDb2xvcl0KICogQHJldHVybiB7c3RyaW5nfQogKi8KCgplY2hhcnRzUHJvdG8uZ2V0UmVuZGVyZWRDYW52YXMgPSBmdW5jdGlvbiAob3B0cykgewogIGlmICghZW52LmNhbnZhc1N1cHBvcnRlZCkgewogICAgcmV0dXJuOwogIH0KCiAgb3B0cyA9IG9wdHMgfHwge307CiAgb3B0cy5waXhlbFJhdGlvID0gb3B0cy5waXhlbFJhdGlvIHx8IDE7CiAgb3B0cy5iYWNrZ3JvdW5kQ29sb3IgPSBvcHRzLmJhY2tncm91bmRDb2xvciB8fCB0aGlzLl9tb2RlbC5nZXQoJ2JhY2tncm91bmRDb2xvcicpOwogIHZhciB6ciA9IHRoaXMuX3pyOyAvLyB2YXIgbGlzdCA9IHpyLnN0b3JhZ2UuZ2V0RGlzcGxheUxpc3QoKTsKICAvLyBTdG9wIGFuaW1hdGlvbnMKICAvLyBOZXZlciB3b3JrcyBiZWZvcmUgaW4gaW5pdCBhbmltYXRpb24sIHNvIHJlbW92ZSBpdC4KICAvLyB6clV0aWwuZWFjaChsaXN0LCBmdW5jdGlvbiAoZWwpIHsKICAvLyAgICAgZWwuc3RvcEFuaW1hdGlvbih0cnVlKTsKICAvLyB9KTsKCiAgcmV0dXJuIHpyLnBhaW50ZXIuZ2V0UmVuZGVyZWRDYW52YXMob3B0cyk7Cn07Ci8qKgogKiBHZXQgc3ZnIGRhdGEgdXJsCiAqIEByZXR1cm4ge3N0cmluZ30KICovCgoKZWNoYXJ0c1Byb3RvLmdldFN2Z0RhdGFVUkwgPSBmdW5jdGlvbiAoKSB7CiAgaWYgKCFlbnYuc3ZnU3VwcG9ydGVkKSB7CiAgICByZXR1cm47CiAgfQoKICB2YXIgenIgPSB0aGlzLl96cjsKICB2YXIgbGlzdCA9IHpyLnN0b3JhZ2UuZ2V0RGlzcGxheUxpc3QoKTsgLy8gU3RvcCBhbmltYXRpb25zCgogIHpyVXRpbC5lYWNoKGxpc3QsIGZ1bmN0aW9uIChlbCkgewogICAgZWwuc3RvcEFuaW1hdGlvbih0cnVlKTsKICB9KTsKICByZXR1cm4genIucGFpbnRlci50b0RhdGFVUkwoKTsKfTsKLyoqCiAqIEByZXR1cm4ge3N0cmluZ30KICogQHBhcmFtIHtPYmplY3R9IG9wdHMKICogQHBhcmFtIHtzdHJpbmd9IFtvcHRzLnR5cGU9J3BuZyddCiAqIEBwYXJhbSB7c3RyaW5nfSBbb3B0cy5waXhlbFJhdGlvPTFdCiAqIEBwYXJhbSB7c3RyaW5nfSBbb3B0cy5iYWNrZ3JvdW5kQ29sb3JdCiAqIEBwYXJhbSB7c3RyaW5nfSBbb3B0cy5leGNsdWRlQ29tcG9uZW50c10KICovCgoKZWNoYXJ0c1Byb3RvLmdldERhdGFVUkwgPSBmdW5jdGlvbiAob3B0cykgewogIGlmICh0aGlzLl9kaXNwb3NlZCkgewogICAgZGlzcG9zZWRXYXJuaW5nKHRoaXMuaWQpOwogICAgcmV0dXJuOwogIH0KCiAgb3B0cyA9IG9wdHMgfHwge307CiAgdmFyIGV4Y2x1ZGVDb21wb25lbnRzID0gb3B0cy5leGNsdWRlQ29tcG9uZW50czsKICB2YXIgZWNNb2RlbCA9IHRoaXMuX21vZGVsOwogIHZhciBleGNsdWRlc0NvbXBvbmVudFZpZXdzID0gW107CiAgdmFyIHNlbGYgPSB0aGlzOwogIGVhY2goZXhjbHVkZUNvbXBvbmVudHMsIGZ1bmN0aW9uIChjb21wb25lbnRUeXBlKSB7CiAgICBlY01vZGVsLmVhY2hDb21wb25lbnQoewogICAgICBtYWluVHlwZTogY29tcG9uZW50VHlwZQogICAgfSwgZnVuY3Rpb24gKGNvbXBvbmVudCkgewogICAgICB2YXIgdmlldyA9IHNlbGYuX2NvbXBvbmVudHNNYXBbY29tcG9uZW50Ll9fdmlld0lkXTsKCiAgICAgIGlmICghdmlldy5ncm91cC5pZ25vcmUpIHsKICAgICAgICBleGNsdWRlc0NvbXBvbmVudFZpZXdzLnB1c2godmlldyk7CiAgICAgICAgdmlldy5ncm91cC5pZ25vcmUgPSB0cnVlOwogICAgICB9CiAgICB9KTsKICB9KTsKICB2YXIgdXJsID0gdGhpcy5fenIucGFpbnRlci5nZXRUeXBlKCkgPT09ICdzdmcnID8gdGhpcy5nZXRTdmdEYXRhVVJMKCkgOiB0aGlzLmdldFJlbmRlcmVkQ2FudmFzKG9wdHMpLnRvRGF0YVVSTCgnaW1hZ2UvJyArIChvcHRzICYmIG9wdHMudHlwZSB8fCAncG5nJykpOwogIGVhY2goZXhjbHVkZXNDb21wb25lbnRWaWV3cywgZnVuY3Rpb24gKHZpZXcpIHsKICAgIHZpZXcuZ3JvdXAuaWdub3JlID0gZmFsc2U7CiAgfSk7CiAgcmV0dXJuIHVybDsKfTsKLyoqCiAqIEByZXR1cm4ge3N0cmluZ30KICogQHBhcmFtIHtPYmplY3R9IG9wdHMKICogQHBhcmFtIHtzdHJpbmd9IFtvcHRzLnR5cGU9J3BuZyddCiAqIEBwYXJhbSB7c3RyaW5nfSBbb3B0cy5waXhlbFJhdGlvPTFdCiAqIEBwYXJhbSB7c3RyaW5nfSBbb3B0cy5iYWNrZ3JvdW5kQ29sb3JdCiAqLwoKCmVjaGFydHNQcm90by5nZXRDb25uZWN0ZWREYXRhVVJMID0gZnVuY3Rpb24gKG9wdHMpIHsKICBpZiAodGhpcy5fZGlzcG9zZWQpIHsKICAgIGRpc3Bvc2VkV2FybmluZyh0aGlzLmlkKTsKICAgIHJldHVybjsKICB9CgogIGlmICghZW52LmNhbnZhc1N1cHBvcnRlZCkgewogICAgcmV0dXJuOwogIH0KCiAgdmFyIGlzU3ZnID0gb3B0cy50eXBlID09PSAnc3ZnJzsKICB2YXIgZ3JvdXBJZCA9IHRoaXMuZ3JvdXA7CiAgdmFyIG1hdGhNaW4gPSBNYXRoLm1pbjsKICB2YXIgbWF0aE1heCA9IE1hdGgubWF4OwogIHZhciBNQVhfTlVNQkVSID0gSW5maW5pdHk7CgogIGlmIChjb25uZWN0ZWRHcm91cHNbZ3JvdXBJZF0pIHsKICAgIHZhciBsZWZ0ID0gTUFYX05VTUJFUjsKICAgIHZhciB0b3AgPSBNQVhfTlVNQkVSOwogICAgdmFyIHJpZ2h0ID0gLU1BWF9OVU1CRVI7CiAgICB2YXIgYm90dG9tID0gLU1BWF9OVU1CRVI7CiAgICB2YXIgY2FudmFzTGlzdCA9IFtdOwogICAgdmFyIGRwciA9IG9wdHMgJiYgb3B0cy5waXhlbFJhdGlvIHx8IDE7CiAgICB6clV0aWwuZWFjaChpbnN0YW5jZXMsIGZ1bmN0aW9uIChjaGFydCwgaWQpIHsKICAgICAgaWYgKGNoYXJ0Lmdyb3VwID09PSBncm91cElkKSB7CiAgICAgICAgdmFyIGNhbnZhcyA9IGlzU3ZnID8gY2hhcnQuZ2V0WnIoKS5wYWludGVyLmdldFN2Z0RvbSgpLmlubmVySFRNTCA6IGNoYXJ0LmdldFJlbmRlcmVkQ2FudmFzKHpyVXRpbC5jbG9uZShvcHRzKSk7CiAgICAgICAgdmFyIGJvdW5kaW5nUmVjdCA9IGNoYXJ0LmdldERvbSgpLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpOwogICAgICAgIGxlZnQgPSBtYXRoTWluKGJvdW5kaW5nUmVjdC5sZWZ0LCBsZWZ0KTsKICAgICAgICB0b3AgPSBtYXRoTWluKGJvdW5kaW5nUmVjdC50b3AsIHRvcCk7CiAgICAgICAgcmlnaHQgPSBtYXRoTWF4KGJvdW5kaW5nUmVjdC5yaWdodCwgcmlnaHQpOwogICAgICAgIGJvdHRvbSA9IG1hdGhNYXgoYm91bmRpbmdSZWN0LmJvdHRvbSwgYm90dG9tKTsKICAgICAgICBjYW52YXNMaXN0LnB1c2goewogICAgICAgICAgZG9tOiBjYW52YXMsCiAgICAgICAgICBsZWZ0OiBib3VuZGluZ1JlY3QubGVmdCwKICAgICAgICAgIHRvcDogYm91bmRpbmdSZWN0LnRvcAogICAgICAgIH0pOwogICAgICB9CiAgICB9KTsKICAgIGxlZnQgKj0gZHByOwogICAgdG9wICo9IGRwcjsKICAgIHJpZ2h0ICo9IGRwcjsKICAgIGJvdHRvbSAqPSBkcHI7CiAgICB2YXIgd2lkdGggPSByaWdodCAtIGxlZnQ7CiAgICB2YXIgaGVpZ2h0ID0gYm90dG9tIC0gdG9wOwogICAgdmFyIHRhcmdldENhbnZhcyA9IHpyVXRpbC5jcmVhdGVDYW52YXMoKTsKICAgIHZhciB6ciA9IHpyZW5kZXIuaW5pdCh0YXJnZXRDYW52YXMsIHsKICAgICAgcmVuZGVyZXI6IGlzU3ZnID8gJ3N2ZycgOiAnY2FudmFzJwogICAgfSk7CiAgICB6ci5yZXNpemUoewogICAgICB3aWR0aDogd2lkdGgsCiAgICAgIGhlaWdodDogaGVpZ2h0CiAgICB9KTsKCiAgICBpZiAoaXNTdmcpIHsKICAgICAgdmFyIGNvbnRlbnQgPSAnJzsKICAgICAgZWFjaChjYW52YXNMaXN0LCBmdW5jdGlvbiAoaXRlbSkgewogICAgICAgIHZhciB4ID0gaXRlbS5sZWZ0IC0gbGVmdDsKICAgICAgICB2YXIgeSA9IGl0ZW0udG9wIC0gdG9wOwogICAgICAgIGNvbnRlbnQgKz0gJzxnIHRyYW5zZm9ybT0idHJhbnNsYXRlKCcgKyB4ICsgJywnICsgeSArICcpIj4nICsgaXRlbS5kb20gKyAnPC9nPic7CiAgICAgIH0pOwogICAgICB6ci5wYWludGVyLmdldFN2Z1Jvb3QoKS5pbm5lckhUTUwgPSBjb250ZW50OwoKICAgICAgaWYgKG9wdHMuY29ubmVjdGVkQmFja2dyb3VuZENvbG9yKSB7CiAgICAgICAgenIucGFpbnRlci5zZXRCYWNrZ3JvdW5kQ29sb3Iob3B0cy5jb25uZWN0ZWRCYWNrZ3JvdW5kQ29sb3IpOwogICAgICB9CgogICAgICB6ci5yZWZyZXNoSW1tZWRpYXRlbHkoKTsKICAgICAgcmV0dXJuIHpyLnBhaW50ZXIudG9EYXRhVVJMKCk7CiAgICB9IGVsc2UgewogICAgICAvLyBCYWNrZ3JvdW5kIGJldHdlZW4gdGhlIGNoYXJ0cwogICAgICBpZiAob3B0cy5jb25uZWN0ZWRCYWNrZ3JvdW5kQ29sb3IpIHsKICAgICAgICB6ci5hZGQobmV3IGdyYXBoaWMuUmVjdCh7CiAgICAgICAgICBzaGFwZTogewogICAgICAgICAgICB4OiAwLAogICAgICAgICAgICB5OiAwLAogICAgICAgICAgICB3aWR0aDogd2lkdGgsCiAgICAgICAgICAgIGhlaWdodDogaGVpZ2h0CiAgICAgICAgICB9LAogICAgICAgICAgc3R5bGU6IHsKICAgICAgICAgICAgZmlsbDogb3B0cy5jb25uZWN0ZWRCYWNrZ3JvdW5kQ29sb3IKICAgICAgICAgIH0KICAgICAgICB9KSk7CiAgICAgIH0KCiAgICAgIGVhY2goY2FudmFzTGlzdCwgZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICB2YXIgaW1nID0gbmV3IGdyYXBoaWMuSW1hZ2UoewogICAgICAgICAgc3R5bGU6IHsKICAgICAgICAgICAgeDogaXRlbS5sZWZ0ICogZHByIC0gbGVmdCwKICAgICAgICAgICAgeTogaXRlbS50b3AgKiBkcHIgLSB0b3AsCiAgICAgICAgICAgIGltYWdlOiBpdGVtLmRvbQogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICAgIHpyLmFkZChpbWcpOwogICAgICB9KTsKICAgICAgenIucmVmcmVzaEltbWVkaWF0ZWx5KCk7CiAgICAgIHJldHVybiB0YXJnZXRDYW52YXMudG9EYXRhVVJMKCdpbWFnZS8nICsgKG9wdHMgJiYgb3B0cy50eXBlIHx8ICdwbmcnKSk7CiAgICB9CiAgfSBlbHNlIHsKICAgIHJldHVybiB0aGlzLmdldERhdGFVUkwob3B0cyk7CiAgfQp9OwovKioKICogQ29udmVydCBmcm9tIGxvZ2ljYWwgY29vcmRpbmF0ZSBzeXN0ZW0gdG8gcGl4ZWwgY29vcmRpbmF0ZSBzeXN0ZW0uCiAqIFNlZSBDb29yZGluYXRlU3lzdGVtI2NvbnZlcnRUb1BpeGVsLgogKiBAcGFyYW0ge3N0cmluZ3xPYmplY3R9IGZpbmRlcgogKiAgICAgICAgSWYgc3RyaW5nLCBlLmcuLCAnZ2VvJywgbWVhbnMge2dlb0luZGV4OiAwfS4KICogICAgICAgIElmIE9iamVjdCwgY291bGQgY29udGFpbiBzb21lIG9mIHRoZXNlIHByb3BlcnRpZXMgYmVsb3c6CiAqICAgICAgICB7CiAqICAgICAgICAgICAgc2VyaWVzSW5kZXggLyBzZXJpZXNJZCAvIHNlcmllc05hbWUsCiAqICAgICAgICAgICAgZ2VvSW5kZXggLyBnZW9JZCwgZ2VvTmFtZSwKICogICAgICAgICAgICBibWFwSW5kZXggLyBibWFwSWQgLyBibWFwTmFtZSwKICogICAgICAgICAgICB4QXhpc0luZGV4IC8geEF4aXNJZCAvIHhBeGlzTmFtZSwKICogICAgICAgICAgICB5QXhpc0luZGV4IC8geUF4aXNJZCAvIHlBeGlzTmFtZSwKICogICAgICAgICAgICBncmlkSW5kZXggLyBncmlkSWQgLyBncmlkTmFtZSwKICogICAgICAgICAgICAuLi4gKGNhbiBiZSBleHRlbmRlZCkKICogICAgICAgIH0KICogQHBhcmFtIHtBcnJheXxudW1iZXJ9IHZhbHVlCiAqIEByZXR1cm4ge0FycmF5fG51bWJlcn0gcmVzdWx0CiAqLwoKCmVjaGFydHNQcm90by5jb252ZXJ0VG9QaXhlbCA9IHpyVXRpbC5jdXJyeShkb0NvbnZlcnRQaXhlbCwgJ2NvbnZlcnRUb1BpeGVsJyk7Ci8qKgogKiBDb252ZXJ0IGZyb20gcGl4ZWwgY29vcmRpbmF0ZSBzeXN0ZW0gdG8gbG9naWNhbCBjb29yZGluYXRlIHN5c3RlbS4KICogU2VlIENvb3JkaW5hdGVTeXN0ZW0jY29udmVydEZyb21QaXhlbC4KICogQHBhcmFtIHtzdHJpbmd8T2JqZWN0fSBmaW5kZXIKICogICAgICAgIElmIHN0cmluZywgZS5nLiwgJ2dlbycsIG1lYW5zIHtnZW9JbmRleDogMH0uCiAqICAgICAgICBJZiBPYmplY3QsIGNvdWxkIGNvbnRhaW4gc29tZSBvZiB0aGVzZSBwcm9wZXJ0aWVzIGJlbG93OgogKiAgICAgICAgewogKiAgICAgICAgICAgIHNlcmllc0luZGV4IC8gc2VyaWVzSWQgLyBzZXJpZXNOYW1lLAogKiAgICAgICAgICAgIGdlb0luZGV4IC8gZ2VvSWQgLyBnZW9OYW1lLAogKiAgICAgICAgICAgIGJtYXBJbmRleCAvIGJtYXBJZCAvIGJtYXBOYW1lLAogKiAgICAgICAgICAgIHhBeGlzSW5kZXggLyB4QXhpc0lkIC8geEF4aXNOYW1lLAogKiAgICAgICAgICAgIHlBeGlzSW5kZXggLyB5QXhpc0lkIC8geUF4aXNOYW1lCiAqICAgICAgICAgICAgZ3JpZEluZGV4IC8gZ3JpZElkIC8gZ3JpZE5hbWUsCiAqICAgICAgICAgICAgLi4uIChjYW4gYmUgZXh0ZW5kZWQpCiAqICAgICAgICB9CiAqIEBwYXJhbSB7QXJyYXl8bnVtYmVyfSB2YWx1ZQogKiBAcmV0dXJuIHtBcnJheXxudW1iZXJ9IHJlc3VsdAogKi8KCmVjaGFydHNQcm90by5jb252ZXJ0RnJvbVBpeGVsID0genJVdGlsLmN1cnJ5KGRvQ29udmVydFBpeGVsLCAnY29udmVydEZyb21QaXhlbCcpOwoKZnVuY3Rpb24gZG9Db252ZXJ0UGl4ZWwobWV0aG9kTmFtZSwgZmluZGVyLCB2YWx1ZSkgewogIGlmICh0aGlzLl9kaXNwb3NlZCkgewogICAgZGlzcG9zZWRXYXJuaW5nKHRoaXMuaWQpOwogICAgcmV0dXJuOwogIH0KCiAgdmFyIGVjTW9kZWwgPSB0aGlzLl9tb2RlbDsKCiAgdmFyIGNvb3JkU3lzTGlzdCA9IHRoaXMuX2Nvb3JkU3lzTWdyLmdldENvb3JkaW5hdGVTeXN0ZW1zKCk7CgogIHZhciByZXN1bHQ7CiAgZmluZGVyID0gbW9kZWxVdGlsLnBhcnNlRmluZGVyKGVjTW9kZWwsIGZpbmRlcik7CgogIGZvciAodmFyIGkgPSAwOyBpIDwgY29vcmRTeXNMaXN0Lmxlbmd0aDsgaSsrKSB7CiAgICB2YXIgY29vcmRTeXMgPSBjb29yZFN5c0xpc3RbaV07CgogICAgaWYgKGNvb3JkU3lzW21ldGhvZE5hbWVdICYmIChyZXN1bHQgPSBjb29yZFN5c1ttZXRob2ROYW1lXShlY01vZGVsLCBmaW5kZXIsIHZhbHVlKSkgIT0gbnVsbCkgewogICAgICByZXR1cm4gcmVzdWx0OwogICAgfQogIH0KfQovKioKICogSXMgdGhlIHNwZWNpZmllZCBjb29yZGluYXRlIHN5c3RlbXMgb3IgY29tcG9uZW50cyBjb250YWluIHRoZSBnaXZlbiBwaXhlbCBwb2ludC4KICogQHBhcmFtIHtzdHJpbmd8T2JqZWN0fSBmaW5kZXIKICogICAgICAgIElmIHN0cmluZywgZS5nLiwgJ2dlbycsIG1lYW5zIHtnZW9JbmRleDogMH0uCiAqICAgICAgICBJZiBPYmplY3QsIGNvdWxkIGNvbnRhaW4gc29tZSBvZiB0aGVzZSBwcm9wZXJ0aWVzIGJlbG93OgogKiAgICAgICAgewogKiAgICAgICAgICAgIHNlcmllc0luZGV4IC8gc2VyaWVzSWQgLyBzZXJpZXNOYW1lLAogKiAgICAgICAgICAgIGdlb0luZGV4IC8gZ2VvSWQgLyBnZW9OYW1lLAogKiAgICAgICAgICAgIGJtYXBJbmRleCAvIGJtYXBJZCAvIGJtYXBOYW1lLAogKiAgICAgICAgICAgIHhBeGlzSW5kZXggLyB4QXhpc0lkIC8geEF4aXNOYW1lLAogKiAgICAgICAgICAgIHlBeGlzSW5kZXggLyB5QXhpc0lkIC8geUF4aXNOYW1lLAogKiAgICAgICAgICAgIGdyaWRJbmRleCAvIGdyaWRJZCAvIGdyaWROYW1lLAogKiAgICAgICAgICAgIC4uLiAoY2FuIGJlIGV4dGVuZGVkKQogKiAgICAgICAgfQogKiBAcGFyYW0ge0FycmF5fG51bWJlcn0gdmFsdWUKICogQHJldHVybiB7Ym9vbGVhbn0gcmVzdWx0CiAqLwoKCmVjaGFydHNQcm90by5jb250YWluUGl4ZWwgPSBmdW5jdGlvbiAoZmluZGVyLCB2YWx1ZSkgewogIGlmICh0aGlzLl9kaXNwb3NlZCkgewogICAgZGlzcG9zZWRXYXJuaW5nKHRoaXMuaWQpOwogICAgcmV0dXJuOwogIH0KCiAgdmFyIGVjTW9kZWwgPSB0aGlzLl9tb2RlbDsKICB2YXIgcmVzdWx0OwogIGZpbmRlciA9IG1vZGVsVXRpbC5wYXJzZUZpbmRlcihlY01vZGVsLCBmaW5kZXIpOwogIHpyVXRpbC5lYWNoKGZpbmRlciwgZnVuY3Rpb24gKG1vZGVscywga2V5KSB7CiAgICBrZXkuaW5kZXhPZignTW9kZWxzJykgPj0gMCAmJiB6clV0aWwuZWFjaChtb2RlbHMsIGZ1bmN0aW9uIChtb2RlbCkgewogICAgICB2YXIgY29vcmRTeXMgPSBtb2RlbC5jb29yZGluYXRlU3lzdGVtOwoKICAgICAgaWYgKGNvb3JkU3lzICYmIGNvb3JkU3lzLmNvbnRhaW5Qb2ludCkgewogICAgICAgIHJlc3VsdCB8PSAhIWNvb3JkU3lzLmNvbnRhaW5Qb2ludCh2YWx1ZSk7CiAgICAgIH0gZWxzZSBpZiAoa2V5ID09PSAnc2VyaWVzTW9kZWxzJykgewogICAgICAgIHZhciB2aWV3ID0gdGhpcy5fY2hhcnRzTWFwW21vZGVsLl9fdmlld0lkXTsKCiAgICAgICAgaWYgKHZpZXcgJiYgdmlldy5jb250YWluUG9pbnQpIHsKICAgICAgICAgIHJlc3VsdCB8PSB2aWV3LmNvbnRhaW5Qb2ludCh2YWx1ZSwgbW9kZWwpOwogICAgICAgIH0gZWxzZSB7fQogICAgICB9IGVsc2Uge30KICAgIH0sIHRoaXMpOwogIH0sIHRoaXMpOwogIHJldHVybiAhIXJlc3VsdDsKfTsKLyoqCiAqIEdldCB2aXN1YWwgZnJvbSBzZXJpZXMgb3IgZGF0YS4KICogQHBhcmFtIHtzdHJpbmd8T2JqZWN0fSBmaW5kZXIKICogICAgICAgIElmIHN0cmluZywgZS5nLiwgJ3NlcmllcycsIG1lYW5zIHtzZXJpZXNJbmRleDogMH0uCiAqICAgICAgICBJZiBPYmplY3QsIGNvdWxkIGNvbnRhaW4gc29tZSBvZiB0aGVzZSBwcm9wZXJ0aWVzIGJlbG93OgogKiAgICAgICAgewogKiAgICAgICAgICAgIHNlcmllc0luZGV4IC8gc2VyaWVzSWQgLyBzZXJpZXNOYW1lLAogKiAgICAgICAgICAgIGRhdGFJbmRleCAvIGRhdGFJbmRleEluc2lkZQogKiAgICAgICAgfQogKiAgICAgICAgSWYgZGF0YUluZGV4IGlzIG5vdCBzcGVjaWZpZWQsIHNlcmllcyB2aXN1YWwgd2lsbCBiZSBmZXRjaGVkLAogKiAgICAgICAgYnV0IG5vdCBkYXRhIGl0ZW0gdmlzdWFsLgogKiAgICAgICAgSWYgYWxsIG9mIHNlcmllc0luZGV4LCBzZXJpZXNJZCwgc2VyaWVzTmFtZSBhcmUgbm90IHNwZWNpZmllZCwKICogICAgICAgIHZpc3VhbCB3aWxsIGJlIGZldGNoZWQgZnJvbSBmaXJzdCBzZXJpZXMuCiAqIEBwYXJhbSB7c3RyaW5nfSB2aXN1YWxUeXBlICdjb2xvcicsICdzeW1ib2wnLCAnc3ltYm9sU2l6ZScKICovCgoKZWNoYXJ0c1Byb3RvLmdldFZpc3VhbCA9IGZ1bmN0aW9uIChmaW5kZXIsIHZpc3VhbFR5cGUpIHsKICB2YXIgZWNNb2RlbCA9IHRoaXMuX21vZGVsOwogIGZpbmRlciA9IG1vZGVsVXRpbC5wYXJzZUZpbmRlcihlY01vZGVsLCBmaW5kZXIsIHsKICAgIGRlZmF1bHRNYWluVHlwZTogJ3NlcmllcycKICB9KTsKICB2YXIgc2VyaWVzTW9kZWwgPSBmaW5kZXIuc2VyaWVzTW9kZWw7CiAgdmFyIGRhdGEgPSBzZXJpZXNNb2RlbC5nZXREYXRhKCk7CiAgdmFyIGRhdGFJbmRleEluc2lkZSA9IGZpbmRlci5oYXNPd25Qcm9wZXJ0eSgnZGF0YUluZGV4SW5zaWRlJykgPyBmaW5kZXIuZGF0YUluZGV4SW5zaWRlIDogZmluZGVyLmhhc093blByb3BlcnR5KCdkYXRhSW5kZXgnKSA/IGRhdGEuaW5kZXhPZlJhd0luZGV4KGZpbmRlci5kYXRhSW5kZXgpIDogbnVsbDsKICByZXR1cm4gZGF0YUluZGV4SW5zaWRlICE9IG51bGwgPyBkYXRhLmdldEl0ZW1WaXN1YWwoZGF0YUluZGV4SW5zaWRlLCB2aXN1YWxUeXBlKSA6IGRhdGEuZ2V0VmlzdWFsKHZpc3VhbFR5cGUpOwp9OwovKioKICogR2V0IHZpZXcgb2YgY29ycmVzcG9uZGluZyBjb21wb25lbnQgbW9kZWwKICogQHBhcmFtICB7bW9kdWxlOmVjaGFydHMvbW9kZWwvQ29tcG9uZW50fSBjb21wb25lbnRNb2RlbAogKiBAcmV0dXJuIHttb2R1bGU6ZWNoYXJ0cy92aWV3L0NvbXBvbmVudH0KICovCgoKZWNoYXJ0c1Byb3RvLmdldFZpZXdPZkNvbXBvbmVudE1vZGVsID0gZnVuY3Rpb24gKGNvbXBvbmVudE1vZGVsKSB7CiAgcmV0dXJuIHRoaXMuX2NvbXBvbmVudHNNYXBbY29tcG9uZW50TW9kZWwuX192aWV3SWRdOwp9OwovKioKICogR2V0IHZpZXcgb2YgY29ycmVzcG9uZGluZyBzZXJpZXMgbW9kZWwKICogQHBhcmFtICB7bW9kdWxlOmVjaGFydHMvbW9kZWwvU2VyaWVzfSBzZXJpZXNNb2RlbAogKiBAcmV0dXJuIHttb2R1bGU6ZWNoYXJ0cy92aWV3L0NoYXJ0fQogKi8KCgplY2hhcnRzUHJvdG8uZ2V0Vmlld09mU2VyaWVzTW9kZWwgPSBmdW5jdGlvbiAoc2VyaWVzTW9kZWwpIHsKICByZXR1cm4gdGhpcy5fY2hhcnRzTWFwW3Nlcmllc01vZGVsLl9fdmlld0lkXTsKfTsKCnZhciB1cGRhdGVNZXRob2RzID0gewogIHByZXBhcmVBbmRVcGRhdGU6IGZ1bmN0aW9uIHByZXBhcmVBbmRVcGRhdGUocGF5bG9hZCkgewogICAgcHJlcGFyZSh0aGlzKTsKICAgIHVwZGF0ZU1ldGhvZHMudXBkYXRlLmNhbGwodGhpcywgcGF5bG9hZCk7CiAgfSwKCiAgLyoqCiAgICogQHBhcmFtIHtPYmplY3R9IHBheWxvYWQKICAgKiBAcHJpdmF0ZQogICAqLwogIHVwZGF0ZTogZnVuY3Rpb24gdXBkYXRlKHBheWxvYWQpIHsKICAgIC8vIGNvbnNvbGUucHJvZmlsZSAmJiBjb25zb2xlLnByb2ZpbGUoJ3VwZGF0ZScpOwogICAgdmFyIGVjTW9kZWwgPSB0aGlzLl9tb2RlbDsKICAgIHZhciBhcGkgPSB0aGlzLl9hcGk7CiAgICB2YXIgenIgPSB0aGlzLl96cjsKICAgIHZhciBjb29yZFN5c01nciA9IHRoaXMuX2Nvb3JkU3lzTWdyOwogICAgdmFyIHNjaGVkdWxlciA9IHRoaXMuX3NjaGVkdWxlcjsgLy8gdXBkYXRlIGJlZm9yZSBzZXRPcHRpb24KCiAgICBpZiAoIWVjTW9kZWwpIHsKICAgICAgcmV0dXJuOwogICAgfQoKICAgIHNjaGVkdWxlci5yZXN0b3JlRGF0YShlY01vZGVsLCBwYXlsb2FkKTsKICAgIHNjaGVkdWxlci5wZXJmb3JtU2VyaWVzVGFza3MoZWNNb2RlbCk7IC8vIFRPRE8KICAgIC8vIFNhdmUgdG90YWwgZWNNb2RlbCBoZXJlIGZvciB1bmRvL3JlZG8gKGFmdGVyIHJlc3RvcmluZyBkYXRhIGFuZCBiZWZvcmUgcHJvY2Vzc2luZyBkYXRhKS4KICAgIC8vIFVuZG8gKHJlc3RvcmF0aW9uIG9mIHRvdGFsIGVjTW9kZWwpIGNhbiBiZSBjYXJyaWVkIG91dCBpbiAnYWN0aW9uJyBvciBvdXRzaWRlIEFQSSBjYWxsLgogICAgLy8gQ3JlYXRlIG5ldyBjb29yZGluYXRlIHN5c3RlbSBlYWNoIHVwZGF0ZQogICAgLy8gSW4gTGluZVZpZXcgbWF5IHNhdmUgdGhlIG9sZCBjb29yZGluYXRlIHN5c3RlbSBhbmQgdXNlIGl0IHRvIGdldCB0aGUgb3JpZ25hbCBwb2ludAoKICAgIGNvb3JkU3lzTWdyLmNyZWF0ZShlY01vZGVsLCBhcGkpOwogICAgc2NoZWR1bGVyLnBlcmZvcm1EYXRhUHJvY2Vzc29yVGFza3MoZWNNb2RlbCwgcGF5bG9hZCk7IC8vIEN1cnJlbnQgc3RyZWFtIHJlbmRlciBpcyBub3Qgc3VwcG9ydGVkIGluIGRhdGEgcHJvY2Vzcy4gU28gd2UgY2FuIHVwZGF0ZQogICAgLy8gc3RyZWFtIG1vZGVzIGFmdGVyIGRhdGEgcHJvY2Vzc2luZywgd2hlcmUgdGhlIGZpbHRlcmVkIGRhdGEgaXMgdXNlZCB0bwogICAgLy8gZGV0ZW1pbmcgd2hldGhlciB1c2UgcHJvZ3Jlc3NpdmUgcmVuZGVyaW5nLgoKICAgIHVwZGF0ZVN0cmVhbU1vZGVzKHRoaXMsIGVjTW9kZWwpOyAvLyBXZSB1cGRhdGUgc3RyZWFtIG1vZGVzIGJlZm9yZSBjb29yZGluYXRlIHN5c3RlbSB1cGRhdGVkLCB0aGVuIHRoZSBtb2RlcyBpbmZvCiAgICAvLyBjYW4gYmUgZmV0Y2hlZCB3aGVuIGNvb3JkIHN5cyB1cGRhdGluZyAoY29uc2lkZXIgdGhlIGJhckdyaWQgZXh0ZW50IGZpeCkuIEJ1dAogICAgLy8gdGhlIGRyYXdiYWNrIGlzIHRoZSBmdWxsIGNvb3JkIGluZm8gY2FuIG5vdCBiZSBmZXRjaGVkLiBGb3J0dW5hdGVseSB0aGlzIGZ1bGwKICAgIC8vIGNvb3JkIGlzIG5vdCByZXF1aWVkIGluIHN0cmVhbSBtb2RlIHVwZGF0ZXIgY3VycmVudGx5LgoKICAgIGNvb3JkU3lzTWdyLnVwZGF0ZShlY01vZGVsLCBhcGkpOwogICAgY2xlYXJDb2xvclBhbGV0dGUoZWNNb2RlbCk7CiAgICBzY2hlZHVsZXIucGVyZm9ybVZpc3VhbFRhc2tzKGVjTW9kZWwsIHBheWxvYWQpOwogICAgcmVuZGVyKHRoaXMsIGVjTW9kZWwsIGFwaSwgcGF5bG9hZCk7IC8vIFNldCBiYWNrZ3JvdW5kCgogICAgdmFyIGJhY2tncm91bmRDb2xvciA9IGVjTW9kZWwuZ2V0KCdiYWNrZ3JvdW5kQ29sb3InKSB8fCAndHJhbnNwYXJlbnQnOyAvLyBJbiBJRTgKCiAgICBpZiAoIWVudi5jYW52YXNTdXBwb3J0ZWQpIHsKICAgICAgdmFyIGNvbG9yQXJyID0gY29sb3JUb29sLnBhcnNlKGJhY2tncm91bmRDb2xvcik7CiAgICAgIGJhY2tncm91bmRDb2xvciA9IGNvbG9yVG9vbC5zdHJpbmdpZnkoY29sb3JBcnIsICdyZ2InKTsKCiAgICAgIGlmIChjb2xvckFyclszXSA9PT0gMCkgewogICAgICAgIGJhY2tncm91bmRDb2xvciA9ICd0cmFuc3BhcmVudCc7CiAgICAgIH0KICAgIH0gZWxzZSB7CiAgICAgIHpyLnNldEJhY2tncm91bmRDb2xvcihiYWNrZ3JvdW5kQ29sb3IpOwogICAgfQoKICAgIHBlcmZvcm1Qb3N0VXBkYXRlRnVuY3MoZWNNb2RlbCwgYXBpKTsgLy8gY29uc29sZS5wcm9maWxlICYmIGNvbnNvbGUucHJvZmlsZUVuZCgndXBkYXRlJyk7CiAgfSwKCiAgLyoqCiAgICogQHBhcmFtIHtPYmplY3R9IHBheWxvYWQKICAgKiBAcHJpdmF0ZQogICAqLwogIHVwZGF0ZVRyYW5zZm9ybTogZnVuY3Rpb24gdXBkYXRlVHJhbnNmb3JtKHBheWxvYWQpIHsKICAgIHZhciBlY01vZGVsID0gdGhpcy5fbW9kZWw7CiAgICB2YXIgZWNJbnMgPSB0aGlzOwogICAgdmFyIGFwaSA9IHRoaXMuX2FwaTsgLy8gdXBkYXRlIGJlZm9yZSBzZXRPcHRpb24KCiAgICBpZiAoIWVjTW9kZWwpIHsKICAgICAgcmV0dXJuOwogICAgfSAvLyBDaGFydFZpZXcubWFya1VwZGF0ZU1ldGhvZChwYXlsb2FkLCAndXBkYXRlVHJhbnNmb3JtJyk7CgoKICAgIHZhciBjb21wb25lbnREaXJ0eUxpc3QgPSBbXTsKICAgIGVjTW9kZWwuZWFjaENvbXBvbmVudChmdW5jdGlvbiAoY29tcG9uZW50VHlwZSwgY29tcG9uZW50TW9kZWwpIHsKICAgICAgdmFyIGNvbXBvbmVudFZpZXcgPSBlY0lucy5nZXRWaWV3T2ZDb21wb25lbnRNb2RlbChjb21wb25lbnRNb2RlbCk7CgogICAgICBpZiAoY29tcG9uZW50VmlldyAmJiBjb21wb25lbnRWaWV3Ll9fYWxpdmUpIHsKICAgICAgICBpZiAoY29tcG9uZW50Vmlldy51cGRhdGVUcmFuc2Zvcm0pIHsKICAgICAgICAgIHZhciByZXN1bHQgPSBjb21wb25lbnRWaWV3LnVwZGF0ZVRyYW5zZm9ybShjb21wb25lbnRNb2RlbCwgZWNNb2RlbCwgYXBpLCBwYXlsb2FkKTsKICAgICAgICAgIHJlc3VsdCAmJiByZXN1bHQudXBkYXRlICYmIGNvbXBvbmVudERpcnR5TGlzdC5wdXNoKGNvbXBvbmVudFZpZXcpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBjb21wb25lbnREaXJ0eUxpc3QucHVzaChjb21wb25lbnRWaWV3KTsKICAgICAgICB9CiAgICAgIH0KICAgIH0pOwogICAgdmFyIHNlcmllc0RpcnR5TWFwID0genJVdGlsLmNyZWF0ZUhhc2hNYXAoKTsKICAgIGVjTW9kZWwuZWFjaFNlcmllcyhmdW5jdGlvbiAoc2VyaWVzTW9kZWwpIHsKICAgICAgdmFyIGNoYXJ0VmlldyA9IGVjSW5zLl9jaGFydHNNYXBbc2VyaWVzTW9kZWwuX192aWV3SWRdOwoKICAgICAgaWYgKGNoYXJ0Vmlldy51cGRhdGVUcmFuc2Zvcm0pIHsKICAgICAgICB2YXIgcmVzdWx0ID0gY2hhcnRWaWV3LnVwZGF0ZVRyYW5zZm9ybShzZXJpZXNNb2RlbCwgZWNNb2RlbCwgYXBpLCBwYXlsb2FkKTsKICAgICAgICByZXN1bHQgJiYgcmVzdWx0LnVwZGF0ZSAmJiBzZXJpZXNEaXJ0eU1hcC5zZXQoc2VyaWVzTW9kZWwudWlkLCAxKTsKICAgICAgfSBlbHNlIHsKICAgICAgICBzZXJpZXNEaXJ0eU1hcC5zZXQoc2VyaWVzTW9kZWwudWlkLCAxKTsKICAgICAgfQogICAgfSk7CiAgICBjbGVhckNvbG9yUGFsZXR0ZShlY01vZGVsKTsgLy8gS2VlcCBwaXBlIHRvIHRoZSBleGlzdCBwaXBlbGluZSBiZWNhdXNlIGl0IGRlcGVuZHMgb24gdGhlIHJlbmRlciB0YXNrIG9mIHRoZSBmdWxsIHBpcGVsaW5lLgogICAgLy8gdGhpcy5fc2NoZWR1bGVyLnBlcmZvcm1WaXN1YWxUYXNrcyhlY01vZGVsLCBwYXlsb2FkLCAnbGF5b3V0JywgdHJ1ZSk7CgogICAgdGhpcy5fc2NoZWR1bGVyLnBlcmZvcm1WaXN1YWxUYXNrcyhlY01vZGVsLCBwYXlsb2FkLCB7CiAgICAgIHNldERpcnR5OiB0cnVlLAogICAgICBkaXJ0eU1hcDogc2VyaWVzRGlydHlNYXAKICAgIH0pOyAvLyBDdXJyZW50bHksIG5vdCBjYWxsIHJlbmRlciBvZiBjb21wb25lbnRzLiBHZW8gcmVuZGVyIGNvc3QgYSBsb3QuCiAgICAvLyByZW5kZXJDb21wb25lbnRzKGVjSW5zLCBlY01vZGVsLCBhcGksIHBheWxvYWQsIGNvbXBvbmVudERpcnR5TGlzdCk7CgoKICAgIHJlbmRlclNlcmllcyhlY0lucywgZWNNb2RlbCwgYXBpLCBwYXlsb2FkLCBzZXJpZXNEaXJ0eU1hcCk7CiAgICBwZXJmb3JtUG9zdFVwZGF0ZUZ1bmNzKGVjTW9kZWwsIHRoaXMuX2FwaSk7CiAgfSwKCiAgLyoqCiAgICogQHBhcmFtIHtPYmplY3R9IHBheWxvYWQKICAgKiBAcHJpdmF0ZQogICAqLwogIHVwZGF0ZVZpZXc6IGZ1bmN0aW9uIHVwZGF0ZVZpZXcocGF5bG9hZCkgewogICAgdmFyIGVjTW9kZWwgPSB0aGlzLl9tb2RlbDsgLy8gdXBkYXRlIGJlZm9yZSBzZXRPcHRpb24KCiAgICBpZiAoIWVjTW9kZWwpIHsKICAgICAgcmV0dXJuOwogICAgfQoKICAgIENoYXJ0Vmlldy5tYXJrVXBkYXRlTWV0aG9kKHBheWxvYWQsICd1cGRhdGVWaWV3Jyk7CiAgICBjbGVhckNvbG9yUGFsZXR0ZShlY01vZGVsKTsgLy8gS2VlcCBwaXBlIHRvIHRoZSBleGlzdCBwaXBlbGluZSBiZWNhdXNlIGl0IGRlcGVuZHMgb24gdGhlIHJlbmRlciB0YXNrIG9mIHRoZSBmdWxsIHBpcGVsaW5lLgoKICAgIHRoaXMuX3NjaGVkdWxlci5wZXJmb3JtVmlzdWFsVGFza3MoZWNNb2RlbCwgcGF5bG9hZCwgewogICAgICBzZXREaXJ0eTogdHJ1ZQogICAgfSk7CgogICAgcmVuZGVyKHRoaXMsIHRoaXMuX21vZGVsLCB0aGlzLl9hcGksIHBheWxvYWQpOwogICAgcGVyZm9ybVBvc3RVcGRhdGVGdW5jcyhlY01vZGVsLCB0aGlzLl9hcGkpOwogIH0sCgogIC8qKgogICAqIEBwYXJhbSB7T2JqZWN0fSBwYXlsb2FkCiAgICogQHByaXZhdGUKICAgKi8KICB1cGRhdGVWaXN1YWw6IGZ1bmN0aW9uIHVwZGF0ZVZpc3VhbChwYXlsb2FkKSB7CiAgICB1cGRhdGVNZXRob2RzLnVwZGF0ZS5jYWxsKHRoaXMsIHBheWxvYWQpOyAvLyB2YXIgZWNNb2RlbCA9IHRoaXMuX21vZGVsOwogICAgLy8gLy8gdXBkYXRlIGJlZm9yZSBzZXRPcHRpb24KICAgIC8vIGlmICghZWNNb2RlbCkgewogICAgLy8gICAgIHJldHVybjsKICAgIC8vIH0KICAgIC8vIENoYXJ0Vmlldy5tYXJrVXBkYXRlTWV0aG9kKHBheWxvYWQsICd1cGRhdGVWaXN1YWwnKTsKICAgIC8vIGNsZWFyQ29sb3JQYWxldHRlKGVjTW9kZWwpOwogICAgLy8gLy8gS2VlcCBwaXBlIHRvIHRoZSBleGlzdCBwaXBlbGluZSBiZWNhdXNlIGl0IGRlcGVuZHMgb24gdGhlIHJlbmRlciB0YXNrIG9mIHRoZSBmdWxsIHBpcGVsaW5lLgogICAgLy8gdGhpcy5fc2NoZWR1bGVyLnBlcmZvcm1WaXN1YWxUYXNrcyhlY01vZGVsLCBwYXlsb2FkLCB7dmlzdWFsVHlwZTogJ3Zpc3VhbCcsIHNldERpcnR5OiB0cnVlfSk7CiAgICAvLyByZW5kZXIodGhpcywgdGhpcy5fbW9kZWwsIHRoaXMuX2FwaSwgcGF5bG9hZCk7CiAgICAvLyBwZXJmb3JtUG9zdFVwZGF0ZUZ1bmNzKGVjTW9kZWwsIHRoaXMuX2FwaSk7CiAgfSwKCiAgLyoqCiAgICogQHBhcmFtIHtPYmplY3R9IHBheWxvYWQKICAgKiBAcHJpdmF0ZQogICAqLwogIHVwZGF0ZUxheW91dDogZnVuY3Rpb24gdXBkYXRlTGF5b3V0KHBheWxvYWQpIHsKICAgIHVwZGF0ZU1ldGhvZHMudXBkYXRlLmNhbGwodGhpcywgcGF5bG9hZCk7IC8vIHZhciBlY01vZGVsID0gdGhpcy5fbW9kZWw7CiAgICAvLyAvLyB1cGRhdGUgYmVmb3JlIHNldE9wdGlvbgogICAgLy8gaWYgKCFlY01vZGVsKSB7CiAgICAvLyAgICAgcmV0dXJuOwogICAgLy8gfQogICAgLy8gQ2hhcnRWaWV3Lm1hcmtVcGRhdGVNZXRob2QocGF5bG9hZCwgJ3VwZGF0ZUxheW91dCcpOwogICAgLy8gLy8gS2VlcCBwaXBlIHRvIHRoZSBleGlzdCBwaXBlbGluZSBiZWNhdXNlIGl0IGRlcGVuZHMgb24gdGhlIHJlbmRlciB0YXNrIG9mIHRoZSBmdWxsIHBpcGVsaW5lLgogICAgLy8gLy8gdGhpcy5fc2NoZWR1bGVyLnBlcmZvcm1WaXN1YWxUYXNrcyhlY01vZGVsLCBwYXlsb2FkLCAnbGF5b3V0JywgdHJ1ZSk7CiAgICAvLyB0aGlzLl9zY2hlZHVsZXIucGVyZm9ybVZpc3VhbFRhc2tzKGVjTW9kZWwsIHBheWxvYWQsIHtzZXREaXJ0eTogdHJ1ZX0pOwogICAgLy8gcmVuZGVyKHRoaXMsIHRoaXMuX21vZGVsLCB0aGlzLl9hcGksIHBheWxvYWQpOwogICAgLy8gcGVyZm9ybVBvc3RVcGRhdGVGdW5jcyhlY01vZGVsLCB0aGlzLl9hcGkpOwogIH0KfTsKCmZ1bmN0aW9uIHByZXBhcmUoZWNJbnMpIHsKICB2YXIgZWNNb2RlbCA9IGVjSW5zLl9tb2RlbDsKICB2YXIgc2NoZWR1bGVyID0gZWNJbnMuX3NjaGVkdWxlcjsKICBzY2hlZHVsZXIucmVzdG9yZVBpcGVsaW5lcyhlY01vZGVsKTsKICBzY2hlZHVsZXIucHJlcGFyZVN0YWdlVGFza3MoKTsKICBwcmVwYXJlVmlldyhlY0lucywgJ2NvbXBvbmVudCcsIGVjTW9kZWwsIHNjaGVkdWxlcik7CiAgcHJlcGFyZVZpZXcoZWNJbnMsICdjaGFydCcsIGVjTW9kZWwsIHNjaGVkdWxlcik7CiAgc2NoZWR1bGVyLnBsYW4oKTsKfQovKioKICogQHByaXZhdGUKICovCgoKZnVuY3Rpb24gdXBkYXRlRGlyZWN0bHkoZWNJbnMsIG1ldGhvZCwgcGF5bG9hZCwgbWFpblR5cGUsIHN1YlR5cGUpIHsKICB2YXIgZWNNb2RlbCA9IGVjSW5zLl9tb2RlbDsgLy8gYnJvYWRjYXN0CgogIGlmICghbWFpblR5cGUpIHsKICAgIC8vIEZJWE1FCiAgICAvLyBDaGFydCB3aWxsIG5vdCBiZSB1cGRhdGUgZGlyZWN0bHkgaGVyZSwgZXhjZXB0IHNldCBkaXJ0eS4KICAgIC8vIEJ1dCB0aGVyZSBpcyBubyBzdWNoIHNjZW5hcmlvIG5vdy4KICAgIGVhY2goZWNJbnMuX2NvbXBvbmVudHNWaWV3cy5jb25jYXQoZWNJbnMuX2NoYXJ0c1ZpZXdzKSwgY2FsbFZpZXcpOwogICAgcmV0dXJuOwogIH0KCiAgdmFyIHF1ZXJ5ID0ge307CiAgcXVlcnlbbWFpblR5cGUgKyAnSWQnXSA9IHBheWxvYWRbbWFpblR5cGUgKyAnSWQnXTsKICBxdWVyeVttYWluVHlwZSArICdJbmRleCddID0gcGF5bG9hZFttYWluVHlwZSArICdJbmRleCddOwogIHF1ZXJ5W21haW5UeXBlICsgJ05hbWUnXSA9IHBheWxvYWRbbWFpblR5cGUgKyAnTmFtZSddOwogIHZhciBjb25kaXRpb24gPSB7CiAgICBtYWluVHlwZTogbWFpblR5cGUsCiAgICBxdWVyeTogcXVlcnkKICB9OwogIHN1YlR5cGUgJiYgKGNvbmRpdGlvbi5zdWJUeXBlID0gc3ViVHlwZSk7IC8vIHN1YlR5cGUgbWF5IGJlICcnIGJ5IHBhcnNlQ2xhc3NUeXBlOwoKICB2YXIgZXhjbHVkZVNlcmllc0lkID0gcGF5bG9hZC5leGNsdWRlU2VyaWVzSWQ7CgogIGlmIChleGNsdWRlU2VyaWVzSWQgIT0gbnVsbCkgewogICAgZXhjbHVkZVNlcmllc0lkID0genJVdGlsLmNyZWF0ZUhhc2hNYXAobW9kZWxVdGlsLm5vcm1hbGl6ZVRvQXJyYXkoZXhjbHVkZVNlcmllc0lkKSk7CiAgfSAvLyBJZiBkaXNwYXRjaEFjdGlvbiBiZWZvcmUgc2V0T3B0aW9uLCBkbyBub3RoaW5nLgoKCiAgZWNNb2RlbCAmJiBlY01vZGVsLmVhY2hDb21wb25lbnQoY29uZGl0aW9uLCBmdW5jdGlvbiAobW9kZWwpIHsKICAgIGlmICghZXhjbHVkZVNlcmllc0lkIHx8IGV4Y2x1ZGVTZXJpZXNJZC5nZXQobW9kZWwuaWQpID09IG51bGwpIHsKICAgICAgY2FsbFZpZXcoZWNJbnNbbWFpblR5cGUgPT09ICdzZXJpZXMnID8gJ19jaGFydHNNYXAnIDogJ19jb21wb25lbnRzTWFwJ11bbW9kZWwuX192aWV3SWRdKTsKICAgIH0KICB9LCBlY0lucyk7CgogIGZ1bmN0aW9uIGNhbGxWaWV3KHZpZXcpIHsKICAgIHZpZXcgJiYgdmlldy5fX2FsaXZlICYmIHZpZXdbbWV0aG9kXSAmJiB2aWV3W21ldGhvZF0odmlldy5fX21vZGVsLCBlY01vZGVsLCBlY0lucy5fYXBpLCBwYXlsb2FkKTsKICB9Cn0KLyoqCiAqIFJlc2l6ZSB0aGUgY2hhcnQKICogQHBhcmFtIHtPYmplY3R9IG9wdHMKICogQHBhcmFtIHtudW1iZXJ9IFtvcHRzLndpZHRoXSBDYW4gYmUgJ2F1dG8nICh0aGUgc2FtZSBhcyBudWxsL3VuZGVmaW5lZCkKICogQHBhcmFtIHtudW1iZXJ9IFtvcHRzLmhlaWdodF0gQ2FuIGJlICdhdXRvJyAodGhlIHNhbWUgYXMgbnVsbC91bmRlZmluZWQpCiAqIEBwYXJhbSB7Ym9vbGVhbn0gW29wdHMuc2lsZW50PWZhbHNlXQogKi8KCgplY2hhcnRzUHJvdG8ucmVzaXplID0gZnVuY3Rpb24gKG9wdHMpIHsKICBpZiAodGhpcy5fZGlzcG9zZWQpIHsKICAgIGRpc3Bvc2VkV2FybmluZyh0aGlzLmlkKTsKICAgIHJldHVybjsKICB9CgogIHRoaXMuX3pyLnJlc2l6ZShvcHRzKTsKCiAgdmFyIGVjTW9kZWwgPSB0aGlzLl9tb2RlbDsgLy8gUmVzaXplIGxvYWRpbmcgZWZmZWN0CgogIHRoaXMuX2xvYWRpbmdGWCAmJiB0aGlzLl9sb2FkaW5nRlgucmVzaXplKCk7CgogIGlmICghZWNNb2RlbCkgewogICAgcmV0dXJuOwogIH0KCiAgdmFyIG9wdGlvbkNoYW5nZWQgPSBlY01vZGVsLnJlc2V0T3B0aW9uKCdtZWRpYScpOwogIHZhciBzaWxlbnQgPSBvcHRzICYmIG9wdHMuc2lsZW50OwogIHRoaXNbSU5fTUFJTl9QUk9DRVNTXSA9IHRydWU7CiAgb3B0aW9uQ2hhbmdlZCAmJiBwcmVwYXJlKHRoaXMpOwogIHVwZGF0ZU1ldGhvZHMudXBkYXRlLmNhbGwodGhpcyk7CiAgdGhpc1tJTl9NQUlOX1BST0NFU1NdID0gZmFsc2U7CiAgZmx1c2hQZW5kaW5nQWN0aW9ucy5jYWxsKHRoaXMsIHNpbGVudCk7CiAgdHJpZ2dlclVwZGF0ZWRFdmVudC5jYWxsKHRoaXMsIHNpbGVudCk7Cn07CgpmdW5jdGlvbiB1cGRhdGVTdHJlYW1Nb2RlcyhlY0lucywgZWNNb2RlbCkgewogIHZhciBjaGFydHNNYXAgPSBlY0lucy5fY2hhcnRzTWFwOwogIHZhciBzY2hlZHVsZXIgPSBlY0lucy5fc2NoZWR1bGVyOwogIGVjTW9kZWwuZWFjaFNlcmllcyhmdW5jdGlvbiAoc2VyaWVzTW9kZWwpIHsKICAgIHNjaGVkdWxlci51cGRhdGVTdHJlYW1Nb2RlcyhzZXJpZXNNb2RlbCwgY2hhcnRzTWFwW3Nlcmllc01vZGVsLl9fdmlld0lkXSk7CiAgfSk7Cn0KLyoqCiAqIFNob3cgbG9hZGluZyBlZmZlY3QKICogQHBhcmFtICB7c3RyaW5nfSBbbmFtZT0nZGVmYXVsdCddCiAqIEBwYXJhbSAge09iamVjdH0gW2NmZ10KICovCgoKZWNoYXJ0c1Byb3RvLnNob3dMb2FkaW5nID0gZnVuY3Rpb24gKG5hbWUsIGNmZykgewogIGlmICh0aGlzLl9kaXNwb3NlZCkgewogICAgZGlzcG9zZWRXYXJuaW5nKHRoaXMuaWQpOwogICAgcmV0dXJuOwogIH0KCiAgaWYgKGlzT2JqZWN0KG5hbWUpKSB7CiAgICBjZmcgPSBuYW1lOwogICAgbmFtZSA9ICcnOwogIH0KCiAgbmFtZSA9IG5hbWUgfHwgJ2RlZmF1bHQnOwogIHRoaXMuaGlkZUxvYWRpbmcoKTsKCiAgaWYgKCFsb2FkaW5nRWZmZWN0c1tuYW1lXSkgewogICAgcmV0dXJuOwogIH0KCiAgdmFyIGVsID0gbG9hZGluZ0VmZmVjdHNbbmFtZV0odGhpcy5fYXBpLCBjZmcpOwogIHZhciB6ciA9IHRoaXMuX3pyOwogIHRoaXMuX2xvYWRpbmdGWCA9IGVsOwogIHpyLmFkZChlbCk7Cn07Ci8qKgogKiBIaWRlIGxvYWRpbmcgZWZmZWN0CiAqLwoKCmVjaGFydHNQcm90by5oaWRlTG9hZGluZyA9IGZ1bmN0aW9uICgpIHsKICBpZiAodGhpcy5fZGlzcG9zZWQpIHsKICAgIGRpc3Bvc2VkV2FybmluZyh0aGlzLmlkKTsKICAgIHJldHVybjsKICB9CgogIHRoaXMuX2xvYWRpbmdGWCAmJiB0aGlzLl96ci5yZW1vdmUodGhpcy5fbG9hZGluZ0ZYKTsKICB0aGlzLl9sb2FkaW5nRlggPSBudWxsOwp9OwovKioKICogQHBhcmFtIHtPYmplY3R9IGV2ZW50T2JqCiAqIEByZXR1cm4ge09iamVjdH0KICovCgoKZWNoYXJ0c1Byb3RvLm1ha2VBY3Rpb25Gcm9tRXZlbnQgPSBmdW5jdGlvbiAoZXZlbnRPYmopIHsKICB2YXIgcGF5bG9hZCA9IHpyVXRpbC5leHRlbmQoe30sIGV2ZW50T2JqKTsKICBwYXlsb2FkLnR5cGUgPSBldmVudEFjdGlvbk1hcFtldmVudE9iai50eXBlXTsKICByZXR1cm4gcGF5bG9hZDsKfTsKLyoqCiAqIEBwdWJpbGMKICogQHBhcmFtIHtPYmplY3R9IHBheWxvYWQKICogQHBhcmFtIHtzdHJpbmd9IFtwYXlsb2FkLnR5cGVdIEFjdGlvbiB0eXBlCiAqIEBwYXJhbSB7T2JqZWN0fGJvb2xlYW59IFtvcHRdIElmIHBhc3MgYm9vbGVhbiwgbWVhbnMgb3B0LnNpbGVudAogKiBAcGFyYW0ge2Jvb2xlYW59IFtvcHQuc2lsZW50PWZhbHNlXSBXaGV0aGVyIHRyaWdnZXIgZXZlbnRzLgogKiBAcGFyYW0ge2Jvb2xlYW59IFtvcHQuZmx1c2g9dW5kZWZpbmVkXQogKiAgICAgICAgICAgICAgICAgIHRydWU6IEZsdXNoIGltbWVkaWF0ZWx5LCBhbmQgdGhlbiBwaXhlbCBpbiBjYW52YXMgY2FuIGJlIGZldGNoZWQKICogICAgICAgICAgICAgICAgICAgICAgaW1tZWRpYXRlbHkuIENhdXRpb246IGl0IG1pZ2h0IGFmZmVjdCBwZXJmb3JtYW5jZS4KICogICAgICAgICAgICAgICAgICBmYWxzZTogTm90IGZsdXNoLgogKiAgICAgICAgICAgICAgICAgIHVuZGVmaW5lZDogQXV0byBkZWNpZGUgd2hldGhlciBwZXJmb3JtIGZsdXNoLgogKi8KCgplY2hhcnRzUHJvdG8uZGlzcGF0Y2hBY3Rpb24gPSBmdW5jdGlvbiAocGF5bG9hZCwgb3B0KSB7CiAgaWYgKHRoaXMuX2Rpc3Bvc2VkKSB7CiAgICBkaXNwb3NlZFdhcm5pbmcodGhpcy5pZCk7CiAgICByZXR1cm47CiAgfQoKICBpZiAoIWlzT2JqZWN0KG9wdCkpIHsKICAgIG9wdCA9IHsKICAgICAgc2lsZW50OiAhIW9wdAogICAgfTsKICB9CgogIGlmICghYWN0aW9uc1twYXlsb2FkLnR5cGVdKSB7CiAgICByZXR1cm47CiAgfSAvLyBBdm9pZCBkaXNwYXRjaCBhY3Rpb24gYmVmb3JlIHNldE9wdGlvbi4gRXNwZWNpYWxseSBpbiBgY29ubmVjdGAuCgoKICBpZiAoIXRoaXMuX21vZGVsKSB7CiAgICByZXR1cm47CiAgfSAvLyBNYXkgZGlzcGF0Y2hBY3Rpb24gaW4gcmVuZGVyaW5nIHByb2NlZHVyZQoKCiAgaWYgKHRoaXNbSU5fTUFJTl9QUk9DRVNTXSkgewogICAgdGhpcy5fcGVuZGluZ0FjdGlvbnMucHVzaChwYXlsb2FkKTsKCiAgICByZXR1cm47CiAgfQoKICBkb0Rpc3BhdGNoQWN0aW9uLmNhbGwodGhpcywgcGF5bG9hZCwgb3B0LnNpbGVudCk7CgogIGlmIChvcHQuZmx1c2gpIHsKICAgIHRoaXMuX3pyLmZsdXNoKHRydWUpOwogIH0gZWxzZSBpZiAob3B0LmZsdXNoICE9PSBmYWxzZSAmJiBlbnYuYnJvd3Nlci53ZUNoYXQpIHsKICAgIC8vIEluIFdlQ2hhdCBlbWJlZGVkIGJyb3dzZXIsIGByZXF1ZXN0QW5pbWF0aW9uRnJhbWVgIGFuZCBgc2V0SW50ZXJ2YWxgCiAgICAvLyBoYW5nIHdoZW4gc2xpZGluZyBwYWdlIChvbiB0b3VjaCBldmVudCksIHdoaWNoIGNhdXNlIHRoYXQgenIgZG9lcyBub3QKICAgIC8vIHJlZnJlc2ggdXRpbCB1c2VyIGludGVyYWN0aW9uIGZpbmlzaGVkLCB3aGljaCBpcyBub3QgZXhwZWN0ZWQuCiAgICAvLyBCdXQgYGRpc3BhdGNoQWN0aW9uYCBtYXkgYmUgY2FsbGVkIHRvbyBmcmVxdWVudGx5IHdoZW4gcGFuIG9uIHRvdWNoCiAgICAvLyBzY3JlZW4sIHdoaWNoIGltcGFjdHMgcGVyZm9ybWFuY2UgaWYgZG8gbm90IHRocm90dGxlIHRoZW0uCiAgICB0aGlzLl90aHJvdHRsZWRackZsdXNoKCk7CiAgfQoKICBmbHVzaFBlbmRpbmdBY3Rpb25zLmNhbGwodGhpcywgb3B0LnNpbGVudCk7CiAgdHJpZ2dlclVwZGF0ZWRFdmVudC5jYWxsKHRoaXMsIG9wdC5zaWxlbnQpOwp9OwoKZnVuY3Rpb24gZG9EaXNwYXRjaEFjdGlvbihwYXlsb2FkLCBzaWxlbnQpIHsKICB2YXIgcGF5bG9hZFR5cGUgPSBwYXlsb2FkLnR5cGU7CiAgdmFyIGVzY2FwZUNvbm5lY3QgPSBwYXlsb2FkLmVzY2FwZUNvbm5lY3Q7CiAgdmFyIGFjdGlvbldyYXAgPSBhY3Rpb25zW3BheWxvYWRUeXBlXTsKICB2YXIgYWN0aW9uSW5mbyA9IGFjdGlvbldyYXAuYWN0aW9uSW5mbzsKICB2YXIgY3B0VHlwZSA9IChhY3Rpb25JbmZvLnVwZGF0ZSB8fCAndXBkYXRlJykuc3BsaXQoJzonKTsKICB2YXIgdXBkYXRlTWV0aG9kID0gY3B0VHlwZS5wb3AoKTsKICBjcHRUeXBlID0gY3B0VHlwZVswXSAhPSBudWxsICYmIHBhcnNlQ2xhc3NUeXBlKGNwdFR5cGVbMF0pOwogIHRoaXNbSU5fTUFJTl9QUk9DRVNTXSA9IHRydWU7CiAgdmFyIHBheWxvYWRzID0gW3BheWxvYWRdOwogIHZhciBiYXRjaGVkID0gZmFsc2U7IC8vIEJhdGNoIGFjdGlvbgoKICBpZiAocGF5bG9hZC5iYXRjaCkgewogICAgYmF0Y2hlZCA9IHRydWU7CiAgICBwYXlsb2FkcyA9IHpyVXRpbC5tYXAocGF5bG9hZC5iYXRjaCwgZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgaXRlbSA9IHpyVXRpbC5kZWZhdWx0cyh6clV0aWwuZXh0ZW5kKHt9LCBpdGVtKSwgcGF5bG9hZCk7CiAgICAgIGl0ZW0uYmF0Y2ggPSBudWxsOwogICAgICByZXR1cm4gaXRlbTsKICAgIH0pOwogIH0KCiAgdmFyIGV2ZW50T2JqQmF0Y2ggPSBbXTsKICB2YXIgZXZlbnRPYmo7CiAgdmFyIGlzSGlnaERvd24gPSBwYXlsb2FkVHlwZSA9PT0gJ2hpZ2hsaWdodCcgfHwgcGF5bG9hZFR5cGUgPT09ICdkb3ducGxheSc7CiAgZWFjaChwYXlsb2FkcywgZnVuY3Rpb24gKGJhdGNoSXRlbSkgewogICAgLy8gQWN0aW9uIGNhbiBzcGVjaWZ5IHRoZSBldmVudCBieSByZXR1cm4gaXQuCiAgICBldmVudE9iaiA9IGFjdGlvbldyYXAuYWN0aW9uKGJhdGNoSXRlbSwgdGhpcy5fbW9kZWwsIHRoaXMuX2FwaSk7IC8vIEVtaXQgZXZlbnQgb3V0c2lkZQoKICAgIGV2ZW50T2JqID0gZXZlbnRPYmogfHwgenJVdGlsLmV4dGVuZCh7fSwgYmF0Y2hJdGVtKTsgLy8gQ29udmVydCB0eXBlIHRvIGV2ZW50VHlwZQoKICAgIGV2ZW50T2JqLnR5cGUgPSBhY3Rpb25JbmZvLmV2ZW50IHx8IGV2ZW50T2JqLnR5cGU7CiAgICBldmVudE9iakJhdGNoLnB1c2goZXZlbnRPYmopOyAvLyBsaWdodCB1cGRhdGUgZG9lcyBub3QgcGVyZm9ybSBkYXRhIHByb2Nlc3MsIGxheW91dCBhbmQgdmlzdWFsLgoKICAgIGlmIChpc0hpZ2hEb3duKSB7CiAgICAgIC8vIG1ldGhvZCwgcGF5bG9hZCwgbWFpblR5cGUsIHN1YlR5cGUKICAgICAgdXBkYXRlRGlyZWN0bHkodGhpcywgdXBkYXRlTWV0aG9kLCBiYXRjaEl0ZW0sICdzZXJpZXMnKTsKICAgIH0gZWxzZSBpZiAoY3B0VHlwZSkgewogICAgICB1cGRhdGVEaXJlY3RseSh0aGlzLCB1cGRhdGVNZXRob2QsIGJhdGNoSXRlbSwgY3B0VHlwZS5tYWluLCBjcHRUeXBlLnN1Yik7CiAgICB9CiAgfSwgdGhpcyk7CgogIGlmICh1cGRhdGVNZXRob2QgIT09ICdub25lJyAmJiAhaXNIaWdoRG93biAmJiAhY3B0VHlwZSkgewogICAgLy8gU3RpbGwgZGlydHkKICAgIGlmICh0aGlzW09QVElPTl9VUERBVEVEXSkgewogICAgICAvLyBGSVhNRSBQYXNzIHBheWxvYWQgPwogICAgICBwcmVwYXJlKHRoaXMpOwogICAgICB1cGRhdGVNZXRob2RzLnVwZGF0ZS5jYWxsKHRoaXMsIHBheWxvYWQpOwogICAgICB0aGlzW09QVElPTl9VUERBVEVEXSA9IGZhbHNlOwogICAgfSBlbHNlIHsKICAgICAgdXBkYXRlTWV0aG9kc1t1cGRhdGVNZXRob2RdLmNhbGwodGhpcywgcGF5bG9hZCk7CiAgICB9CiAgfSAvLyBGb2xsb3cgdGhlIHJ1bGUgb2YgYWN0aW9uIGJhdGNoCgoKICBpZiAoYmF0Y2hlZCkgewogICAgZXZlbnRPYmogPSB7CiAgICAgIHR5cGU6IGFjdGlvbkluZm8uZXZlbnQgfHwgcGF5bG9hZFR5cGUsCiAgICAgIGVzY2FwZUNvbm5lY3Q6IGVzY2FwZUNvbm5lY3QsCiAgICAgIGJhdGNoOiBldmVudE9iakJhdGNoCiAgICB9OwogIH0gZWxzZSB7CiAgICBldmVudE9iaiA9IGV2ZW50T2JqQmF0Y2hbMF07CiAgfQoKICB0aGlzW0lOX01BSU5fUFJPQ0VTU10gPSBmYWxzZTsKICAhc2lsZW50ICYmIHRoaXMuX21lc3NhZ2VDZW50ZXIudHJpZ2dlcihldmVudE9iai50eXBlLCBldmVudE9iaik7Cn0KCmZ1bmN0aW9uIGZsdXNoUGVuZGluZ0FjdGlvbnMoc2lsZW50KSB7CiAgdmFyIHBlbmRpbmdBY3Rpb25zID0gdGhpcy5fcGVuZGluZ0FjdGlvbnM7CgogIHdoaWxlIChwZW5kaW5nQWN0aW9ucy5sZW5ndGgpIHsKICAgIHZhciBwYXlsb2FkID0gcGVuZGluZ0FjdGlvbnMuc2hpZnQoKTsKICAgIGRvRGlzcGF0Y2hBY3Rpb24uY2FsbCh0aGlzLCBwYXlsb2FkLCBzaWxlbnQpOwogIH0KfQoKZnVuY3Rpb24gdHJpZ2dlclVwZGF0ZWRFdmVudChzaWxlbnQpIHsKICAhc2lsZW50ICYmIHRoaXMudHJpZ2dlcigndXBkYXRlZCcpOwp9Ci8qKgogKiBFdmVudCBgcmVuZGVyZWRgIGlzIHRyaWdnZXJlZCB3aGVuIHpyCiAqIHJlbmRlcmVkLiBJdCBpcyB1c2VmdWwgZm9yIHJlYWx0aW1lCiAqIHNuYXBzaG90IChyZWZsZWN0IGFuaW1hdGlvbikuCiAqCiAqIEV2ZW50IGBmaW5pc2hlZGAgaXMgdHJpZ2dlcmVkIHdoZW46CiAqICgxKSB6cmVuZGVyIHJlbmRlcmluZyBmaW5pc2hlZC4KICogKDIpIGluaXRpYWwgYW5pbWF0aW9uIGZpbmlzaGVkLgogKiAoMykgcHJvZ3Jlc3NpdmUgcmVuZGVyaW5nIGZpbmlzaGVkLgogKiAoNCkgbm8gcGVuZGluZyBhY3Rpb24uCiAqICg1KSBubyBkZWxheWVkIHNldE9wdGlvbiBuZWVkcyB0byBiZSBwcm9jZXNzZWQuCiAqLwoKCmZ1bmN0aW9uIGJpbmRSZW5kZXJlZEV2ZW50KHpyLCBlY0lucykgewogIHpyLm9uKCdyZW5kZXJlZCcsIGZ1bmN0aW9uICgpIHsKICAgIGVjSW5zLnRyaWdnZXIoJ3JlbmRlcmVkJyk7IC8vIFRoZSBgZmluaXNoZWRgIGV2ZW50IHNob3VsZCBub3QgYmUgdHJpZ2dlcmVkIHJlcGVhdGx5LAogICAgLy8gc28gaXQgc2hvdWxkIG9ubHkgYmUgdHJpZ2dlcmVkIHdoZW4gcmVuZGVyaW5nIGluZGVlZCBoYXBwZW5kCiAgICAvLyBpbiB6cmVuZGVyLiAoQ29uc2lkZXIgdGhlIGNhc2UgdGhhdCBkaXBhdGNoQWN0aW9uIGlzIGtlZXAKICAgIC8vIHRyaWdnZXJpbmcgd2hlbiBtb3VzZSBtb3ZlKS4KCiAgICBpZiAoIC8vIEFsdGhvdWdoIHpyIGlzIGRpcnR5IGlmIGluaXRpYWwgYW5pbWF0aW9uIGlzIG5vdCBmaW5pc2hlZAogICAgLy8gYW5kIHRoaXMgY2hlY2tpbmcgaXMgY2FsbGVkIG9uIGZyYW1lLCB3ZSBhbHNvIGNoZWNrCiAgICAvLyBhbmltYXRpb24gZmluaXNoZWQgZm9yIHJvYnVzdG5lc3MuCiAgICB6ci5hbmltYXRpb24uaXNGaW5pc2hlZCgpICYmICFlY0luc1tPUFRJT05fVVBEQVRFRF0gJiYgIWVjSW5zLl9zY2hlZHVsZXIudW5maW5pc2hlZCAmJiAhZWNJbnMuX3BlbmRpbmdBY3Rpb25zLmxlbmd0aCkgewogICAgICBlY0lucy50cmlnZ2VyKCdmaW5pc2hlZCcpOwogICAgfQogIH0pOwp9Ci8qKgogKiBAcGFyYW0ge09iamVjdH0gcGFyYW1zCiAqIEBwYXJhbSB7bnVtYmVyfSBwYXJhbXMuc2VyaWVzSW5kZXgKICogQHBhcmFtIHtBcnJheXxUeXBlZEFycmF5fSBwYXJhbXMuZGF0YQogKi8KCgplY2hhcnRzUHJvdG8uYXBwZW5kRGF0YSA9IGZ1bmN0aW9uIChwYXJhbXMpIHsKICBpZiAodGhpcy5fZGlzcG9zZWQpIHsKICAgIGRpc3Bvc2VkV2FybmluZyh0aGlzLmlkKTsKICAgIHJldHVybjsKICB9CgogIHZhciBzZXJpZXNJbmRleCA9IHBhcmFtcy5zZXJpZXNJbmRleDsKICB2YXIgZWNNb2RlbCA9IHRoaXMuZ2V0TW9kZWwoKTsKICB2YXIgc2VyaWVzTW9kZWwgPSBlY01vZGVsLmdldFNlcmllc0J5SW5kZXgoc2VyaWVzSW5kZXgpOwogIHNlcmllc01vZGVsLmFwcGVuZERhdGEocGFyYW1zKTsgLy8gTm90ZTogYGFwcGVuZERhdGFgIGRvZXMgbm90IHN1cHBvcnQgdGhhdCB1cGRhdGUgZXh0ZW50IG9mIGNvb3JkaW5hdGUKICAvLyBzeXN0ZW0sIHV0aWwgc29tZSBzY2VuYXJpbyByZXF1aXJlIHRoYXQuIEluIHRoZSBleHBlY3RlZCB1c2FnZSBvZgogIC8vIGBhcHBlbmREYXRhYCwgdGhlIGluaXRpYWwgZXh0ZW50IG9mIGNvb3JkaW5hdGUgc3lzdGVtIHNob3VsZCBiZXR0ZXIKICAvLyBiZSBmaXhlZCBieSBheGlzIGBtaW5gL2BtYXhgIHNldHRpbmcgb3IgaW5pdGlhbCBkYXRhLCBvdGhlcndpc2UgaWYKICAvLyB0aGUgZXh0ZW50IGNoYW5nZWQgd2hpbGUgYGFwcGVuZERhdGFgLCB0aGUgbG9jYXRpb24gb2YgdGhlIHBhaW50ZWQKICAvLyBncmFwaGljIGVsZW1lbnRzIGhhdmUgdG8gYmUgY2hhbmdlZCwgd2hpY2ggbWFrZSB0aGUgdXNhZ2Ugb2YKICAvLyBgYXBwZW5kRGF0YWAgbWVhbmluZ2xlc3MuCgogIHRoaXMuX3NjaGVkdWxlci51bmZpbmlzaGVkID0gdHJ1ZTsKfTsKLyoqCiAqIFJlZ2lzdGVyIGV2ZW50CiAqIEBtZXRob2QKICovCgoKZWNoYXJ0c1Byb3RvLm9uID0gY3JlYXRlUmVnaXN0ZXJFdmVudFdpdGhMb3dlcmNhc2VOYW1lKCdvbicsIGZhbHNlKTsKZWNoYXJ0c1Byb3RvLm9mZiA9IGNyZWF0ZVJlZ2lzdGVyRXZlbnRXaXRoTG93ZXJjYXNlTmFtZSgnb2ZmJywgZmFsc2UpOwplY2hhcnRzUHJvdG8ub25lID0gY3JlYXRlUmVnaXN0ZXJFdmVudFdpdGhMb3dlcmNhc2VOYW1lKCdvbmUnLCBmYWxzZSk7Ci8qKgogKiBQcmVwYXJlIHZpZXcgaW5zdGFuY2VzIG9mIGNoYXJ0cyBhbmQgY29tcG9uZW50cwogKiBAcGFyYW0gIHttb2R1bGU6ZWNoYXJ0cy9tb2RlbC9HbG9iYWx9IGVjTW9kZWwKICogQHByaXZhdGUKICovCgpmdW5jdGlvbiBwcmVwYXJlVmlldyhlY0lucywgdHlwZSwgZWNNb2RlbCwgc2NoZWR1bGVyKSB7CiAgdmFyIGlzQ29tcG9uZW50ID0gdHlwZSA9PT0gJ2NvbXBvbmVudCc7CiAgdmFyIHZpZXdMaXN0ID0gaXNDb21wb25lbnQgPyBlY0lucy5fY29tcG9uZW50c1ZpZXdzIDogZWNJbnMuX2NoYXJ0c1ZpZXdzOwogIHZhciB2aWV3TWFwID0gaXNDb21wb25lbnQgPyBlY0lucy5fY29tcG9uZW50c01hcCA6IGVjSW5zLl9jaGFydHNNYXA7CiAgdmFyIHpyID0gZWNJbnMuX3pyOwogIHZhciBhcGkgPSBlY0lucy5fYXBpOwoKICBmb3IgKHZhciBpID0gMDsgaSA8IHZpZXdMaXN0Lmxlbmd0aDsgaSsrKSB7CiAgICB2aWV3TGlzdFtpXS5fX2FsaXZlID0gZmFsc2U7CiAgfQoKICBpc0NvbXBvbmVudCA/IGVjTW9kZWwuZWFjaENvbXBvbmVudChmdW5jdGlvbiAoY29tcG9uZW50VHlwZSwgbW9kZWwpIHsKICAgIGNvbXBvbmVudFR5cGUgIT09ICdzZXJpZXMnICYmIGRvUHJlcGFyZShtb2RlbCk7CiAgfSkgOiBlY01vZGVsLmVhY2hTZXJpZXMoZG9QcmVwYXJlKTsKCiAgZnVuY3Rpb24gZG9QcmVwYXJlKG1vZGVsKSB7CiAgICAvLyBDb25zaWRlcjogaWQgc2FtZSBhbmQgdHlwZSBjaGFuZ2VkLgogICAgdmFyIHZpZXdJZCA9ICdfZWNfJyArIG1vZGVsLmlkICsgJ18nICsgbW9kZWwudHlwZTsKICAgIHZhciB2aWV3ID0gdmlld01hcFt2aWV3SWRdOwoKICAgIGlmICghdmlldykgewogICAgICB2YXIgY2xhc3NUeXBlID0gcGFyc2VDbGFzc1R5cGUobW9kZWwudHlwZSk7CiAgICAgIHZhciBDbGF6eiA9IGlzQ29tcG9uZW50ID8gQ29tcG9uZW50Vmlldy5nZXRDbGFzcyhjbGFzc1R5cGUubWFpbiwgY2xhc3NUeXBlLnN1YikgOiBDaGFydFZpZXcuZ2V0Q2xhc3MoY2xhc3NUeXBlLnN1Yik7CiAgICAgIHZpZXcgPSBuZXcgQ2xhenooKTsKICAgICAgdmlldy5pbml0KGVjTW9kZWwsIGFwaSk7CiAgICAgIHZpZXdNYXBbdmlld0lkXSA9IHZpZXc7CiAgICAgIHZpZXdMaXN0LnB1c2godmlldyk7CiAgICAgIHpyLmFkZCh2aWV3Lmdyb3VwKTsKICAgIH0KCiAgICBtb2RlbC5fX3ZpZXdJZCA9IHZpZXcuX19pZCA9IHZpZXdJZDsKICAgIHZpZXcuX19hbGl2ZSA9IHRydWU7CiAgICB2aWV3Ll9fbW9kZWwgPSBtb2RlbDsKICAgIHZpZXcuZ3JvdXAuX19lY0NvbXBvbmVudEluZm8gPSB7CiAgICAgIG1haW5UeXBlOiBtb2RlbC5tYWluVHlwZSwKICAgICAgaW5kZXg6IG1vZGVsLmNvbXBvbmVudEluZGV4CiAgICB9OwogICAgIWlzQ29tcG9uZW50ICYmIHNjaGVkdWxlci5wcmVwYXJlVmlldyh2aWV3LCBtb2RlbCwgZWNNb2RlbCwgYXBpKTsKICB9CgogIGZvciAodmFyIGkgPSAwOyBpIDwgdmlld0xpc3QubGVuZ3RoOykgewogICAgdmFyIHZpZXcgPSB2aWV3TGlzdFtpXTsKCiAgICBpZiAoIXZpZXcuX19hbGl2ZSkgewogICAgICAhaXNDb21wb25lbnQgJiYgdmlldy5yZW5kZXJUYXNrLmRpc3Bvc2UoKTsKICAgICAgenIucmVtb3ZlKHZpZXcuZ3JvdXApOwogICAgICB2aWV3LmRpc3Bvc2UoZWNNb2RlbCwgYXBpKTsKICAgICAgdmlld0xpc3Quc3BsaWNlKGksIDEpOwogICAgICBkZWxldGUgdmlld01hcFt2aWV3Ll9faWRdOwogICAgICB2aWV3Ll9faWQgPSB2aWV3Lmdyb3VwLl9fZWNDb21wb25lbnRJbmZvID0gbnVsbDsKICAgIH0gZWxzZSB7CiAgICAgIGkrKzsKICAgIH0KICB9Cn0gLy8gLyoqCi8vICAqIEVuY29kZSB2aXN1YWwgaW5mb21hdGlvbiBmcm9tIGRhdGEgYWZ0ZXIgZGF0YSBwcm9jZXNzaW5nCi8vICAqCi8vICAqIEBwYXJhbSB7bW9kdWxlOmVjaGFydHMvbW9kZWwvR2xvYmFsfSBlY01vZGVsCi8vICAqIEBwYXJhbSB7b2JqZWN0fSBsYXlvdXQKLy8gICogQHBhcmFtIHtib29sZWFufSBbbGF5b3V0RmlsdGVyXSBgdHJ1ZWA6IG9ubHkgbGF5b3V0LAovLyAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGBmYWxzZWA6IG9ubHkgbm90IGxheW91dCwKLy8gICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBgbnVsbGAvYHVuZGVmaW5lZGA6IGFsbC4KLy8gICogQHBhcmFtIHtzdHJpbmd9IHRhc2tCYXNlVGFnCi8vICAqIEBwcml2YXRlCi8vICAqLwovLyBmdW5jdGlvbiBzdGFydFZpc3VhbEVuY29kaW5nKGVjSW5zLCBlY01vZGVsLCBhcGksIHBheWxvYWQsIGxheW91dEZpbHRlcikgewovLyAgICAgZWFjaCh2aXN1YWxGdW5jcywgZnVuY3Rpb24gKHZpc3VhbCwgaW5kZXgpIHsKLy8gICAgICAgICB2YXIgaXNMYXlvdXQgPSB2aXN1YWwuaXNMYXlvdXQ7Ci8vICAgICAgICAgaWYgKGxheW91dEZpbHRlciA9PSBudWxsCi8vICAgICAgICAgICAgIHx8IChsYXlvdXRGaWx0ZXIgPT09IGZhbHNlICYmICFpc0xheW91dCkKLy8gICAgICAgICAgICAgfHwgKGxheW91dEZpbHRlciA9PT0gdHJ1ZSAmJiBpc0xheW91dCkKLy8gICAgICAgICApIHsKLy8gICAgICAgICAgICAgdmlzdWFsLmZ1bmMoZWNNb2RlbCwgYXBpLCBwYXlsb2FkKTsKLy8gICAgICAgICB9Ci8vICAgICB9KTsKLy8gfQoKCmZ1bmN0aW9uIGNsZWFyQ29sb3JQYWxldHRlKGVjTW9kZWwpIHsKICBlY01vZGVsLmNsZWFyQ29sb3JQYWxldHRlKCk7CiAgZWNNb2RlbC5lYWNoU2VyaWVzKGZ1bmN0aW9uIChzZXJpZXNNb2RlbCkgewogICAgc2VyaWVzTW9kZWwuY2xlYXJDb2xvclBhbGV0dGUoKTsKICB9KTsKfQoKZnVuY3Rpb24gcmVuZGVyKGVjSW5zLCBlY01vZGVsLCBhcGksIHBheWxvYWQpIHsKICByZW5kZXJDb21wb25lbnRzKGVjSW5zLCBlY01vZGVsLCBhcGksIHBheWxvYWQpOwogIGVhY2goZWNJbnMuX2NoYXJ0c1ZpZXdzLCBmdW5jdGlvbiAoY2hhcnQpIHsKICAgIGNoYXJ0Ll9fYWxpdmUgPSBmYWxzZTsKICB9KTsKICByZW5kZXJTZXJpZXMoZWNJbnMsIGVjTW9kZWwsIGFwaSwgcGF5bG9hZCk7IC8vIFJlbW92ZSBncm91cHMgb2YgdW5yZW5kZXJlZCBjaGFydHMKCiAgZWFjaChlY0lucy5fY2hhcnRzVmlld3MsIGZ1bmN0aW9uIChjaGFydCkgewogICAgaWYgKCFjaGFydC5fX2FsaXZlKSB7CiAgICAgIGNoYXJ0LnJlbW92ZShlY01vZGVsLCBhcGkpOwogICAgfQogIH0pOwp9CgpmdW5jdGlvbiByZW5kZXJDb21wb25lbnRzKGVjSW5zLCBlY01vZGVsLCBhcGksIHBheWxvYWQsIGRpcnR5TGlzdCkgewogIGVhY2goZGlydHlMaXN0IHx8IGVjSW5zLl9jb21wb25lbnRzVmlld3MsIGZ1bmN0aW9uIChjb21wb25lbnRWaWV3KSB7CiAgICB2YXIgY29tcG9uZW50TW9kZWwgPSBjb21wb25lbnRWaWV3Ll9fbW9kZWw7CiAgICBjb21wb25lbnRWaWV3LnJlbmRlcihjb21wb25lbnRNb2RlbCwgZWNNb2RlbCwgYXBpLCBwYXlsb2FkKTsKICAgIHVwZGF0ZVooY29tcG9uZW50TW9kZWwsIGNvbXBvbmVudFZpZXcpOwogIH0pOwp9Ci8qKgogKiBSZW5kZXIgZWFjaCBjaGFydCBhbmQgY29tcG9uZW50CiAqIEBwcml2YXRlCiAqLwoKCmZ1bmN0aW9uIHJlbmRlclNlcmllcyhlY0lucywgZWNNb2RlbCwgYXBpLCBwYXlsb2FkLCBkaXJ0eU1hcCkgewogIC8vIFJlbmRlciBhbGwgY2hhcnRzCiAgdmFyIHNjaGVkdWxlciA9IGVjSW5zLl9zY2hlZHVsZXI7CiAgdmFyIHVuZmluaXNoZWQ7CiAgZWNNb2RlbC5lYWNoU2VyaWVzKGZ1bmN0aW9uIChzZXJpZXNNb2RlbCkgewogICAgdmFyIGNoYXJ0VmlldyA9IGVjSW5zLl9jaGFydHNNYXBbc2VyaWVzTW9kZWwuX192aWV3SWRdOwogICAgY2hhcnRWaWV3Ll9fYWxpdmUgPSB0cnVlOwogICAgdmFyIHJlbmRlclRhc2sgPSBjaGFydFZpZXcucmVuZGVyVGFzazsKICAgIHNjaGVkdWxlci51cGRhdGVQYXlsb2FkKHJlbmRlclRhc2ssIHBheWxvYWQpOwoKICAgIGlmIChkaXJ0eU1hcCAmJiBkaXJ0eU1hcC5nZXQoc2VyaWVzTW9kZWwudWlkKSkgewogICAgICByZW5kZXJUYXNrLmRpcnR5KCk7CiAgICB9CgogICAgdW5maW5pc2hlZCB8PSByZW5kZXJUYXNrLnBlcmZvcm0oc2NoZWR1bGVyLmdldFBlcmZvcm1BcmdzKHJlbmRlclRhc2spKTsKICAgIGNoYXJ0Vmlldy5ncm91cC5zaWxlbnQgPSAhIXNlcmllc01vZGVsLmdldCgnc2lsZW50Jyk7CiAgICB1cGRhdGVaKHNlcmllc01vZGVsLCBjaGFydFZpZXcpOwogICAgdXBkYXRlQmxlbmQoc2VyaWVzTW9kZWwsIGNoYXJ0Vmlldyk7CiAgfSk7CiAgc2NoZWR1bGVyLnVuZmluaXNoZWQgfD0gdW5maW5pc2hlZDsgLy8gSWYgdXNlIGhvdmVyIGxheWVyCgogIHVwZGF0ZUhvdmVyTGF5ZXJTdGF0dXMoZWNJbnMsIGVjTW9kZWwpOyAvLyBBZGQgYXJpYQoKICBhcmlhKGVjSW5zLl96ci5kb20sIGVjTW9kZWwpOwp9CgpmdW5jdGlvbiBwZXJmb3JtUG9zdFVwZGF0ZUZ1bmNzKGVjTW9kZWwsIGFwaSkgewogIGVhY2gocG9zdFVwZGF0ZUZ1bmNzLCBmdW5jdGlvbiAoZnVuYykgewogICAgZnVuYyhlY01vZGVsLCBhcGkpOwogIH0pOwp9Cgp2YXIgTU9VU0VfRVZFTlRfTkFNRVMgPSBbJ2NsaWNrJywgJ2RibGNsaWNrJywgJ21vdXNlb3ZlcicsICdtb3VzZW91dCcsICdtb3VzZW1vdmUnLCAnbW91c2Vkb3duJywgJ21vdXNldXAnLCAnZ2xvYmFsb3V0JywgJ2NvbnRleHRtZW51J107Ci8qKgogKiBAcHJpdmF0ZQogKi8KCmVjaGFydHNQcm90by5faW5pdEV2ZW50cyA9IGZ1bmN0aW9uICgpIHsKICBlYWNoKE1PVVNFX0VWRU5UX05BTUVTLCBmdW5jdGlvbiAoZXZlTmFtZSkgewogICAgdmFyIGhhbmRsZXIgPSBmdW5jdGlvbiBoYW5kbGVyKGUpIHsKICAgICAgdmFyIGVjTW9kZWwgPSB0aGlzLmdldE1vZGVsKCk7CiAgICAgIHZhciBlbCA9IGUudGFyZ2V0OwogICAgICB2YXIgcGFyYW1zOwogICAgICB2YXIgaXNHbG9iYWxPdXQgPSBldmVOYW1lID09PSAnZ2xvYmFsb3V0JzsgLy8gbm8gZS50YXJnZXQgd2hlbiAnZ2xvYmFsb3V0Jy4KCiAgICAgIGlmIChpc0dsb2JhbE91dCkgewogICAgICAgIHBhcmFtcyA9IHt9OwogICAgICB9IGVsc2UgaWYgKGVsICYmIGVsLmRhdGFJbmRleCAhPSBudWxsKSB7CiAgICAgICAgdmFyIGRhdGFNb2RlbCA9IGVsLmRhdGFNb2RlbCB8fCBlY01vZGVsLmdldFNlcmllc0J5SW5kZXgoZWwuc2VyaWVzSW5kZXgpOwogICAgICAgIHBhcmFtcyA9IGRhdGFNb2RlbCAmJiBkYXRhTW9kZWwuZ2V0RGF0YVBhcmFtcyhlbC5kYXRhSW5kZXgsIGVsLmRhdGFUeXBlLCBlbCkgfHwge307CiAgICAgIH0gLy8gSWYgZWxlbWVudCBoYXMgY3VzdG9tIGV2ZW50RGF0YSBvZiBjb21wb25lbnRzCiAgICAgIGVsc2UgaWYgKGVsICYmIGVsLmV2ZW50RGF0YSkgewogICAgICAgICAgcGFyYW1zID0genJVdGlsLmV4dGVuZCh7fSwgZWwuZXZlbnREYXRhKTsKICAgICAgICB9IC8vIENvbnRyYWN0OiBpZiBwYXJhbXMgcHJlcGFyZWQgaW4gbW91c2UgZXZlbnQsCiAgICAgIC8vIHRoZXNlIHByb3BlcnRpZXMgbXVzdCBiZSBzcGVjaWZpZWQ6CiAgICAgIC8vIHsKICAgICAgLy8gICAgY29tcG9uZW50VHlwZTogc3RyaW5nIChjb21wb25lbnQgbWFpbiB0eXBlKQogICAgICAvLyAgICBjb21wb25lbnRJbmRleDogbnVtYmVyCiAgICAgIC8vIH0KICAgICAgLy8gT3RoZXJ3aXNlIGV2ZW50IHF1ZXJ5IGNhbiBub3Qgd29yay4KCgogICAgICBpZiAocGFyYW1zKSB7CiAgICAgICAgdmFyIGNvbXBvbmVudFR5cGUgPSBwYXJhbXMuY29tcG9uZW50VHlwZTsKICAgICAgICB2YXIgY29tcG9uZW50SW5kZXggPSBwYXJhbXMuY29tcG9uZW50SW5kZXg7IC8vIFNwZWNpYWwgaGFuZGxpbmcgZm9yIGhpc3RvcmljIHJlYXNvbjogd2hlbiB0cmlnZ2VyIGJ5CiAgICAgICAgLy8gbWFya0xpbmUvbWFya1BvaW50L21hcmtBcmVhLCB0aGUgY29tcG9uZW50VHlwZSBpcwogICAgICAgIC8vICdtYXJrTGluZScvJ21hcmtQb2ludCcvJ21hcmtBcmVhJywgYnV0IHdlIHNob3VsZCBiZXR0ZXIKICAgICAgICAvLyBlbmFibGUgdGhlbSB0byBiZSBxdWVyaWVkIGJ5IHNlcmllc0luZGV4LCBzaW5jZSB0aGVpcgogICAgICAgIC8vIG9wdGlvbiBpcyBzZXQgaW4gZWFjaCBzZXJpZXMuCgogICAgICAgIGlmIChjb21wb25lbnRUeXBlID09PSAnbWFya0xpbmUnIHx8IGNvbXBvbmVudFR5cGUgPT09ICdtYXJrUG9pbnQnIHx8IGNvbXBvbmVudFR5cGUgPT09ICdtYXJrQXJlYScpIHsKICAgICAgICAgIGNvbXBvbmVudFR5cGUgPSAnc2VyaWVzJzsKICAgICAgICAgIGNvbXBvbmVudEluZGV4ID0gcGFyYW1zLnNlcmllc0luZGV4OwogICAgICAgIH0KCiAgICAgICAgdmFyIG1vZGVsID0gY29tcG9uZW50VHlwZSAmJiBjb21wb25lbnRJbmRleCAhPSBudWxsICYmIGVjTW9kZWwuZ2V0Q29tcG9uZW50KGNvbXBvbmVudFR5cGUsIGNvbXBvbmVudEluZGV4KTsKICAgICAgICB2YXIgdmlldyA9IG1vZGVsICYmIHRoaXNbbW9kZWwubWFpblR5cGUgPT09ICdzZXJpZXMnID8gJ19jaGFydHNNYXAnIDogJ19jb21wb25lbnRzTWFwJ11bbW9kZWwuX192aWV3SWRdOwogICAgICAgIHBhcmFtcy5ldmVudCA9IGU7CiAgICAgICAgcGFyYW1zLnR5cGUgPSBldmVOYW1lOwogICAgICAgIHRoaXMuX2VjRXZlbnRQcm9jZXNzb3IuZXZlbnRJbmZvID0gewogICAgICAgICAgdGFyZ2V0RWw6IGVsLAogICAgICAgICAgcGFja2VkRXZlbnQ6IHBhcmFtcywKICAgICAgICAgIG1vZGVsOiBtb2RlbCwKICAgICAgICAgIHZpZXc6IHZpZXcKICAgICAgICB9OwogICAgICAgIHRoaXMudHJpZ2dlcihldmVOYW1lLCBwYXJhbXMpOwogICAgICB9CiAgICB9OyAvLyBDb25zaWRlciB0aGF0IHNvbWUgY29tcG9uZW50IChsaWtlIHRvb2x0aXAsIGJydXNoLCAuLi4pCiAgICAvLyByZWdpc3RlciB6ciBldmVudCBoYW5kbGVyLCBidXQgdXNlciBldmVudCBoYW5kbGVyIG1pZ2h0CiAgICAvLyBkbyBhbnl0aGluZywgc3VjaCBhcyBjYWxsIGBzZXRPcHRpb25gIG9yIGBkaXNwYXRjaEFjdGlvbmAsCiAgICAvLyB3aGljaCBwcm9iYWJseSB1cGRhdGUgYW55IG9mIHRoZSBjb250ZW50IGFuZCBwcm9iYWJseQogICAgLy8gY2F1c2UgcHJvYmxlbSBpZiBpdCBpcyBjYWxsZWQgcHJldmlvdXMgb3RoZXIgaW5uZXIgaGFuZGxlcnMuCgoKICAgIGhhbmRsZXIuenJFdmVudGZ1bENhbGxBdExhc3QgPSB0cnVlOwoKICAgIHRoaXMuX3pyLm9uKGV2ZU5hbWUsIGhhbmRsZXIsIHRoaXMpOwogIH0sIHRoaXMpOwogIGVhY2goZXZlbnRBY3Rpb25NYXAsIGZ1bmN0aW9uIChhY3Rpb25UeXBlLCBldmVudFR5cGUpIHsKICAgIHRoaXMuX21lc3NhZ2VDZW50ZXIub24oZXZlbnRUeXBlLCBmdW5jdGlvbiAoZXZlbnQpIHsKICAgICAgdGhpcy50cmlnZ2VyKGV2ZW50VHlwZSwgZXZlbnQpOwogICAgfSwgdGhpcyk7CiAgfSwgdGhpcyk7Cn07Ci8qKgogKiBAcmV0dXJuIHtib29sZWFufQogKi8KCgplY2hhcnRzUHJvdG8uaXNEaXNwb3NlZCA9IGZ1bmN0aW9uICgpIHsKICByZXR1cm4gdGhpcy5fZGlzcG9zZWQ7Cn07Ci8qKgogKiBDbGVhcgogKi8KCgplY2hhcnRzUHJvdG8uY2xlYXIgPSBmdW5jdGlvbiAoKSB7CiAgaWYgKHRoaXMuX2Rpc3Bvc2VkKSB7CiAgICBkaXNwb3NlZFdhcm5pbmcodGhpcy5pZCk7CiAgICByZXR1cm47CiAgfQoKICB0aGlzLnNldE9wdGlvbih7CiAgICBzZXJpZXM6IFtdCiAgfSwgdHJ1ZSk7Cn07Ci8qKgogKiBEaXNwb3NlIGluc3RhbmNlCiAqLwoKCmVjaGFydHNQcm90by5kaXNwb3NlID0gZnVuY3Rpb24gKCkgewogIGlmICh0aGlzLl9kaXNwb3NlZCkgewogICAgZGlzcG9zZWRXYXJuaW5nKHRoaXMuaWQpOwogICAgcmV0dXJuOwogIH0KCiAgdGhpcy5fZGlzcG9zZWQgPSB0cnVlOwogIG1vZGVsVXRpbC5zZXRBdHRyaWJ1dGUodGhpcy5nZXREb20oKSwgRE9NX0FUVFJJQlVURV9LRVksICcnKTsKICB2YXIgYXBpID0gdGhpcy5fYXBpOwogIHZhciBlY01vZGVsID0gdGhpcy5fbW9kZWw7CiAgZWFjaCh0aGlzLl9jb21wb25lbnRzVmlld3MsIGZ1bmN0aW9uIChjb21wb25lbnQpIHsKICAgIGNvbXBvbmVudC5kaXNwb3NlKGVjTW9kZWwsIGFwaSk7CiAgfSk7CiAgZWFjaCh0aGlzLl9jaGFydHNWaWV3cywgZnVuY3Rpb24gKGNoYXJ0KSB7CiAgICBjaGFydC5kaXNwb3NlKGVjTW9kZWwsIGFwaSk7CiAgfSk7IC8vIERpc3Bvc2UgYWZ0ZXIgYWxsIHZpZXdzIGRpc3Bvc2VkCgogIHRoaXMuX3pyLmRpc3Bvc2UoKTsKCiAgZGVsZXRlIGluc3RhbmNlc1t0aGlzLmlkXTsKfTsKCnpyVXRpbC5taXhpbihFQ2hhcnRzLCBFdmVudGZ1bCk7CgpmdW5jdGlvbiBkaXNwb3NlZFdhcm5pbmcoaWQpIHt9CgpmdW5jdGlvbiB1cGRhdGVIb3ZlckxheWVyU3RhdHVzKGVjSW5zLCBlY01vZGVsKSB7CiAgdmFyIHpyID0gZWNJbnMuX3pyOwogIHZhciBzdG9yYWdlID0genIuc3RvcmFnZTsKICB2YXIgZWxDb3VudCA9IDA7CiAgc3RvcmFnZS50cmF2ZXJzZShmdW5jdGlvbiAoZWwpIHsKICAgIGVsQ291bnQrKzsKICB9KTsKCiAgaWYgKGVsQ291bnQgPiBlY01vZGVsLmdldCgnaG92ZXJMYXllclRocmVzaG9sZCcpICYmICFlbnYubm9kZSkgewogICAgZWNNb2RlbC5lYWNoU2VyaWVzKGZ1bmN0aW9uIChzZXJpZXNNb2RlbCkgewogICAgICBpZiAoc2VyaWVzTW9kZWwucHJldmVudFVzaW5nSG92ZXJMYXllcikgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgdmFyIGNoYXJ0VmlldyA9IGVjSW5zLl9jaGFydHNNYXBbc2VyaWVzTW9kZWwuX192aWV3SWRdOwoKICAgICAgaWYgKGNoYXJ0Vmlldy5fX2FsaXZlKSB7CiAgICAgICAgY2hhcnRWaWV3Lmdyb3VwLnRyYXZlcnNlKGZ1bmN0aW9uIChlbCkgewogICAgICAgICAgLy8gRG9uJ3Qgc3dpdGNoIGJhY2suCiAgICAgICAgICBlbC51c2VIb3ZlckxheWVyID0gdHJ1ZTsKICAgICAgICB9KTsKICAgICAgfQogICAgfSk7CiAgfQp9Ci8qKgogKiBVcGRhdGUgY2hhcnQgcHJvZ3Jlc3NpdmUgYW5kIGJsZW5kLgogKiBAcGFyYW0ge21vZHVsZTplY2hhcnRzL21vZGVsL1Nlcmllc3xtb2R1bGU6ZWNoYXJ0cy9tb2RlbC9Db21wb25lbnR9IG1vZGVsCiAqIEBwYXJhbSB7bW9kdWxlOmVjaGFydHMvdmlldy9Db21wb25lbnR8bW9kdWxlOmVjaGFydHMvdmlldy9DaGFydH0gdmlldwogKi8KCgpmdW5jdGlvbiB1cGRhdGVCbGVuZChzZXJpZXNNb2RlbCwgY2hhcnRWaWV3KSB7CiAgdmFyIGJsZW5kTW9kZSA9IHNlcmllc01vZGVsLmdldCgnYmxlbmRNb2RlJykgfHwgbnVsbDsKICBjaGFydFZpZXcuZ3JvdXAudHJhdmVyc2UoZnVuY3Rpb24gKGVsKSB7CiAgICAvLyBGSVhNRSBtYXJrZXIgYW5kIG90aGVyIGNvbXBvbmVudHMKICAgIGlmICghZWwuaXNHcm91cCkgewogICAgICAvLyBPbmx5IHNldCBpZiBibGVuZE1vZGUgaXMgY2hhbmdlZC4gSW4gY2FzZSBlbGVtZW50IGlzIGluY3JlbWVudGFsIGFuZCBkb24ndCB3YW4ndCB0byByZXJlbmRlci4KICAgICAgaWYgKGVsLnN0eWxlLmJsZW5kICE9PSBibGVuZE1vZGUpIHsKICAgICAgICBlbC5zZXRTdHlsZSgnYmxlbmQnLCBibGVuZE1vZGUpOwogICAgICB9CiAgICB9CgogICAgaWYgKGVsLmVhY2hQZW5kaW5nRGlzcGxheWFibGUpIHsKICAgICAgZWwuZWFjaFBlbmRpbmdEaXNwbGF5YWJsZShmdW5jdGlvbiAoZGlzcGxheWFibGUpIHsKICAgICAgICBkaXNwbGF5YWJsZS5zZXRTdHlsZSgnYmxlbmQnLCBibGVuZE1vZGUpOwogICAgICB9KTsKICAgIH0KICB9KTsKfQovKioKICogQHBhcmFtIHttb2R1bGU6ZWNoYXJ0cy9tb2RlbC9TZXJpZXN8bW9kdWxlOmVjaGFydHMvbW9kZWwvQ29tcG9uZW50fSBtb2RlbAogKiBAcGFyYW0ge21vZHVsZTplY2hhcnRzL3ZpZXcvQ29tcG9uZW50fG1vZHVsZTplY2hhcnRzL3ZpZXcvQ2hhcnR9IHZpZXcKICovCgoKZnVuY3Rpb24gdXBkYXRlWihtb2RlbCwgdmlldykgewogIHZhciB6ID0gbW9kZWwuZ2V0KCd6Jyk7CiAgdmFyIHpsZXZlbCA9IG1vZGVsLmdldCgnemxldmVsJyk7IC8vIFNldCB6IGFuZCB6bGV2ZWwKCiAgdmlldy5ncm91cC50cmF2ZXJzZShmdW5jdGlvbiAoZWwpIHsKICAgIGlmIChlbC50eXBlICE9PSAnZ3JvdXAnKSB7CiAgICAgIHogIT0gbnVsbCAmJiAoZWwueiA9IHopOwogICAgICB6bGV2ZWwgIT0gbnVsbCAmJiAoZWwuemxldmVsID0gemxldmVsKTsKICAgIH0KICB9KTsKfQoKZnVuY3Rpb24gY3JlYXRlRXh0ZW5zaW9uQVBJKGVjSW5zdGFuY2UpIHsKICB2YXIgY29vcmRTeXNNZ3IgPSBlY0luc3RhbmNlLl9jb29yZFN5c01ncjsKICByZXR1cm4genJVdGlsLmV4dGVuZChuZXcgRXh0ZW5zaW9uQVBJKGVjSW5zdGFuY2UpLCB7CiAgICAvLyBJbmplY3QgbWV0aG9kcwogICAgZ2V0Q29vcmRpbmF0ZVN5c3RlbXM6IHpyVXRpbC5iaW5kKGNvb3JkU3lzTWdyLmdldENvb3JkaW5hdGVTeXN0ZW1zLCBjb29yZFN5c01nciksCiAgICBnZXRDb21wb25lbnRCeUVsZW1lbnQ6IGZ1bmN0aW9uIGdldENvbXBvbmVudEJ5RWxlbWVudChlbCkgewogICAgICB3aGlsZSAoZWwpIHsKICAgICAgICB2YXIgbW9kZWxJbmZvID0gZWwuX19lY0NvbXBvbmVudEluZm87CgogICAgICAgIGlmIChtb2RlbEluZm8gIT0gbnVsbCkgewogICAgICAgICAgcmV0dXJuIGVjSW5zdGFuY2UuX21vZGVsLmdldENvbXBvbmVudChtb2RlbEluZm8ubWFpblR5cGUsIG1vZGVsSW5mby5pbmRleCk7CiAgICAgICAgfQoKICAgICAgICBlbCA9IGVsLnBhcmVudDsKICAgICAgfQogICAgfQogIH0pOwp9Ci8qKgogKiBAY2xhc3MKICogVXNhZ2Ugb2YgcXVlcnk6CiAqIGBjaGFydC5vbignY2xpY2snLCBxdWVyeSwgaGFuZGxlcik7YAogKiBUaGUgYHF1ZXJ5YCBjYW4gYmU6CiAqICsgVGhlIGNvbXBvbmVudCB0eXBlIHF1ZXJ5IHN0cmluZywgb25seSBgbWFpblR5cGVgIG9yIGBtYWluVHlwZS5zdWJUeXBlYCwKICogICBsaWtlOiAneEF4aXMnLCAnc2VyaWVzJywgJ3hBeGlzLmNhdGVnb3J5JyBvciAnc2VyaWVzLmxpbmUnLgogKiArIFRoZSBjb21wb25lbnQgcXVlcnkgb2JqZWN0LCBsaWtlOgogKiAgIGB7c2VyaWVzSW5kZXg6IDJ9YCwgYHtzZXJpZXNOYW1lOiAneHgnfWAsIGB7c2VyaWVzSWQ6ICdzb21lJ31gLAogKiAgIGB7eEF4aXNJbmRleDogMn1gLCBge3hBeGlzTmFtZTogJ3h4J31gLCBge3hBeGlzSWQ6ICdzb21lJ31gLgogKiArIFRoZSBkYXRhIHF1ZXJ5IG9iamVjdCwgbGlrZToKICogICBge2RhdGFJbmRleDogMTIzfWAsIGB7ZGF0YVR5cGU6ICdsaW5rJ31gLCBge25hbWU6ICdzb21lJ31gLgogKiArIFRoZSBvdGhlciBxdWVyeSBvYmplY3QgKGNtcG9uZW50IGN1c3RvbWl6ZWQgcXVlcnkpLCBsaWtlOgogKiAgIGB7ZWxlbWVudDogJ3NvbWUnfWAgKG9ubHkgYXZhaWxhYmxlIGluIGN1c3RvbSBzZXJpZXMpLgogKgogKiBDYXZlYXQ6IElmIGEgcHJvcCBpbiB0aGUgYHF1ZXJ5YCBvYmplY3QgaXMgYG51bGwvdW5kZWZpbmVkYCwgaXQgaXMgdGhlCiAqIHNhbWUgYXMgdGhlcmUgaXMgbm8gc3VjaCBwcm9wIGluIHRoZSBgcXVlcnlgIG9iamVjdC4KICovCgoKZnVuY3Rpb24gRXZlbnRQcm9jZXNzb3IoKSB7CiAgLy8gVGhlc2UgaW5mbyByZXF1aXJlZDogdGFyZ2V0RWwsIHBhY2tlZEV2ZW50LCBtb2RlbCwgdmlldwogIHRoaXMuZXZlbnRJbmZvOwp9CgpFdmVudFByb2Nlc3Nvci5wcm90b3R5cGUgPSB7CiAgY29uc3RydWN0b3I6IEV2ZW50UHJvY2Vzc29yLAogIG5vcm1hbGl6ZVF1ZXJ5OiBmdW5jdGlvbiBub3JtYWxpemVRdWVyeShxdWVyeSkgewogICAgdmFyIGNwdFF1ZXJ5ID0ge307CiAgICB2YXIgZGF0YVF1ZXJ5ID0ge307CiAgICB2YXIgb3RoZXJRdWVyeSA9IHt9OyAvLyBgcXVlcnlgIGlzIGBtYWluVHlwZWAgb3IgYG1haW5UeXBlLnN1YlR5cGVgIG9mIGNvbXBvbmVudC4KCiAgICBpZiAoenJVdGlsLmlzU3RyaW5nKHF1ZXJ5KSkgewogICAgICB2YXIgY29uZENwdFR5cGUgPSBwYXJzZUNsYXNzVHlwZShxdWVyeSk7IC8vIGAubWFpbmAgYW5kIGAuc3ViYCBtYXkgYmUgJycuCgogICAgICBjcHRRdWVyeS5tYWluVHlwZSA9IGNvbmRDcHRUeXBlLm1haW4gfHwgbnVsbDsKICAgICAgY3B0UXVlcnkuc3ViVHlwZSA9IGNvbmRDcHRUeXBlLnN1YiB8fCBudWxsOwogICAgfSAvLyBgcXVlcnlgIGlzIGFuIG9iamVjdCwgY29udmVydCB0byB7bWFpblR5cGUsIGluZGV4LCBuYW1lLCBpZH0uCiAgICBlbHNlIHsKICAgICAgICAvLyBgeHh4SW5kZXhgLCBgeHh4TmFtZWAsIGB4eHhJZGAsIGBuYW1lYCwgYGRhdGFJbmRleGAsIGBkYXRhVHlwZWAgaXMgcmVzZXJ2ZWQsCiAgICAgICAgLy8gY2FuIG5vdCBiZSB1c2VkIGluIGBjb21wb21lbnRNb2RlbC5maWx0ZXJGb3JFeHBvc2VkRXZlbnRgLgogICAgICAgIHZhciBzdWZmaXhlcyA9IFsnSW5kZXgnLCAnTmFtZScsICdJZCddOwogICAgICAgIHZhciBkYXRhS2V5cyA9IHsKICAgICAgICAgIG5hbWU6IDEsCiAgICAgICAgICBkYXRhSW5kZXg6IDEsCiAgICAgICAgICBkYXRhVHlwZTogMQogICAgICAgIH07CiAgICAgICAgenJVdGlsLmVhY2gocXVlcnksIGZ1bmN0aW9uICh2YWwsIGtleSkgewogICAgICAgICAgdmFyIHJlc2VydmVkID0gZmFsc2U7CgogICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBzdWZmaXhlcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICB2YXIgcHJvcFN1ZmZpeCA9IHN1ZmZpeGVzW2ldOwogICAgICAgICAgICB2YXIgc3VmZml4UG9zID0ga2V5Lmxhc3RJbmRleE9mKHByb3BTdWZmaXgpOwoKICAgICAgICAgICAgaWYgKHN1ZmZpeFBvcyA+IDAgJiYgc3VmZml4UG9zID09PSBrZXkubGVuZ3RoIC0gcHJvcFN1ZmZpeC5sZW5ndGgpIHsKICAgICAgICAgICAgICB2YXIgbWFpblR5cGUgPSBrZXkuc2xpY2UoMCwgc3VmZml4UG9zKTsgLy8gQ29uc2lkZXIgYGRhdGFJbmRleGAuCgogICAgICAgICAgICAgIGlmIChtYWluVHlwZSAhPT0gJ2RhdGEnKSB7CiAgICAgICAgICAgICAgICBjcHRRdWVyeS5tYWluVHlwZSA9IG1haW5UeXBlOwogICAgICAgICAgICAgICAgY3B0UXVlcnlbcHJvcFN1ZmZpeC50b0xvd2VyQ2FzZSgpXSA9IHZhbDsKICAgICAgICAgICAgICAgIHJlc2VydmVkID0gdHJ1ZTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoZGF0YUtleXMuaGFzT3duUHJvcGVydHkoa2V5KSkgewogICAgICAgICAgICBkYXRhUXVlcnlba2V5XSA9IHZhbDsKICAgICAgICAgICAgcmVzZXJ2ZWQgPSB0cnVlOwogICAgICAgICAgfQoKICAgICAgICAgIGlmICghcmVzZXJ2ZWQpIHsKICAgICAgICAgICAgb3RoZXJRdWVyeVtrZXldID0gdmFsOwogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICB9CgogICAgcmV0dXJuIHsKICAgICAgY3B0UXVlcnk6IGNwdFF1ZXJ5LAogICAgICBkYXRhUXVlcnk6IGRhdGFRdWVyeSwKICAgICAgb3RoZXJRdWVyeTogb3RoZXJRdWVyeQogICAgfTsKICB9LAogIGZpbHRlcjogZnVuY3Rpb24gZmlsdGVyKGV2ZW50VHlwZSwgcXVlcnksIGFyZ3MpIHsKICAgIC8vIFRoZXkgc2hvdWxkIGJlIGFzc2lnbmVkIGJlZm9yZSBlYWNoIHRyaWdnZXIgY2FsbC4KICAgIHZhciBldmVudEluZm8gPSB0aGlzLmV2ZW50SW5mbzsKCiAgICBpZiAoIWV2ZW50SW5mbykgewogICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICB2YXIgdGFyZ2V0RWwgPSBldmVudEluZm8udGFyZ2V0RWw7CiAgICB2YXIgcGFja2VkRXZlbnQgPSBldmVudEluZm8ucGFja2VkRXZlbnQ7CiAgICB2YXIgbW9kZWwgPSBldmVudEluZm8ubW9kZWw7CiAgICB2YXIgdmlldyA9IGV2ZW50SW5mby52aWV3OyAvLyBGb3IgZXZlbnQgbGlrZSAnZ2xvYmFsb3V0Jy4KCiAgICBpZiAoIW1vZGVsIHx8ICF2aWV3KSB7CiAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIHZhciBjcHRRdWVyeSA9IHF1ZXJ5LmNwdFF1ZXJ5OwogICAgdmFyIGRhdGFRdWVyeSA9IHF1ZXJ5LmRhdGFRdWVyeTsKICAgIHJldHVybiBjaGVjayhjcHRRdWVyeSwgbW9kZWwsICdtYWluVHlwZScpICYmIGNoZWNrKGNwdFF1ZXJ5LCBtb2RlbCwgJ3N1YlR5cGUnKSAmJiBjaGVjayhjcHRRdWVyeSwgbW9kZWwsICdpbmRleCcsICdjb21wb25lbnRJbmRleCcpICYmIGNoZWNrKGNwdFF1ZXJ5LCBtb2RlbCwgJ25hbWUnKSAmJiBjaGVjayhjcHRRdWVyeSwgbW9kZWwsICdpZCcpICYmIGNoZWNrKGRhdGFRdWVyeSwgcGFja2VkRXZlbnQsICduYW1lJykgJiYgY2hlY2soZGF0YVF1ZXJ5LCBwYWNrZWRFdmVudCwgJ2RhdGFJbmRleCcpICYmIGNoZWNrKGRhdGFRdWVyeSwgcGFja2VkRXZlbnQsICdkYXRhVHlwZScpICYmICghdmlldy5maWx0ZXJGb3JFeHBvc2VkRXZlbnQgfHwgdmlldy5maWx0ZXJGb3JFeHBvc2VkRXZlbnQoZXZlbnRUeXBlLCBxdWVyeS5vdGhlclF1ZXJ5LCB0YXJnZXRFbCwgcGFja2VkRXZlbnQpKTsKCiAgICBmdW5jdGlvbiBjaGVjayhxdWVyeSwgaG9zdCwgcHJvcCwgcHJvcE9uSG9zdCkgewogICAgICByZXR1cm4gcXVlcnlbcHJvcF0gPT0gbnVsbCB8fCBob3N0W3Byb3BPbkhvc3QgfHwgcHJvcF0gPT09IHF1ZXJ5W3Byb3BdOwogICAgfQogIH0sCiAgYWZ0ZXJUcmlnZ2VyOiBmdW5jdGlvbiBhZnRlclRyaWdnZXIoKSB7CiAgICAvLyBNYWtlIHN1cmUgdGhlIGV2ZW50SW5mbyB3b250IGJlIHVzZWQgaW4gbmV4dCB0cmlnZ2VyLgogICAgdGhpcy5ldmVudEluZm8gPSBudWxsOwogIH0KfTsKLyoqCiAqIEB0eXBlIHtPYmplY3R9IGtleTogYWN0aW9uVHlwZS4KICogQGlubmVyCiAqLwoKdmFyIGFjdGlvbnMgPSB7fTsKLyoqCiAqIE1hcCBldmVudFR5cGUgdG8gYWN0aW9uVHlwZQogKiBAdHlwZSB7T2JqZWN0fQogKi8KCnZhciBldmVudEFjdGlvbk1hcCA9IHt9OwovKioKICogRGF0YSBwcm9jZXNzb3IgZnVuY3Rpb25zIG9mIGVhY2ggc3RhZ2UKICogQHR5cGUge0FycmF5LjxPYmplY3QuPHN0cmluZywgRnVuY3Rpb24+Pn0KICogQGlubmVyCiAqLwoKdmFyIGRhdGFQcm9jZXNzb3JGdW5jcyA9IFtdOwovKioKICogQHR5cGUge0FycmF5LjxGdW5jdGlvbj59CiAqIEBpbm5lcgogKi8KCnZhciBvcHRpb25QcmVwcm9jZXNzb3JGdW5jcyA9IFtdOwovKioKICogQHR5cGUge0FycmF5LjxGdW5jdGlvbj59CiAqIEBpbm5lcgogKi8KCnZhciBwb3N0VXBkYXRlRnVuY3MgPSBbXTsKLyoqCiAqIFZpc3VhbCBlbmNvZGluZyBmdW5jdGlvbnMgb2YgZWFjaCBzdGFnZQogKiBAdHlwZSB7QXJyYXkuPE9iamVjdC48c3RyaW5nLCBGdW5jdGlvbj4+fQogKi8KCnZhciB2aXN1YWxGdW5jcyA9IFtdOwovKioKICogVGhlbWUgc3RvcmFnZQogKiBAdHlwZSB7T2JqZWN0LjxrZXksIE9iamVjdD59CiAqLwoKdmFyIHRoZW1lU3RvcmFnZSA9IHt9OwovKioKICogTG9hZGluZyBlZmZlY3RzCiAqLwoKdmFyIGxvYWRpbmdFZmZlY3RzID0ge307CnZhciBpbnN0YW5jZXMgPSB7fTsKdmFyIGNvbm5lY3RlZEdyb3VwcyA9IHt9Owp2YXIgaWRCYXNlID0gbmV3IERhdGUoKSAtIDA7CnZhciBncm91cElkQmFzZSA9IG5ldyBEYXRlKCkgLSAwOwp2YXIgRE9NX0FUVFJJQlVURV9LRVkgPSAnX2VjaGFydHNfaW5zdGFuY2VfJzsKCmZ1bmN0aW9uIGVuYWJsZUNvbm5lY3QoY2hhcnQpIHsKICB2YXIgU1RBVFVTX1BFTkRJTkcgPSAwOwogIHZhciBTVEFUVVNfVVBEQVRJTkcgPSAxOwogIHZhciBTVEFUVVNfVVBEQVRFRCA9IDI7CiAgdmFyIFNUQVRVU19LRVkgPSAnX19jb25uZWN0VXBkYXRlU3RhdHVzJzsKCiAgZnVuY3Rpb24gdXBkYXRlQ29ubmVjdGVkQ2hhcnRzU3RhdHVzKGNoYXJ0cywgc3RhdHVzKSB7CiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGNoYXJ0cy5sZW5ndGg7IGkrKykgewogICAgICB2YXIgb3RoZXJDaGFydCA9IGNoYXJ0c1tpXTsKICAgICAgb3RoZXJDaGFydFtTVEFUVVNfS0VZXSA9IHN0YXR1czsKICAgIH0KICB9CgogIGVhY2goZXZlbnRBY3Rpb25NYXAsIGZ1bmN0aW9uIChhY3Rpb25UeXBlLCBldmVudFR5cGUpIHsKICAgIGNoYXJ0Ll9tZXNzYWdlQ2VudGVyLm9uKGV2ZW50VHlwZSwgZnVuY3Rpb24gKGV2ZW50KSB7CiAgICAgIGlmIChjb25uZWN0ZWRHcm91cHNbY2hhcnQuZ3JvdXBdICYmIGNoYXJ0W1NUQVRVU19LRVldICE9PSBTVEFUVVNfUEVORElORykgewogICAgICAgIGlmIChldmVudCAmJiBldmVudC5lc2NhcGVDb25uZWN0KSB7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICB2YXIgYWN0aW9uID0gY2hhcnQubWFrZUFjdGlvbkZyb21FdmVudChldmVudCk7CiAgICAgICAgdmFyIG90aGVyQ2hhcnRzID0gW107CiAgICAgICAgZWFjaChpbnN0YW5jZXMsIGZ1bmN0aW9uIChvdGhlckNoYXJ0KSB7CiAgICAgICAgICBpZiAob3RoZXJDaGFydCAhPT0gY2hhcnQgJiYgb3RoZXJDaGFydC5ncm91cCA9PT0gY2hhcnQuZ3JvdXApIHsKICAgICAgICAgICAgb3RoZXJDaGFydHMucHVzaChvdGhlckNoYXJ0KTsKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgICB1cGRhdGVDb25uZWN0ZWRDaGFydHNTdGF0dXMob3RoZXJDaGFydHMsIFNUQVRVU19QRU5ESU5HKTsKICAgICAgICBlYWNoKG90aGVyQ2hhcnRzLCBmdW5jdGlvbiAob3RoZXJDaGFydCkgewogICAgICAgICAgaWYgKG90aGVyQ2hhcnRbU1RBVFVTX0tFWV0gIT09IFNUQVRVU19VUERBVElORykgewogICAgICAgICAgICBvdGhlckNoYXJ0LmRpc3BhdGNoQWN0aW9uKGFjdGlvbik7CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgICAgdXBkYXRlQ29ubmVjdGVkQ2hhcnRzU3RhdHVzKG90aGVyQ2hhcnRzLCBTVEFUVVNfVVBEQVRFRCk7CiAgICAgIH0KICAgIH0pOwogIH0pOwp9Ci8qKgogKiBAcGFyYW0ge0hUTUxFbGVtZW50fSBkb20KICogQHBhcmFtIHtPYmplY3R9IFt0aGVtZV0KICogQHBhcmFtIHtPYmplY3R9IG9wdHMKICogQHBhcmFtIHtudW1iZXJ9IFtvcHRzLmRldmljZVBpeGVsUmF0aW9dIFVzZSB3aW5kb3cuZGV2aWNlUGl4ZWxSYXRpbyBieSBkZWZhdWx0CiAqIEBwYXJhbSB7c3RyaW5nfSBbb3B0cy5yZW5kZXJlcl0gQ2FuIGNob29zZSAnY2FudmFzJyBvciAnc3ZnJyB0byByZW5kZXIgdGhlIGNoYXJ0LgogKiBAcGFyYW0ge251bWJlcn0gW29wdHMud2lkdGhdIFVzZSBjbGllbnRXaWR0aCBvZiB0aGUgaW5wdXQgYGRvbWAgYnkgZGVmYXVsdC4KICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBDYW4gYmUgJ2F1dG8nICh0aGUgc2FtZSBhcyBudWxsL3VuZGVmaW5lZCkKICogQHBhcmFtIHtudW1iZXJ9IFtvcHRzLmhlaWdodF0gVXNlIGNsaWVudEhlaWdodCBvZiB0aGUgaW5wdXQgYGRvbWAgYnkgZGVmYXVsdC4KICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQ2FuIGJlICdhdXRvJyAodGhlIHNhbWUgYXMgbnVsbC91bmRlZmluZWQpCiAqLwoKCmZ1bmN0aW9uIGluaXQoZG9tLCB0aGVtZSwgb3B0cykgewogIHZhciBleGlzdEluc3RhbmNlID0gZ2V0SW5zdGFuY2VCeURvbShkb20pOwoKICBpZiAoZXhpc3RJbnN0YW5jZSkgewogICAgcmV0dXJuIGV4aXN0SW5zdGFuY2U7CiAgfQoKICB2YXIgY2hhcnQgPSBuZXcgRUNoYXJ0cyhkb20sIHRoZW1lLCBvcHRzKTsKICBjaGFydC5pZCA9ICdlY18nICsgaWRCYXNlKys7CiAgaW5zdGFuY2VzW2NoYXJ0LmlkXSA9IGNoYXJ0OwogIG1vZGVsVXRpbC5zZXRBdHRyaWJ1dGUoZG9tLCBET01fQVRUUklCVVRFX0tFWSwgY2hhcnQuaWQpOwogIGVuYWJsZUNvbm5lY3QoY2hhcnQpOwogIHJldHVybiBjaGFydDsKfQovKioKICogQHJldHVybiB7c3RyaW5nfEFycmF5Ljxtb2R1bGU6ZWNoYXJ0c35FQ2hhcnRzPn0gZ3JvdXBJZAogKi8KCgpmdW5jdGlvbiBjb25uZWN0KGdyb3VwSWQpIHsKICAvLyBJcyBhcnJheSBvZiBjaGFydHMKICBpZiAoenJVdGlsLmlzQXJyYXkoZ3JvdXBJZCkpIHsKICAgIHZhciBjaGFydHMgPSBncm91cElkOwogICAgZ3JvdXBJZCA9IG51bGw7IC8vIElmIGFueSBjaGFydCBoYXMgZ3JvdXAKCiAgICBlYWNoKGNoYXJ0cywgZnVuY3Rpb24gKGNoYXJ0KSB7CiAgICAgIGlmIChjaGFydC5ncm91cCAhPSBudWxsKSB7CiAgICAgICAgZ3JvdXBJZCA9IGNoYXJ0Lmdyb3VwOwogICAgICB9CiAgICB9KTsKICAgIGdyb3VwSWQgPSBncm91cElkIHx8ICdnXycgKyBncm91cElkQmFzZSsrOwogICAgZWFjaChjaGFydHMsIGZ1bmN0aW9uIChjaGFydCkgewogICAgICBjaGFydC5ncm91cCA9IGdyb3VwSWQ7CiAgICB9KTsKICB9CgogIGNvbm5lY3RlZEdyb3Vwc1tncm91cElkXSA9IHRydWU7CiAgcmV0dXJuIGdyb3VwSWQ7Cn0KLyoqCiAqIEBERVBSRUNBVEVECiAqIEByZXR1cm4ge3N0cmluZ30gZ3JvdXBJZAogKi8KCgpmdW5jdGlvbiBkaXNDb25uZWN0KGdyb3VwSWQpIHsKICBjb25uZWN0ZWRHcm91cHNbZ3JvdXBJZF0gPSBmYWxzZTsKfQovKioKICogQHJldHVybiB7c3RyaW5nfSBncm91cElkCiAqLwoKCnZhciBkaXNjb25uZWN0ID0gZGlzQ29ubmVjdDsKLyoqCiAqIERpc3Bvc2UgYSBjaGFydCBpbnN0YW5jZQogKiBAcGFyYW0gIHttb2R1bGU6ZWNoYXJ0c35FQ2hhcnRzfEhUTUxEb21FbGVtZW50fHN0cmluZ30gY2hhcnQKICovCgpmdW5jdGlvbiBkaXNwb3NlKGNoYXJ0KSB7CiAgaWYgKHR5cGVvZiBjaGFydCA9PT0gJ3N0cmluZycpIHsKICAgIGNoYXJ0ID0gaW5zdGFuY2VzW2NoYXJ0XTsKICB9IGVsc2UgaWYgKCEoY2hhcnQgaW5zdGFuY2VvZiBFQ2hhcnRzKSkgewogICAgLy8gVHJ5IHRvIHRyZWF0IGFzIGRvbQogICAgY2hhcnQgPSBnZXRJbnN0YW5jZUJ5RG9tKGNoYXJ0KTsKICB9CgogIGlmIChjaGFydCBpbnN0YW5jZW9mIEVDaGFydHMgJiYgIWNoYXJ0LmlzRGlzcG9zZWQoKSkgewogICAgY2hhcnQuZGlzcG9zZSgpOwogIH0KfQovKioKICogQHBhcmFtICB7SFRNTEVsZW1lbnR9IGRvbQogKiBAcmV0dXJuIHtlY2hhcnRzfkVDaGFydHN9CiAqLwoKCmZ1bmN0aW9uIGdldEluc3RhbmNlQnlEb20oZG9tKSB7CiAgcmV0dXJuIGluc3RhbmNlc1ttb2RlbFV0aWwuZ2V0QXR0cmlidXRlKGRvbSwgRE9NX0FUVFJJQlVURV9LRVkpXTsKfQovKioKICogQHBhcmFtIHtzdHJpbmd9IGtleQogKiBAcmV0dXJuIHtlY2hhcnRzfkVDaGFydHN9CiAqLwoKCmZ1bmN0aW9uIGdldEluc3RhbmNlQnlJZChrZXkpIHsKICByZXR1cm4gaW5zdGFuY2VzW2tleV07Cn0KLyoqCiAqIFJlZ2lzdGVyIHRoZW1lCiAqLwoKCmZ1bmN0aW9uIHJlZ2lzdGVyVGhlbWUobmFtZSwgdGhlbWUpIHsKICB0aGVtZVN0b3JhZ2VbbmFtZV0gPSB0aGVtZTsKfQovKioKICogUmVnaXN0ZXIgb3B0aW9uIHByZXByb2Nlc3NvcgogKiBAcGFyYW0ge0Z1bmN0aW9ufSBwcmVwcm9jZXNzb3JGdW5jCiAqLwoKCmZ1bmN0aW9uIHJlZ2lzdGVyUHJlcHJvY2Vzc29yKHByZXByb2Nlc3NvckZ1bmMpIHsKICBvcHRpb25QcmVwcm9jZXNzb3JGdW5jcy5wdXNoKHByZXByb2Nlc3NvckZ1bmMpOwp9Ci8qKgogKiBAcGFyYW0ge251bWJlcn0gW3ByaW9yaXR5PTEwMDBdCiAqIEBwYXJhbSB7T2JqZWN0fEZ1bmN0aW9ufSBwcm9jZXNzb3IKICovCgoKZnVuY3Rpb24gcmVnaXN0ZXJQcm9jZXNzb3IocHJpb3JpdHksIHByb2Nlc3NvcikgewogIG5vcm1hbGl6ZVJlZ2lzdGVyKGRhdGFQcm9jZXNzb3JGdW5jcywgcHJpb3JpdHksIHByb2Nlc3NvciwgUFJJT1JJVFlfUFJPQ0VTU09SX0ZJTFRFUik7Cn0KLyoqCiAqIFJlZ2lzdGVyIHBvc3RVcGRhdGVyCiAqIEBwYXJhbSB7RnVuY3Rpb259IHBvc3RVcGRhdGVGdW5jCiAqLwoKCmZ1bmN0aW9uIHJlZ2lzdGVyUG9zdFVwZGF0ZShwb3N0VXBkYXRlRnVuYykgewogIHBvc3RVcGRhdGVGdW5jcy5wdXNoKHBvc3RVcGRhdGVGdW5jKTsKfQovKioKICogVXNhZ2U6CiAqIHJlZ2lzdGVyQWN0aW9uKCdzb21lQWN0aW9uJywgJ3NvbWVFdmVudCcsIGZ1bmN0aW9uICgpIHsgLi4uIH0pOwogKiByZWdpc3RlckFjdGlvbignc29tZUFjdGlvbicsIGZ1bmN0aW9uICgpIHsgLi4uIH0pOwogKiByZWdpc3RlckFjdGlvbigKICogICAgIHt0eXBlOiAnc29tZUFjdGlvbicsIGV2ZW50OiAnc29tZUV2ZW50JywgdXBkYXRlOiAndXBkYXRlVmlldyd9LAogKiAgICAgZnVuY3Rpb24gKCkgeyAuLi4gfQogKiApOwogKgogKiBAcGFyYW0geyhzdHJpbmd8T2JqZWN0KX0gYWN0aW9uSW5mbwogKiBAcGFyYW0ge3N0cmluZ30gYWN0aW9uSW5mby50eXBlCiAqIEBwYXJhbSB7c3RyaW5nfSBbYWN0aW9uSW5mby5ldmVudF0KICogQHBhcmFtIHtzdHJpbmd9IFthY3Rpb25JbmZvLnVwZGF0ZV0KICogQHBhcmFtIHtzdHJpbmd9IFtldmVudE5hbWVdCiAqIEBwYXJhbSB7RnVuY3Rpb259IGFjdGlvbgogKi8KCgpmdW5jdGlvbiByZWdpc3RlckFjdGlvbihhY3Rpb25JbmZvLCBldmVudE5hbWUsIGFjdGlvbikgewogIGlmICh0eXBlb2YgZXZlbnROYW1lID09PSAnZnVuY3Rpb24nKSB7CiAgICBhY3Rpb24gPSBldmVudE5hbWU7CiAgICBldmVudE5hbWUgPSAnJzsKICB9CgogIHZhciBhY3Rpb25UeXBlID0gaXNPYmplY3QoYWN0aW9uSW5mbykgPyBhY3Rpb25JbmZvLnR5cGUgOiBbYWN0aW9uSW5mbywgYWN0aW9uSW5mbyA9IHsKICAgIGV2ZW50OiBldmVudE5hbWUKICB9XVswXTsgLy8gRXZlbnQgbmFtZSBpcyBhbGwgbG93ZXJjYXNlCgogIGFjdGlvbkluZm8uZXZlbnQgPSAoYWN0aW9uSW5mby5ldmVudCB8fCBhY3Rpb25UeXBlKS50b0xvd2VyQ2FzZSgpOwogIGV2ZW50TmFtZSA9IGFjdGlvbkluZm8uZXZlbnQ7IC8vIFZhbGlkYXRlIGFjdGlvbiB0eXBlIGFuZCBldmVudCBuYW1lLgoKICBhc3NlcnQoQUNUSU9OX1JFRy50ZXN0KGFjdGlvblR5cGUpICYmIEFDVElPTl9SRUcudGVzdChldmVudE5hbWUpKTsKCiAgaWYgKCFhY3Rpb25zW2FjdGlvblR5cGVdKSB7CiAgICBhY3Rpb25zW2FjdGlvblR5cGVdID0gewogICAgICBhY3Rpb246IGFjdGlvbiwKICAgICAgYWN0aW9uSW5mbzogYWN0aW9uSW5mbwogICAgfTsKICB9CgogIGV2ZW50QWN0aW9uTWFwW2V2ZW50TmFtZV0gPSBhY3Rpb25UeXBlOwp9Ci8qKgogKiBAcGFyYW0ge3N0cmluZ30gdHlwZQogKiBAcGFyYW0geyp9IENvb3JkaW5hdGVTeXN0ZW0KICovCgoKZnVuY3Rpb24gcmVnaXN0ZXJDb29yZGluYXRlU3lzdGVtKHR5cGUsIENvb3JkaW5hdGVTeXN0ZW0pIHsKICBDb29yZGluYXRlU3lzdGVtTWFuYWdlci5yZWdpc3Rlcih0eXBlLCBDb29yZGluYXRlU3lzdGVtKTsKfQovKioKICogR2V0IGRpbWVuc2lvbnMgb2Ygc3BlY2lmaWVkIGNvb3JkaW5hdGUgc3lzdGVtLgogKiBAcGFyYW0ge3N0cmluZ30gdHlwZQogKiBAcmV0dXJuIHtBcnJheS48c3RyaW5nfE9iamVjdD59CiAqLwoKCmZ1bmN0aW9uIGdldENvb3JkaW5hdGVTeXN0ZW1EaW1lbnNpb25zKHR5cGUpIHsKICB2YXIgY29vcmRTeXNDcmVhdG9yID0gQ29vcmRpbmF0ZVN5c3RlbU1hbmFnZXIuZ2V0KHR5cGUpOwoKICBpZiAoY29vcmRTeXNDcmVhdG9yKSB7CiAgICByZXR1cm4gY29vcmRTeXNDcmVhdG9yLmdldERpbWVuc2lvbnNJbmZvID8gY29vcmRTeXNDcmVhdG9yLmdldERpbWVuc2lvbnNJbmZvKCkgOiBjb29yZFN5c0NyZWF0b3IuZGltZW5zaW9ucy5zbGljZSgpOwogIH0KfQovKioKICogTGF5b3V0IGlzIGEgc3BlY2lhbCBzdGFnZSBvZiB2aXN1YWwgZW5jb2RpbmcKICogTW9zdCB2aXN1YWwgZW5jb2RpbmcgbGlrZSBjb2xvciBhcmUgY29tbW9uIGZvciBkaWZmZXJlbnQgY2hhcnQKICogQnV0IGVhY2ggY2hhcnQgaGFzIGl0J3Mgb3duIGxheW91dCBhbGdvcml0aG0KICoKICogQHBhcmFtIHtudW1iZXJ9IFtwcmlvcml0eT0xMDAwXQogKiBAcGFyYW0ge0Z1bmN0aW9ufSBsYXlvdXRUYXNrCiAqLwoKCmZ1bmN0aW9uIHJlZ2lzdGVyTGF5b3V0KHByaW9yaXR5LCBsYXlvdXRUYXNrKSB7CiAgbm9ybWFsaXplUmVnaXN0ZXIodmlzdWFsRnVuY3MsIHByaW9yaXR5LCBsYXlvdXRUYXNrLCBQUklPUklUWV9WSVNVQUxfTEFZT1VULCAnbGF5b3V0Jyk7Cn0KLyoqCiAqIEBwYXJhbSB7bnVtYmVyfSBbcHJpb3JpdHk9MzAwMF0KICogQHBhcmFtIHttb2R1bGU6ZWNoYXJ0cy9zdHJlYW0vVGFza30gdmlzdWFsVGFzawogKi8KCgpmdW5jdGlvbiByZWdpc3RlclZpc3VhbChwcmlvcml0eSwgdmlzdWFsVGFzaykgewogIG5vcm1hbGl6ZVJlZ2lzdGVyKHZpc3VhbEZ1bmNzLCBwcmlvcml0eSwgdmlzdWFsVGFzaywgUFJJT1JJVFlfVklTVUFMX0NIQVJULCAndmlzdWFsJyk7Cn0KLyoqCiAqIEBwYXJhbSB7T2JqZWN0fEZ1bmN0aW9ufSBmbjoge3Nlcmllc1R5cGUsIGNyZWF0ZU9uQWxsU2VyaWVzLCBwZXJmb3JtUmF3U2VyaWVzLCByZXNldH0KICovCgoKZnVuY3Rpb24gbm9ybWFsaXplUmVnaXN0ZXIodGFyZ2V0TGlzdCwgcHJpb3JpdHksIGZuLCBkZWZhdWx0UHJpb3JpdHksIHZpc3VhbFR5cGUpIHsKICBpZiAoaXNGdW5jdGlvbihwcmlvcml0eSkgfHwgaXNPYmplY3QocHJpb3JpdHkpKSB7CiAgICBmbiA9IHByaW9yaXR5OwogICAgcHJpb3JpdHkgPSBkZWZhdWx0UHJpb3JpdHk7CiAgfQoKICB2YXIgc3RhZ2VIYW5kbGVyID0gU2NoZWR1bGVyLndyYXBTdGFnZUhhbmRsZXIoZm4sIHZpc3VhbFR5cGUpOwogIHN0YWdlSGFuZGxlci5fX3ByaW8gPSBwcmlvcml0eTsKICBzdGFnZUhhbmRsZXIuX19yYXcgPSBmbjsKICB0YXJnZXRMaXN0LnB1c2goc3RhZ2VIYW5kbGVyKTsKICByZXR1cm4gc3RhZ2VIYW5kbGVyOwp9Ci8qKgogKiBAcGFyYW0ge3N0cmluZ30gbmFtZQogKi8KCgpmdW5jdGlvbiByZWdpc3RlckxvYWRpbmcobmFtZSwgbG9hZGluZ0Z4KSB7CiAgbG9hZGluZ0VmZmVjdHNbbmFtZV0gPSBsb2FkaW5nRng7Cn0KLyoqCiAqIEBwYXJhbSB7T2JqZWN0fSBvcHRzCiAqIEBwYXJhbSB7c3RyaW5nfSBbc3VwZXJDbGFzc10KICovCgoKZnVuY3Rpb24gZXh0ZW5kQ29tcG9uZW50TW9kZWwob3B0cwovKiwgc3VwZXJDbGFzcyovCikgewogIC8vIHZhciBDbGF6eiA9IENvbXBvbmVudE1vZGVsOwogIC8vIGlmIChzdXBlckNsYXNzKSB7CiAgLy8gICAgIHZhciBjbGFzc1R5cGUgPSBwYXJzZUNsYXNzVHlwZShzdXBlckNsYXNzKTsKICAvLyAgICAgQ2xhenogPSBDb21wb25lbnRNb2RlbC5nZXRDbGFzcyhjbGFzc1R5cGUubWFpbiwgY2xhc3NUeXBlLnN1YiwgdHJ1ZSk7CiAgLy8gfQogIHJldHVybiBDb21wb25lbnRNb2RlbC5leHRlbmQob3B0cyk7Cn0KLyoqCiAqIEBwYXJhbSB7T2JqZWN0fSBvcHRzCiAqIEBwYXJhbSB7c3RyaW5nfSBbc3VwZXJDbGFzc10KICovCgoKZnVuY3Rpb24gZXh0ZW5kQ29tcG9uZW50VmlldyhvcHRzCi8qLCBzdXBlckNsYXNzKi8KKSB7CiAgLy8gdmFyIENsYXp6ID0gQ29tcG9uZW50VmlldzsKICAvLyBpZiAoc3VwZXJDbGFzcykgewogIC8vICAgICB2YXIgY2xhc3NUeXBlID0gcGFyc2VDbGFzc1R5cGUoc3VwZXJDbGFzcyk7CiAgLy8gICAgIENsYXp6ID0gQ29tcG9uZW50Vmlldy5nZXRDbGFzcyhjbGFzc1R5cGUubWFpbiwgY2xhc3NUeXBlLnN1YiwgdHJ1ZSk7CiAgLy8gfQogIHJldHVybiBDb21wb25lbnRWaWV3LmV4dGVuZChvcHRzKTsKfQovKioKICogQHBhcmFtIHtPYmplY3R9IG9wdHMKICogQHBhcmFtIHtzdHJpbmd9IFtzdXBlckNsYXNzXQogKi8KCgpmdW5jdGlvbiBleHRlbmRTZXJpZXNNb2RlbChvcHRzCi8qLCBzdXBlckNsYXNzKi8KKSB7CiAgLy8gdmFyIENsYXp6ID0gU2VyaWVzTW9kZWw7CiAgLy8gaWYgKHN1cGVyQ2xhc3MpIHsKICAvLyAgICAgc3VwZXJDbGFzcyA9ICdzZXJpZXMuJyArIHN1cGVyQ2xhc3MucmVwbGFjZSgnc2VyaWVzLicsICcnKTsKICAvLyAgICAgdmFyIGNsYXNzVHlwZSA9IHBhcnNlQ2xhc3NUeXBlKHN1cGVyQ2xhc3MpOwogIC8vICAgICBDbGF6eiA9IENvbXBvbmVudE1vZGVsLmdldENsYXNzKGNsYXNzVHlwZS5tYWluLCBjbGFzc1R5cGUuc3ViLCB0cnVlKTsKICAvLyB9CiAgcmV0dXJuIFNlcmllc01vZGVsLmV4dGVuZChvcHRzKTsKfQovKioKICogQHBhcmFtIHtPYmplY3R9IG9wdHMKICogQHBhcmFtIHtzdHJpbmd9IFtzdXBlckNsYXNzXQogKi8KCgpmdW5jdGlvbiBleHRlbmRDaGFydFZpZXcob3B0cwovKiwgc3VwZXJDbGFzcyovCikgewogIC8vIHZhciBDbGF6eiA9IENoYXJ0VmlldzsKICAvLyBpZiAoc3VwZXJDbGFzcykgewogIC8vICAgICBzdXBlckNsYXNzID0gc3VwZXJDbGFzcy5yZXBsYWNlKCdzZXJpZXMuJywgJycpOwogIC8vICAgICB2YXIgY2xhc3NUeXBlID0gcGFyc2VDbGFzc1R5cGUoc3VwZXJDbGFzcyk7CiAgLy8gICAgIENsYXp6ID0gQ2hhcnRWaWV3LmdldENsYXNzKGNsYXNzVHlwZS5tYWluLCB0cnVlKTsKICAvLyB9CiAgcmV0dXJuIENoYXJ0Vmlldy5leHRlbmQob3B0cyk7Cn0KLyoqCiAqIFpSZW5kZXIgbmVlZCBhIGNhbnZhcyBjb250ZXh0IHRvIGRvIG1lYXN1cmVUZXh0LgogKiBCdXQgaW4gbm9kZSBlbnZpcm9ubWVudCBjYW52YXMgbWF5IGJlIGNyZWF0ZWQgYnkgbm9kZS1jYW52YXMuCiAqIFNvIHdlIG5lZWQgdG8gc3BlY2lmeSBob3cgdG8gY3JlYXRlIGEgY2FudmFzIGluc3RlYWQgb2YgdXNpbmcgZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnY2FudmFzJykKICoKICogQmUgY2FyZWZ1bCBvZiB1c2luZyBpdCBpbiB0aGUgYnJvd3Nlci4KICoKICogQHBhcmFtIHtGdW5jdGlvbn0gY3JlYXRvcgogKiBAZXhhbXBsZQogKiAgICAgdmFyIENhbnZhcyA9IHJlcXVpcmUoJ2NhbnZhcycpOwogKiAgICAgdmFyIGVjaGFydHMgPSByZXF1aXJlKCdlY2hhcnRzJyk7CiAqICAgICBlY2hhcnRzLnNldENhbnZhc0NyZWF0b3IoZnVuY3Rpb24gKCkgewogKiAgICAgICAgIC8vIFNtYWxsIHNpemUgaXMgZW5vdWdoLgogKiAgICAgICAgIHJldHVybiBuZXcgQ2FudmFzKDMyLCAzMik7CiAqICAgICB9KTsKICovCgoKZnVuY3Rpb24gc2V0Q2FudmFzQ3JlYXRvcihjcmVhdG9yKSB7CiAgenJVdGlsLiRvdmVycmlkZSgnY3JlYXRlQ2FudmFzJywgY3JlYXRvcik7Cn0KLyoqCiAqIEBwYXJhbSB7c3RyaW5nfSBtYXBOYW1lCiAqIEBwYXJhbSB7QXJyYXkuPE9iamVjdD58T2JqZWN0fHN0cmluZ30gZ2VvSnNvbgogKiBAcGFyYW0ge09iamVjdH0gW3NwZWNpYWxBcmVhc10KICoKICogQGV4YW1wbGUgR2VvSlNPTgogKiAgICAgJC5nZXQoJ1VTQS5qc29uJywgZnVuY3Rpb24gKGdlb0pzb24pIHsKICogICAgICAgICBlY2hhcnRzLnJlZ2lzdGVyTWFwKCdVU0EnLCBnZW9Kc29uKTsKICogICAgICAgICAvLyBPcgogKiAgICAgICAgIGVjaGFydHMucmVnaXN0ZXJNYXAoJ1VTQScsIHsKICogICAgICAgICAgICAgZ2VvSnNvbjogZ2VvSnNvbiwKICogICAgICAgICAgICAgc3BlY2lhbEFyZWFzOiB7fQogKiAgICAgICAgIH0pCiAqICAgICB9KTsKICoKICogICAgICQuZ2V0KCdhaXJwb3J0LnN2ZycsIGZ1bmN0aW9uIChzdmcpIHsKICogICAgICAgICBlY2hhcnRzLnJlZ2lzdGVyTWFwKCdhaXJwb3J0JywgewogKiAgICAgICAgICAgICBzdmc6IHN2ZwogKiAgICAgICAgIH0KICogICAgIH0pOwogKgogKiAgICAgZWNoYXJ0cy5yZWdpc3Rlck1hcCgnZXUnLCBbCiAqICAgICAgICAge3N2ZzogZXUtdG9wb2dyYXBoaWMuc3ZnfSwKICogICAgICAgICB7Z2VvSlNPTjogZXUuanNvbn0KICogICAgIF0pCiAqLwoKCmZ1bmN0aW9uIHJlZ2lzdGVyTWFwKG1hcE5hbWUsIGdlb0pzb24sIHNwZWNpYWxBcmVhcykgewogIG1hcERhdGFTdG9yYWdlLnJlZ2lzdGVyTWFwKG1hcE5hbWUsIGdlb0pzb24sIHNwZWNpYWxBcmVhcyk7Cn0KLyoqCiAqIEBwYXJhbSB7c3RyaW5nfSBtYXBOYW1lCiAqIEByZXR1cm4ge09iamVjdH0KICovCgoKZnVuY3Rpb24gZ2V0TWFwKG1hcE5hbWUpIHsKICAvLyBGb3IgYmFja3dhcmQgY29tcGF0aWJpbGl0eSwgb25seSByZXR1cm4gdGhlIGZpcnN0IG9uZS4KICB2YXIgcmVjb3JkcyA9IG1hcERhdGFTdG9yYWdlLnJldHJpZXZlTWFwKG1hcE5hbWUpOwogIHJldHVybiByZWNvcmRzICYmIHJlY29yZHNbMF0gJiYgewogICAgZ2VvSnNvbjogcmVjb3Jkc1swXS5nZW9KU09OLAogICAgc3BlY2lhbEFyZWFzOiByZWNvcmRzWzBdLnNwZWNpYWxBcmVhcwogIH07Cn0KCnJlZ2lzdGVyVmlzdWFsKFBSSU9SSVRZX1ZJU1VBTF9HTE9CQUwsIHNlcmllc0NvbG9yKTsKcmVnaXN0ZXJQcmVwcm9jZXNzb3IoYmFja3dhcmRDb21wYXQpOwpyZWdpc3RlclByb2Nlc3NvcihQUklPUklUWV9QUk9DRVNTT1JfREFUQVNUQUNLLCBkYXRhU3RhY2spOwpyZWdpc3RlckxvYWRpbmcoJ2RlZmF1bHQnLCBsb2FkaW5nRGVmYXVsdCk7IC8vIERlZmF1bHQgYWN0aW9ucwoKcmVnaXN0ZXJBY3Rpb24oewogIHR5cGU6ICdoaWdobGlnaHQnLAogIGV2ZW50OiAnaGlnaGxpZ2h0JywKICB1cGRhdGU6ICdoaWdobGlnaHQnCn0sIHpyVXRpbC5ub29wKTsKcmVnaXN0ZXJBY3Rpb24oewogIHR5cGU6ICdkb3ducGxheScsCiAgZXZlbnQ6ICdkb3ducGxheScsCiAgdXBkYXRlOiAnZG93bnBsYXknCn0sIHpyVXRpbC5ub29wKTsgLy8gRGVmYXVsdCB0aGVtZQoKcmVnaXN0ZXJUaGVtZSgnbGlnaHQnLCBsaWdodFRoZW1lKTsKcmVnaXN0ZXJUaGVtZSgnZGFyaycsIGRhcmtUaGVtZSk7IC8vIEZvciBiYWNrd2FyZCBjb21wYXRpYmlsaXR5LCB3aGVyZSB0aGUgbmFtZXNwYWNlIGBkYXRhVG9vbGAgd2lsbAovLyBiZSBtb3VudGVkIG9uIGBlY2hhcnRzYCBpcyB0aGUgZXh0ZW5zaW9uIGBkYXRhVG9vbGAgaXMgaW1wb3J0ZWQuCgp2YXIgZGF0YVRvb2wgPSB7fTsKZXhwb3J0cy52ZXJzaW9uID0gdmVyc2lvbjsKZXhwb3J0cy5kZXBlbmRlbmNpZXMgPSBkZXBlbmRlbmNpZXM7CmV4cG9ydHMuUFJJT1JJVFkgPSBQUklPUklUWTsKZXhwb3J0cy5pbml0ID0gaW5pdDsKZXhwb3J0cy5jb25uZWN0ID0gY29ubmVjdDsKZXhwb3J0cy5kaXNDb25uZWN0ID0gZGlzQ29ubmVjdDsKZXhwb3J0cy5kaXNjb25uZWN0ID0gZGlzY29ubmVjdDsKZXhwb3J0cy5kaXNwb3NlID0gZGlzcG9zZTsKZXhwb3J0cy5nZXRJbnN0YW5jZUJ5RG9tID0gZ2V0SW5zdGFuY2VCeURvbTsKZXhwb3J0cy5nZXRJbnN0YW5jZUJ5SWQgPSBnZXRJbnN0YW5jZUJ5SWQ7CmV4cG9ydHMucmVnaXN0ZXJUaGVtZSA9IHJlZ2lzdGVyVGhlbWU7CmV4cG9ydHMucmVnaXN0ZXJQcmVwcm9jZXNzb3IgPSByZWdpc3RlclByZXByb2Nlc3NvcjsKZXhwb3J0cy5yZWdpc3RlclByb2Nlc3NvciA9IHJlZ2lzdGVyUHJvY2Vzc29yOwpleHBvcnRzLnJlZ2lzdGVyUG9zdFVwZGF0ZSA9IHJlZ2lzdGVyUG9zdFVwZGF0ZTsKZXhwb3J0cy5yZWdpc3RlckFjdGlvbiA9IHJlZ2lzdGVyQWN0aW9uOwpleHBvcnRzLnJlZ2lzdGVyQ29vcmRpbmF0ZVN5c3RlbSA9IHJlZ2lzdGVyQ29vcmRpbmF0ZVN5c3RlbTsKZXhwb3J0cy5nZXRDb29yZGluYXRlU3lzdGVtRGltZW5zaW9ucyA9IGdldENvb3JkaW5hdGVTeXN0ZW1EaW1lbnNpb25zOwpleHBvcnRzLnJlZ2lzdGVyTGF5b3V0ID0gcmVnaXN0ZXJMYXlvdXQ7CmV4cG9ydHMucmVnaXN0ZXJWaXN1YWwgPSByZWdpc3RlclZpc3VhbDsKZXhwb3J0cy5yZWdpc3RlckxvYWRpbmcgPSByZWdpc3RlckxvYWRpbmc7CmV4cG9ydHMuZXh0ZW5kQ29tcG9uZW50TW9kZWwgPSBleHRlbmRDb21wb25lbnRNb2RlbDsKZXhwb3J0cy5leHRlbmRDb21wb25lbnRWaWV3ID0gZXh0ZW5kQ29tcG9uZW50VmlldzsKZXhwb3J0cy5leHRlbmRTZXJpZXNNb2RlbCA9IGV4dGVuZFNlcmllc01vZGVsOwpleHBvcnRzLmV4dGVuZENoYXJ0VmlldyA9IGV4dGVuZENoYXJ0VmlldzsKZXhwb3J0cy5zZXRDYW52YXNDcmVhdG9yID0gc2V0Q2FudmFzQ3JlYXRvcjsKZXhwb3J0cy5yZWdpc3Rlck1hcCA9IHJlZ2lzdGVyTWFwOwpleHBvcnRzLmdldE1hcCA9IGdldE1hcDsKZXhwb3J0cy5kYXRhVG9vbCA9IGRhdGFUb29sOwoKdmFyIF9fX2VjX2V4cG9ydCA9IHJlcXVpcmUoIi4vZXhwb3J0Iik7CgooZnVuY3Rpb24gKCkgewogIGZvciAodmFyIGtleSBpbiBfX19lY19leHBvcnQpIHsKICAgIGlmIChfX19lY19leHBvcnQuaGFzT3duUHJvcGVydHkoa2V5KSkgewogICAgICBleHBvcnRzW2tleV0gPSBfX19lY19leHBvcnRba2V5XTsKICAgIH0KICB9Cn0pKCk7"},{"version":3,"sources":["/Users/id-repair/Documents/SEOL/4c-dashboard/node_modules/echarts/lib/echarts.js"],"names":["_config","require","__DEV__","zrender","zrUtil","colorTool","env","timsort","Eventful","GlobalModel","ExtensionAPI","CoordinateSystemManager","OptionManager","backwardCompat","dataStack","ComponentModel","SeriesModel","ComponentView","ChartView","graphic","modelUtil","_throttle","throttle","seriesColor","aria","loadingDefault","Scheduler","lightTheme","darkTheme","mapDataStorage","assert","each","isFunction","isObject","parseClassType","version","dependencies","TEST_FRAME_REMAIN_TIME","PRIORITY_PROCESSOR_FILTER","PRIORITY_PROCESSOR_SERIES_FILTER","PRIORITY_PROCESSOR_DATASTACK","PRIORITY_PROCESSOR_STATISTIC","PRIORITY_VISUAL_LAYOUT","PRIORITY_VISUAL_PROGRESSIVE_LAYOUT","PRIORITY_VISUAL_GLOBAL","PRIORITY_VISUAL_CHART","PRIORITY_VISUAL_POST_CHART_LAYOUT","PRIORITY_VISUAL_COMPONENT","PRIORITY_VISUAL_BRUSH","PRIORITY","PROCESSOR","FILTER","SERIES_FILTER","STATISTIC","VISUAL","LAYOUT","PROGRESSIVE_LAYOUT","GLOBAL","CHART","POST_CHART_LAYOUT","COMPONENT","BRUSH","IN_MAIN_PROCESS","OPTION_UPDATED","ACTION_REG","createRegisterEventWithLowercaseName","method","ignoreDisposed","eventName","handler","context","_disposed","disposedWarning","id","toLowerCase","prototype","call","MessageCenter","on","off","one","mixin","ECharts","dom","theme","opts","themeStorage","group","_dom","defaultRenderer","zr","_zr","init","renderer","devicePixelRatio","width","height","_throttledZrFlush","bind","flush","clone","_theme","_chartsViews","_chartsMap","_componentsViews","_componentsMap","_coordSysMgr","api","_api","createExtensionAPI","prioritySortFunc","a","b","__prio","visualFuncs","dataProcessorFuncs","_scheduler","_ecEventProcessor","EventProcessor","_messageCenter","_initEvents","resize","_pendingActions","animation","_onframe","bindRenderedEvent","setAsPrimitive","echartsProto","scheduler","silent","prepare","updateMethods","update","flushPendingActions","triggerUpdatedEvent","unfinished","remainTime","ecModel","_model","startTime","Date","performSeriesTasks","performDataProcessorTasks","updateStreamModes","performVisualTasks","renderSeries","getDom","getZr","setOption","option","notMerge","lazyUpdate","optionManager","optionPreprocessorFuncs","setTheme","console","error","getModel","getOption","getWidth","getHeight","getDevicePixelRatio","painter","dpr","window","getRenderedCanvas","canvasSupported","pixelRatio","backgroundColor","get","getSvgDataURL","svgSupported","list","storage","getDisplayList","el","stopAnimation","toDataURL","getDataURL","excludeComponents","excludesComponentViews","self","componentType","eachComponent","mainType","component","view","__viewId","ignore","push","url","getType","type","getConnectedDataURL","isSvg","groupId","mathMin","Math","min","mathMax","max","MAX_NUMBER","Infinity","connectedGroups","left","top","right","bottom","canvasList","instances","chart","canvas","getSvgDom","innerHTML","boundingRect","getBoundingClientRect","targetCanvas","createCanvas","content","item","x","y","getSvgRoot","connectedBackgroundColor","setBackgroundColor","refreshImmediately","add","Rect","shape","style","fill","img","Image","image","convertToPixel","curry","doConvertPixel","convertFromPixel","methodName","finder","value","coordSysList","getCoordinateSystems","result","parseFinder","i","length","coordSys","containPixel","models","key","indexOf","model","coordinateSystem","containPoint","getVisual","visualType","defaultMainType","seriesModel","data","getData","dataIndexInside","hasOwnProperty","indexOfRawIndex","dataIndex","getItemVisual","getViewOfComponentModel","componentModel","getViewOfSeriesModel","prepareAndUpdate","payload","coordSysMgr","restoreData","create","clearColorPalette","render","colorArr","parse","stringify","performPostUpdateFuncs","updateTransform","ecIns","componentDirtyList","componentView","__alive","seriesDirtyMap","createHashMap","eachSeries","chartView","set","uid","setDirty","dirtyMap","updateView","markUpdateMethod","updateVisual","updateLayout","restorePipelines","prepareStageTasks","prepareView","plan","updateDirectly","subType","concat","callView","query","condition","excludeSeriesId","normalizeToArray","__model","_loadingFX","optionChanged","resetOption","chartsMap","showLoading","name","cfg","hideLoading","loadingEffects","remove","makeActionFromEvent","eventObj","extend","eventActionMap","dispatchAction","opt","actions","doDispatchAction","browser","weChat","payloadType","escapeConnect","actionWrap","actionInfo","cptType","split","updateMethod","pop","payloads","batched","batch","map","defaults","eventObjBatch","isHighDown","batchItem","action","event","main","sub","trigger","pendingActions","shift","isFinished","appendData","params","seriesIndex","getSeriesByIndex","isComponent","viewList","viewMap","doPrepare","viewId","classType","Clazz","getClass","__id","__ecComponentInfo","index","componentIndex","renderTask","dispose","splice","renderComponents","dirtyList","updateZ","updatePayload","dirty","perform","getPerformArgs","updateBlend","updateHoverLayerStatus","postUpdateFuncs","func","MOUSE_EVENT_NAMES","eveName","e","target","isGlobalOut","dataModel","getDataParams","dataType","eventData","getComponent","eventInfo","targetEl","packedEvent","zrEventfulCallAtLast","actionType","eventType","isDisposed","clear","series","setAttribute","DOM_ATTRIBUTE_KEY","elCount","traverse","node","preventUsingHoverLayer","useHoverLayer","blendMode","isGroup","blend","setStyle","eachPendingDisplayable","displayable","z","zlevel","ecInstance","getComponentByElement","modelInfo","parent","constructor","normalizeQuery","cptQuery","dataQuery","otherQuery","isString","condCptType","suffixes","dataKeys","val","reserved","propSuffix","suffixPos","lastIndexOf","slice","filter","args","check","filterForExposedEvent","host","prop","propOnHost","afterTrigger","idBase","groupIdBase","enableConnect","STATUS_PENDING","STATUS_UPDATING","STATUS_UPDATED","STATUS_KEY","updateConnectedChartsStatus","charts","status","otherChart","otherCharts","existInstance","getInstanceByDom","connect","isArray","disConnect","disconnect","getAttribute","getInstanceById","registerTheme","registerPreprocessor","preprocessorFunc","registerProcessor","priority","processor","normalizeRegister","registerPostUpdate","postUpdateFunc","registerAction","test","registerCoordinateSystem","CoordinateSystem","register","getCoordinateSystemDimensions","coordSysCreator","getDimensionsInfo","dimensions","registerLayout","layoutTask","registerVisual","visualTask","targetList","fn","defaultPriority","stageHandler","wrapStageHandler","__raw","registerLoading","loadingFx","extendComponentModel","extendComponentView","extendSeriesModel","extendChartView","setCanvasCreator","creator","$override","registerMap","mapName","geoJson","specialAreas","getMap","records","retrieveMap","geoJSON","noop","dataTool","exports","___ec_export"],"mappings":"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","sourcesContent":["\n/*\n* Licensed to the Apache Software Foundation (ASF) under one\n* or more contributor license agreements.  See the NOTICE file\n* distributed with this work for additional information\n* regarding copyright ownership.  The ASF licenses this file\n* to you under the Apache License, Version 2.0 (the\n* \"License\"); you may not use this file except in compliance\n* with the License.  You may obtain a copy of the License at\n*\n*   http://www.apache.org/licenses/LICENSE-2.0\n*\n* Unless required by applicable law or agreed to in writing,\n* software distributed under the License is distributed on an\n* \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n* KIND, either express or implied.  See the License for the\n* specific language governing permissions and limitations\n* under the License.\n*/\n\nvar _config = require(\"./config\");\n\nvar __DEV__ = _config.__DEV__;\n\nvar zrender = require(\"zrender/lib/zrender\");\n\nvar zrUtil = require(\"zrender/lib/core/util\");\n\nvar colorTool = require(\"zrender/lib/tool/color\");\n\nvar env = require(\"zrender/lib/core/env\");\n\nvar timsort = require(\"zrender/lib/core/timsort\");\n\nvar Eventful = require(\"zrender/lib/mixin/Eventful\");\n\nvar GlobalModel = require(\"./model/Global\");\n\nvar ExtensionAPI = require(\"./ExtensionAPI\");\n\nvar CoordinateSystemManager = require(\"./CoordinateSystem\");\n\nvar OptionManager = require(\"./model/OptionManager\");\n\nvar backwardCompat = require(\"./preprocessor/backwardCompat\");\n\nvar dataStack = require(\"./processor/dataStack\");\n\nvar ComponentModel = require(\"./model/Component\");\n\nvar SeriesModel = require(\"./model/Series\");\n\nvar ComponentView = require(\"./view/Component\");\n\nvar ChartView = require(\"./view/Chart\");\n\nvar graphic = require(\"./util/graphic\");\n\nvar modelUtil = require(\"./util/model\");\n\nvar _throttle = require(\"./util/throttle\");\n\nvar throttle = _throttle.throttle;\n\nvar seriesColor = require(\"./visual/seriesColor\");\n\nvar aria = require(\"./visual/aria\");\n\nvar loadingDefault = require(\"./loading/default\");\n\nvar Scheduler = require(\"./stream/Scheduler\");\n\nvar lightTheme = require(\"./theme/light\");\n\nvar darkTheme = require(\"./theme/dark\");\n\nrequire(\"./component/dataset\");\n\nvar mapDataStorage = require(\"./coord/geo/mapDataStorage\");\n\n/*\n* Licensed to the Apache Software Foundation (ASF) under one\n* or more contributor license agreements.  See the NOTICE file\n* distributed with this work for additional information\n* regarding copyright ownership.  The ASF licenses this file\n* to you under the Apache License, Version 2.0 (the\n* \"License\"); you may not use this file except in compliance\n* with the License.  You may obtain a copy of the License at\n*\n*   http://www.apache.org/licenses/LICENSE-2.0\n*\n* Unless required by applicable law or agreed to in writing,\n* software distributed under the License is distributed on an\n* \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n* KIND, either express or implied.  See the License for the\n* specific language governing permissions and limitations\n* under the License.\n*/\nvar assert = zrUtil.assert;\nvar each = zrUtil.each;\nvar isFunction = zrUtil.isFunction;\nvar isObject = zrUtil.isObject;\nvar parseClassType = ComponentModel.parseClassType;\nvar version = '4.9.0';\nvar dependencies = {\n  zrender: '4.3.2'\n};\nvar TEST_FRAME_REMAIN_TIME = 1;\nvar PRIORITY_PROCESSOR_FILTER = 1000;\nvar PRIORITY_PROCESSOR_SERIES_FILTER = 800;\nvar PRIORITY_PROCESSOR_DATASTACK = 900;\nvar PRIORITY_PROCESSOR_STATISTIC = 5000;\nvar PRIORITY_VISUAL_LAYOUT = 1000;\nvar PRIORITY_VISUAL_PROGRESSIVE_LAYOUT = 1100;\nvar PRIORITY_VISUAL_GLOBAL = 2000;\nvar PRIORITY_VISUAL_CHART = 3000;\nvar PRIORITY_VISUAL_POST_CHART_LAYOUT = 3500;\nvar PRIORITY_VISUAL_COMPONENT = 4000; // FIXME\n// necessary?\n\nvar PRIORITY_VISUAL_BRUSH = 5000;\nvar PRIORITY = {\n  PROCESSOR: {\n    FILTER: PRIORITY_PROCESSOR_FILTER,\n    SERIES_FILTER: PRIORITY_PROCESSOR_SERIES_FILTER,\n    STATISTIC: PRIORITY_PROCESSOR_STATISTIC\n  },\n  VISUAL: {\n    LAYOUT: PRIORITY_VISUAL_LAYOUT,\n    PROGRESSIVE_LAYOUT: PRIORITY_VISUAL_PROGRESSIVE_LAYOUT,\n    GLOBAL: PRIORITY_VISUAL_GLOBAL,\n    CHART: PRIORITY_VISUAL_CHART,\n    POST_CHART_LAYOUT: PRIORITY_VISUAL_POST_CHART_LAYOUT,\n    COMPONENT: PRIORITY_VISUAL_COMPONENT,\n    BRUSH: PRIORITY_VISUAL_BRUSH\n  }\n}; // Main process have three entries: `setOption`, `dispatchAction` and `resize`,\n// where they must not be invoked nestedly, except the only case: invoke\n// dispatchAction with updateMethod \"none\" in main process.\n// This flag is used to carry out this rule.\n// All events will be triggered out side main process (i.e. when !this[IN_MAIN_PROCESS]).\n\nvar IN_MAIN_PROCESS = '__flagInMainProcess';\nvar OPTION_UPDATED = '__optionUpdated';\nvar ACTION_REG = /^[a-zA-Z0-9_]+$/;\n\nfunction createRegisterEventWithLowercaseName(method, ignoreDisposed) {\n  return function (eventName, handler, context) {\n    if (!ignoreDisposed && this._disposed) {\n      disposedWarning(this.id);\n      return;\n    } // Event name is all lowercase\n\n\n    eventName = eventName && eventName.toLowerCase();\n    Eventful.prototype[method].call(this, eventName, handler, context);\n  };\n}\n/**\n * @module echarts~MessageCenter\n */\n\n\nfunction MessageCenter() {\n  Eventful.call(this);\n}\n\nMessageCenter.prototype.on = createRegisterEventWithLowercaseName('on', true);\nMessageCenter.prototype.off = createRegisterEventWithLowercaseName('off', true);\nMessageCenter.prototype.one = createRegisterEventWithLowercaseName('one', true);\nzrUtil.mixin(MessageCenter, Eventful);\n/**\n * @module echarts~ECharts\n */\n\nfunction ECharts(dom, theme, opts) {\n  opts = opts || {}; // Get theme by name\n\n  if (typeof theme === 'string') {\n    theme = themeStorage[theme];\n  }\n  /**\n   * @type {string}\n   */\n\n\n  this.id;\n  /**\n   * Group id\n   * @type {string}\n   */\n\n  this.group;\n  /**\n   * @type {HTMLElement}\n   * @private\n   */\n\n  this._dom = dom;\n  var defaultRenderer = 'canvas';\n\n  /**\n   * @type {module:zrender/ZRender}\n   * @private\n   */\n  var zr = this._zr = zrender.init(dom, {\n    renderer: opts.renderer || defaultRenderer,\n    devicePixelRatio: opts.devicePixelRatio,\n    width: opts.width,\n    height: opts.height\n  });\n  /**\n   * Expect 60 fps.\n   * @type {Function}\n   * @private\n   */\n\n  this._throttledZrFlush = throttle(zrUtil.bind(zr.flush, zr), 17);\n  var theme = zrUtil.clone(theme);\n  theme && backwardCompat(theme, true);\n  /**\n   * @type {Object}\n   * @private\n   */\n\n  this._theme = theme;\n  /**\n   * @type {Array.<module:echarts/view/Chart>}\n   * @private\n   */\n\n  this._chartsViews = [];\n  /**\n   * @type {Object.<string, module:echarts/view/Chart>}\n   * @private\n   */\n\n  this._chartsMap = {};\n  /**\n   * @type {Array.<module:echarts/view/Component>}\n   * @private\n   */\n\n  this._componentsViews = [];\n  /**\n   * @type {Object.<string, module:echarts/view/Component>}\n   * @private\n   */\n\n  this._componentsMap = {};\n  /**\n   * @type {module:echarts/CoordinateSystem}\n   * @private\n   */\n\n  this._coordSysMgr = new CoordinateSystemManager();\n  /**\n   * @type {module:echarts/ExtensionAPI}\n   * @private\n   */\n\n  var api = this._api = createExtensionAPI(this); // Sort on demand\n\n  function prioritySortFunc(a, b) {\n    return a.__prio - b.__prio;\n  }\n\n  timsort(visualFuncs, prioritySortFunc);\n  timsort(dataProcessorFuncs, prioritySortFunc);\n  /**\n   * @type {module:echarts/stream/Scheduler}\n   */\n\n  this._scheduler = new Scheduler(this, api, dataProcessorFuncs, visualFuncs);\n  Eventful.call(this, this._ecEventProcessor = new EventProcessor());\n  /**\n   * @type {module:echarts~MessageCenter}\n   * @private\n   */\n\n  this._messageCenter = new MessageCenter(); // Init mouse events\n\n  this._initEvents(); // In case some people write `window.onresize = chart.resize`\n\n\n  this.resize = zrUtil.bind(this.resize, this); // Can't dispatch action during rendering procedure\n\n  this._pendingActions = [];\n  zr.animation.on('frame', this._onframe, this);\n  bindRenderedEvent(zr, this); // ECharts instance can be used as value.\n\n  zrUtil.setAsPrimitive(this);\n}\n\nvar echartsProto = ECharts.prototype;\n\nechartsProto._onframe = function () {\n  if (this._disposed) {\n    return;\n  }\n\n  var scheduler = this._scheduler; // Lazy update\n\n  if (this[OPTION_UPDATED]) {\n    var silent = this[OPTION_UPDATED].silent;\n    this[IN_MAIN_PROCESS] = true;\n    prepare(this);\n    updateMethods.update.call(this);\n    this[IN_MAIN_PROCESS] = false;\n    this[OPTION_UPDATED] = false;\n    flushPendingActions.call(this, silent);\n    triggerUpdatedEvent.call(this, silent);\n  } // Avoid do both lazy update and progress in one frame.\n  else if (scheduler.unfinished) {\n      // Stream progress.\n      var remainTime = TEST_FRAME_REMAIN_TIME;\n      var ecModel = this._model;\n      var api = this._api;\n      scheduler.unfinished = false;\n\n      do {\n        var startTime = +new Date();\n        scheduler.performSeriesTasks(ecModel); // Currently dataProcessorFuncs do not check threshold.\n\n        scheduler.performDataProcessorTasks(ecModel);\n        updateStreamModes(this, ecModel); // Do not update coordinate system here. Because that coord system update in\n        // each frame is not a good user experience. So we follow the rule that\n        // the extent of the coordinate system is determin in the first frame (the\n        // frame is executed immedietely after task reset.\n        // this._coordSysMgr.update(ecModel, api);\n        // console.log('--- ec frame visual ---', remainTime);\n\n        scheduler.performVisualTasks(ecModel);\n        renderSeries(this, this._model, api, 'remain');\n        remainTime -= +new Date() - startTime;\n      } while (remainTime > 0 && scheduler.unfinished); // Call flush explicitly for trigger finished event.\n\n\n      if (!scheduler.unfinished) {\n        this._zr.flush();\n      } // Else, zr flushing be ensue within the same frame,\n      // because zr flushing is after onframe event.\n\n    }\n};\n/**\n * @return {HTMLElement}\n */\n\n\nechartsProto.getDom = function () {\n  return this._dom;\n};\n/**\n * @return {module:zrender~ZRender}\n */\n\n\nechartsProto.getZr = function () {\n  return this._zr;\n};\n/**\n * Usage:\n * chart.setOption(option, notMerge, lazyUpdate);\n * chart.setOption(option, {\n *     notMerge: ...,\n *     lazyUpdate: ...,\n *     silent: ...\n * });\n *\n * @param {Object} option\n * @param {Object|boolean} [opts] opts or notMerge.\n * @param {boolean} [opts.notMerge=false]\n * @param {boolean} [opts.lazyUpdate=false] Useful when setOption frequently.\n */\n\n\nechartsProto.setOption = function (option, notMerge, lazyUpdate) {\n  if (this._disposed) {\n    disposedWarning(this.id);\n    return;\n  }\n\n  var silent;\n\n  if (isObject(notMerge)) {\n    lazyUpdate = notMerge.lazyUpdate;\n    silent = notMerge.silent;\n    notMerge = notMerge.notMerge;\n  }\n\n  this[IN_MAIN_PROCESS] = true;\n\n  if (!this._model || notMerge) {\n    var optionManager = new OptionManager(this._api);\n    var theme = this._theme;\n    var ecModel = this._model = new GlobalModel();\n    ecModel.scheduler = this._scheduler;\n    ecModel.init(null, null, theme, optionManager);\n  }\n\n  this._model.setOption(option, optionPreprocessorFuncs);\n\n  if (lazyUpdate) {\n    this[OPTION_UPDATED] = {\n      silent: silent\n    };\n    this[IN_MAIN_PROCESS] = false;\n  } else {\n    prepare(this);\n    updateMethods.update.call(this); // Ensure zr refresh sychronously, and then pixel in canvas can be\n    // fetched after `setOption`.\n\n    this._zr.flush();\n\n    this[OPTION_UPDATED] = false;\n    this[IN_MAIN_PROCESS] = false;\n    flushPendingActions.call(this, silent);\n    triggerUpdatedEvent.call(this, silent);\n  }\n};\n/**\n * @DEPRECATED\n */\n\n\nechartsProto.setTheme = function () {\n  console.error('ECharts#setTheme() is DEPRECATED in ECharts 3.0');\n};\n/**\n * @return {module:echarts/model/Global}\n */\n\n\nechartsProto.getModel = function () {\n  return this._model;\n};\n/**\n * @return {Object}\n */\n\n\nechartsProto.getOption = function () {\n  return this._model && this._model.getOption();\n};\n/**\n * @return {number}\n */\n\n\nechartsProto.getWidth = function () {\n  return this._zr.getWidth();\n};\n/**\n * @return {number}\n */\n\n\nechartsProto.getHeight = function () {\n  return this._zr.getHeight();\n};\n/**\n * @return {number}\n */\n\n\nechartsProto.getDevicePixelRatio = function () {\n  return this._zr.painter.dpr || window.devicePixelRatio || 1;\n};\n/**\n * Get canvas which has all thing rendered\n * @param {Object} opts\n * @param {string} [opts.backgroundColor]\n * @return {string}\n */\n\n\nechartsProto.getRenderedCanvas = function (opts) {\n  if (!env.canvasSupported) {\n    return;\n  }\n\n  opts = opts || {};\n  opts.pixelRatio = opts.pixelRatio || 1;\n  opts.backgroundColor = opts.backgroundColor || this._model.get('backgroundColor');\n  var zr = this._zr; // var list = zr.storage.getDisplayList();\n  // Stop animations\n  // Never works before in init animation, so remove it.\n  // zrUtil.each(list, function (el) {\n  //     el.stopAnimation(true);\n  // });\n\n  return zr.painter.getRenderedCanvas(opts);\n};\n/**\n * Get svg data url\n * @return {string}\n */\n\n\nechartsProto.getSvgDataURL = function () {\n  if (!env.svgSupported) {\n    return;\n  }\n\n  var zr = this._zr;\n  var list = zr.storage.getDisplayList(); // Stop animations\n\n  zrUtil.each(list, function (el) {\n    el.stopAnimation(true);\n  });\n  return zr.painter.toDataURL();\n};\n/**\n * @return {string}\n * @param {Object} opts\n * @param {string} [opts.type='png']\n * @param {string} [opts.pixelRatio=1]\n * @param {string} [opts.backgroundColor]\n * @param {string} [opts.excludeComponents]\n */\n\n\nechartsProto.getDataURL = function (opts) {\n  if (this._disposed) {\n    disposedWarning(this.id);\n    return;\n  }\n\n  opts = opts || {};\n  var excludeComponents = opts.excludeComponents;\n  var ecModel = this._model;\n  var excludesComponentViews = [];\n  var self = this;\n  each(excludeComponents, function (componentType) {\n    ecModel.eachComponent({\n      mainType: componentType\n    }, function (component) {\n      var view = self._componentsMap[component.__viewId];\n\n      if (!view.group.ignore) {\n        excludesComponentViews.push(view);\n        view.group.ignore = true;\n      }\n    });\n  });\n  var url = this._zr.painter.getType() === 'svg' ? this.getSvgDataURL() : this.getRenderedCanvas(opts).toDataURL('image/' + (opts && opts.type || 'png'));\n  each(excludesComponentViews, function (view) {\n    view.group.ignore = false;\n  });\n  return url;\n};\n/**\n * @return {string}\n * @param {Object} opts\n * @param {string} [opts.type='png']\n * @param {string} [opts.pixelRatio=1]\n * @param {string} [opts.backgroundColor]\n */\n\n\nechartsProto.getConnectedDataURL = function (opts) {\n  if (this._disposed) {\n    disposedWarning(this.id);\n    return;\n  }\n\n  if (!env.canvasSupported) {\n    return;\n  }\n\n  var isSvg = opts.type === 'svg';\n  var groupId = this.group;\n  var mathMin = Math.min;\n  var mathMax = Math.max;\n  var MAX_NUMBER = Infinity;\n\n  if (connectedGroups[groupId]) {\n    var left = MAX_NUMBER;\n    var top = MAX_NUMBER;\n    var right = -MAX_NUMBER;\n    var bottom = -MAX_NUMBER;\n    var canvasList = [];\n    var dpr = opts && opts.pixelRatio || 1;\n    zrUtil.each(instances, function (chart, id) {\n      if (chart.group === groupId) {\n        var canvas = isSvg ? chart.getZr().painter.getSvgDom().innerHTML : chart.getRenderedCanvas(zrUtil.clone(opts));\n        var boundingRect = chart.getDom().getBoundingClientRect();\n        left = mathMin(boundingRect.left, left);\n        top = mathMin(boundingRect.top, top);\n        right = mathMax(boundingRect.right, right);\n        bottom = mathMax(boundingRect.bottom, bottom);\n        canvasList.push({\n          dom: canvas,\n          left: boundingRect.left,\n          top: boundingRect.top\n        });\n      }\n    });\n    left *= dpr;\n    top *= dpr;\n    right *= dpr;\n    bottom *= dpr;\n    var width = right - left;\n    var height = bottom - top;\n    var targetCanvas = zrUtil.createCanvas();\n    var zr = zrender.init(targetCanvas, {\n      renderer: isSvg ? 'svg' : 'canvas'\n    });\n    zr.resize({\n      width: width,\n      height: height\n    });\n\n    if (isSvg) {\n      var content = '';\n      each(canvasList, function (item) {\n        var x = item.left - left;\n        var y = item.top - top;\n        content += '<g transform=\"translate(' + x + ',' + y + ')\">' + item.dom + '</g>';\n      });\n      zr.painter.getSvgRoot().innerHTML = content;\n\n      if (opts.connectedBackgroundColor) {\n        zr.painter.setBackgroundColor(opts.connectedBackgroundColor);\n      }\n\n      zr.refreshImmediately();\n      return zr.painter.toDataURL();\n    } else {\n      // Background between the charts\n      if (opts.connectedBackgroundColor) {\n        zr.add(new graphic.Rect({\n          shape: {\n            x: 0,\n            y: 0,\n            width: width,\n            height: height\n          },\n          style: {\n            fill: opts.connectedBackgroundColor\n          }\n        }));\n      }\n\n      each(canvasList, function (item) {\n        var img = new graphic.Image({\n          style: {\n            x: item.left * dpr - left,\n            y: item.top * dpr - top,\n            image: item.dom\n          }\n        });\n        zr.add(img);\n      });\n      zr.refreshImmediately();\n      return targetCanvas.toDataURL('image/' + (opts && opts.type || 'png'));\n    }\n  } else {\n    return this.getDataURL(opts);\n  }\n};\n/**\n * Convert from logical coordinate system to pixel coordinate system.\n * See CoordinateSystem#convertToPixel.\n * @param {string|Object} finder\n *        If string, e.g., 'geo', means {geoIndex: 0}.\n *        If Object, could contain some of these properties below:\n *        {\n *            seriesIndex / seriesId / seriesName,\n *            geoIndex / geoId, geoName,\n *            bmapIndex / bmapId / bmapName,\n *            xAxisIndex / xAxisId / xAxisName,\n *            yAxisIndex / yAxisId / yAxisName,\n *            gridIndex / gridId / gridName,\n *            ... (can be extended)\n *        }\n * @param {Array|number} value\n * @return {Array|number} result\n */\n\n\nechartsProto.convertToPixel = zrUtil.curry(doConvertPixel, 'convertToPixel');\n/**\n * Convert from pixel coordinate system to logical coordinate system.\n * See CoordinateSystem#convertFromPixel.\n * @param {string|Object} finder\n *        If string, e.g., 'geo', means {geoIndex: 0}.\n *        If Object, could contain some of these properties below:\n *        {\n *            seriesIndex / seriesId / seriesName,\n *            geoIndex / geoId / geoName,\n *            bmapIndex / bmapId / bmapName,\n *            xAxisIndex / xAxisId / xAxisName,\n *            yAxisIndex / yAxisId / yAxisName\n *            gridIndex / gridId / gridName,\n *            ... (can be extended)\n *        }\n * @param {Array|number} value\n * @return {Array|number} result\n */\n\nechartsProto.convertFromPixel = zrUtil.curry(doConvertPixel, 'convertFromPixel');\n\nfunction doConvertPixel(methodName, finder, value) {\n  if (this._disposed) {\n    disposedWarning(this.id);\n    return;\n  }\n\n  var ecModel = this._model;\n\n  var coordSysList = this._coordSysMgr.getCoordinateSystems();\n\n  var result;\n  finder = modelUtil.parseFinder(ecModel, finder);\n\n  for (var i = 0; i < coordSysList.length; i++) {\n    var coordSys = coordSysList[i];\n\n    if (coordSys[methodName] && (result = coordSys[methodName](ecModel, finder, value)) != null) {\n      return result;\n    }\n  }\n}\n/**\n * Is the specified coordinate systems or components contain the given pixel point.\n * @param {string|Object} finder\n *        If string, e.g., 'geo', means {geoIndex: 0}.\n *        If Object, could contain some of these properties below:\n *        {\n *            seriesIndex / seriesId / seriesName,\n *            geoIndex / geoId / geoName,\n *            bmapIndex / bmapId / bmapName,\n *            xAxisIndex / xAxisId / xAxisName,\n *            yAxisIndex / yAxisId / yAxisName,\n *            gridIndex / gridId / gridName,\n *            ... (can be extended)\n *        }\n * @param {Array|number} value\n * @return {boolean} result\n */\n\n\nechartsProto.containPixel = function (finder, value) {\n  if (this._disposed) {\n    disposedWarning(this.id);\n    return;\n  }\n\n  var ecModel = this._model;\n  var result;\n  finder = modelUtil.parseFinder(ecModel, finder);\n  zrUtil.each(finder, function (models, key) {\n    key.indexOf('Models') >= 0 && zrUtil.each(models, function (model) {\n      var coordSys = model.coordinateSystem;\n\n      if (coordSys && coordSys.containPoint) {\n        result |= !!coordSys.containPoint(value);\n      } else if (key === 'seriesModels') {\n        var view = this._chartsMap[model.__viewId];\n\n        if (view && view.containPoint) {\n          result |= view.containPoint(value, model);\n        } else {}\n      } else {}\n    }, this);\n  }, this);\n  return !!result;\n};\n/**\n * Get visual from series or data.\n * @param {string|Object} finder\n *        If string, e.g., 'series', means {seriesIndex: 0}.\n *        If Object, could contain some of these properties below:\n *        {\n *            seriesIndex / seriesId / seriesName,\n *            dataIndex / dataIndexInside\n *        }\n *        If dataIndex is not specified, series visual will be fetched,\n *        but not data item visual.\n *        If all of seriesIndex, seriesId, seriesName are not specified,\n *        visual will be fetched from first series.\n * @param {string} visualType 'color', 'symbol', 'symbolSize'\n */\n\n\nechartsProto.getVisual = function (finder, visualType) {\n  var ecModel = this._model;\n  finder = modelUtil.parseFinder(ecModel, finder, {\n    defaultMainType: 'series'\n  });\n  var seriesModel = finder.seriesModel;\n  var data = seriesModel.getData();\n  var dataIndexInside = finder.hasOwnProperty('dataIndexInside') ? finder.dataIndexInside : finder.hasOwnProperty('dataIndex') ? data.indexOfRawIndex(finder.dataIndex) : null;\n  return dataIndexInside != null ? data.getItemVisual(dataIndexInside, visualType) : data.getVisual(visualType);\n};\n/**\n * Get view of corresponding component model\n * @param  {module:echarts/model/Component} componentModel\n * @return {module:echarts/view/Component}\n */\n\n\nechartsProto.getViewOfComponentModel = function (componentModel) {\n  return this._componentsMap[componentModel.__viewId];\n};\n/**\n * Get view of corresponding series model\n * @param  {module:echarts/model/Series} seriesModel\n * @return {module:echarts/view/Chart}\n */\n\n\nechartsProto.getViewOfSeriesModel = function (seriesModel) {\n  return this._chartsMap[seriesModel.__viewId];\n};\n\nvar updateMethods = {\n  prepareAndUpdate: function (payload) {\n    prepare(this);\n    updateMethods.update.call(this, payload);\n  },\n\n  /**\n   * @param {Object} payload\n   * @private\n   */\n  update: function (payload) {\n    // console.profile && console.profile('update');\n    var ecModel = this._model;\n    var api = this._api;\n    var zr = this._zr;\n    var coordSysMgr = this._coordSysMgr;\n    var scheduler = this._scheduler; // update before setOption\n\n    if (!ecModel) {\n      return;\n    }\n\n    scheduler.restoreData(ecModel, payload);\n    scheduler.performSeriesTasks(ecModel); // TODO\n    // Save total ecModel here for undo/redo (after restoring data and before processing data).\n    // Undo (restoration of total ecModel) can be carried out in 'action' or outside API call.\n    // Create new coordinate system each update\n    // In LineView may save the old coordinate system and use it to get the orignal point\n\n    coordSysMgr.create(ecModel, api);\n    scheduler.performDataProcessorTasks(ecModel, payload); // Current stream render is not supported in data process. So we can update\n    // stream modes after data processing, where the filtered data is used to\n    // deteming whether use progressive rendering.\n\n    updateStreamModes(this, ecModel); // We update stream modes before coordinate system updated, then the modes info\n    // can be fetched when coord sys updating (consider the barGrid extent fix). But\n    // the drawback is the full coord info can not be fetched. Fortunately this full\n    // coord is not requied in stream mode updater currently.\n\n    coordSysMgr.update(ecModel, api);\n    clearColorPalette(ecModel);\n    scheduler.performVisualTasks(ecModel, payload);\n    render(this, ecModel, api, payload); // Set background\n\n    var backgroundColor = ecModel.get('backgroundColor') || 'transparent'; // In IE8\n\n    if (!env.canvasSupported) {\n      var colorArr = colorTool.parse(backgroundColor);\n      backgroundColor = colorTool.stringify(colorArr, 'rgb');\n\n      if (colorArr[3] === 0) {\n        backgroundColor = 'transparent';\n      }\n    } else {\n      zr.setBackgroundColor(backgroundColor);\n    }\n\n    performPostUpdateFuncs(ecModel, api); // console.profile && console.profileEnd('update');\n  },\n\n  /**\n   * @param {Object} payload\n   * @private\n   */\n  updateTransform: function (payload) {\n    var ecModel = this._model;\n    var ecIns = this;\n    var api = this._api; // update before setOption\n\n    if (!ecModel) {\n      return;\n    } // ChartView.markUpdateMethod(payload, 'updateTransform');\n\n\n    var componentDirtyList = [];\n    ecModel.eachComponent(function (componentType, componentModel) {\n      var componentView = ecIns.getViewOfComponentModel(componentModel);\n\n      if (componentView && componentView.__alive) {\n        if (componentView.updateTransform) {\n          var result = componentView.updateTransform(componentModel, ecModel, api, payload);\n          result && result.update && componentDirtyList.push(componentView);\n        } else {\n          componentDirtyList.push(componentView);\n        }\n      }\n    });\n    var seriesDirtyMap = zrUtil.createHashMap();\n    ecModel.eachSeries(function (seriesModel) {\n      var chartView = ecIns._chartsMap[seriesModel.__viewId];\n\n      if (chartView.updateTransform) {\n        var result = chartView.updateTransform(seriesModel, ecModel, api, payload);\n        result && result.update && seriesDirtyMap.set(seriesModel.uid, 1);\n      } else {\n        seriesDirtyMap.set(seriesModel.uid, 1);\n      }\n    });\n    clearColorPalette(ecModel); // Keep pipe to the exist pipeline because it depends on the render task of the full pipeline.\n    // this._scheduler.performVisualTasks(ecModel, payload, 'layout', true);\n\n    this._scheduler.performVisualTasks(ecModel, payload, {\n      setDirty: true,\n      dirtyMap: seriesDirtyMap\n    }); // Currently, not call render of components. Geo render cost a lot.\n    // renderComponents(ecIns, ecModel, api, payload, componentDirtyList);\n\n\n    renderSeries(ecIns, ecModel, api, payload, seriesDirtyMap);\n    performPostUpdateFuncs(ecModel, this._api);\n  },\n\n  /**\n   * @param {Object} payload\n   * @private\n   */\n  updateView: function (payload) {\n    var ecModel = this._model; // update before setOption\n\n    if (!ecModel) {\n      return;\n    }\n\n    ChartView.markUpdateMethod(payload, 'updateView');\n    clearColorPalette(ecModel); // Keep pipe to the exist pipeline because it depends on the render task of the full pipeline.\n\n    this._scheduler.performVisualTasks(ecModel, payload, {\n      setDirty: true\n    });\n\n    render(this, this._model, this._api, payload);\n    performPostUpdateFuncs(ecModel, this._api);\n  },\n\n  /**\n   * @param {Object} payload\n   * @private\n   */\n  updateVisual: function (payload) {\n    updateMethods.update.call(this, payload); // var ecModel = this._model;\n    // // update before setOption\n    // if (!ecModel) {\n    //     return;\n    // }\n    // ChartView.markUpdateMethod(payload, 'updateVisual');\n    // clearColorPalette(ecModel);\n    // // Keep pipe to the exist pipeline because it depends on the render task of the full pipeline.\n    // this._scheduler.performVisualTasks(ecModel, payload, {visualType: 'visual', setDirty: true});\n    // render(this, this._model, this._api, payload);\n    // performPostUpdateFuncs(ecModel, this._api);\n  },\n\n  /**\n   * @param {Object} payload\n   * @private\n   */\n  updateLayout: function (payload) {\n    updateMethods.update.call(this, payload); // var ecModel = this._model;\n    // // update before setOption\n    // if (!ecModel) {\n    //     return;\n    // }\n    // ChartView.markUpdateMethod(payload, 'updateLayout');\n    // // Keep pipe to the exist pipeline because it depends on the render task of the full pipeline.\n    // // this._scheduler.performVisualTasks(ecModel, payload, 'layout', true);\n    // this._scheduler.performVisualTasks(ecModel, payload, {setDirty: true});\n    // render(this, this._model, this._api, payload);\n    // performPostUpdateFuncs(ecModel, this._api);\n  }\n};\n\nfunction prepare(ecIns) {\n  var ecModel = ecIns._model;\n  var scheduler = ecIns._scheduler;\n  scheduler.restorePipelines(ecModel);\n  scheduler.prepareStageTasks();\n  prepareView(ecIns, 'component', ecModel, scheduler);\n  prepareView(ecIns, 'chart', ecModel, scheduler);\n  scheduler.plan();\n}\n/**\n * @private\n */\n\n\nfunction updateDirectly(ecIns, method, payload, mainType, subType) {\n  var ecModel = ecIns._model; // broadcast\n\n  if (!mainType) {\n    // FIXME\n    // Chart will not be update directly here, except set dirty.\n    // But there is no such scenario now.\n    each(ecIns._componentsViews.concat(ecIns._chartsViews), callView);\n    return;\n  }\n\n  var query = {};\n  query[mainType + 'Id'] = payload[mainType + 'Id'];\n  query[mainType + 'Index'] = payload[mainType + 'Index'];\n  query[mainType + 'Name'] = payload[mainType + 'Name'];\n  var condition = {\n    mainType: mainType,\n    query: query\n  };\n  subType && (condition.subType = subType); // subType may be '' by parseClassType;\n\n  var excludeSeriesId = payload.excludeSeriesId;\n\n  if (excludeSeriesId != null) {\n    excludeSeriesId = zrUtil.createHashMap(modelUtil.normalizeToArray(excludeSeriesId));\n  } // If dispatchAction before setOption, do nothing.\n\n\n  ecModel && ecModel.eachComponent(condition, function (model) {\n    if (!excludeSeriesId || excludeSeriesId.get(model.id) == null) {\n      callView(ecIns[mainType === 'series' ? '_chartsMap' : '_componentsMap'][model.__viewId]);\n    }\n  }, ecIns);\n\n  function callView(view) {\n    view && view.__alive && view[method] && view[method](view.__model, ecModel, ecIns._api, payload);\n  }\n}\n/**\n * Resize the chart\n * @param {Object} opts\n * @param {number} [opts.width] Can be 'auto' (the same as null/undefined)\n * @param {number} [opts.height] Can be 'auto' (the same as null/undefined)\n * @param {boolean} [opts.silent=false]\n */\n\n\nechartsProto.resize = function (opts) {\n  if (this._disposed) {\n    disposedWarning(this.id);\n    return;\n  }\n\n  this._zr.resize(opts);\n\n  var ecModel = this._model; // Resize loading effect\n\n  this._loadingFX && this._loadingFX.resize();\n\n  if (!ecModel) {\n    return;\n  }\n\n  var optionChanged = ecModel.resetOption('media');\n  var silent = opts && opts.silent;\n  this[IN_MAIN_PROCESS] = true;\n  optionChanged && prepare(this);\n  updateMethods.update.call(this);\n  this[IN_MAIN_PROCESS] = false;\n  flushPendingActions.call(this, silent);\n  triggerUpdatedEvent.call(this, silent);\n};\n\nfunction updateStreamModes(ecIns, ecModel) {\n  var chartsMap = ecIns._chartsMap;\n  var scheduler = ecIns._scheduler;\n  ecModel.eachSeries(function (seriesModel) {\n    scheduler.updateStreamModes(seriesModel, chartsMap[seriesModel.__viewId]);\n  });\n}\n/**\n * Show loading effect\n * @param  {string} [name='default']\n * @param  {Object} [cfg]\n */\n\n\nechartsProto.showLoading = function (name, cfg) {\n  if (this._disposed) {\n    disposedWarning(this.id);\n    return;\n  }\n\n  if (isObject(name)) {\n    cfg = name;\n    name = '';\n  }\n\n  name = name || 'default';\n  this.hideLoading();\n\n  if (!loadingEffects[name]) {\n    return;\n  }\n\n  var el = loadingEffects[name](this._api, cfg);\n  var zr = this._zr;\n  this._loadingFX = el;\n  zr.add(el);\n};\n/**\n * Hide loading effect\n */\n\n\nechartsProto.hideLoading = function () {\n  if (this._disposed) {\n    disposedWarning(this.id);\n    return;\n  }\n\n  this._loadingFX && this._zr.remove(this._loadingFX);\n  this._loadingFX = null;\n};\n/**\n * @param {Object} eventObj\n * @return {Object}\n */\n\n\nechartsProto.makeActionFromEvent = function (eventObj) {\n  var payload = zrUtil.extend({}, eventObj);\n  payload.type = eventActionMap[eventObj.type];\n  return payload;\n};\n/**\n * @pubilc\n * @param {Object} payload\n * @param {string} [payload.type] Action type\n * @param {Object|boolean} [opt] If pass boolean, means opt.silent\n * @param {boolean} [opt.silent=false] Whether trigger events.\n * @param {boolean} [opt.flush=undefined]\n *                  true: Flush immediately, and then pixel in canvas can be fetched\n *                      immediately. Caution: it might affect performance.\n *                  false: Not flush.\n *                  undefined: Auto decide whether perform flush.\n */\n\n\nechartsProto.dispatchAction = function (payload, opt) {\n  if (this._disposed) {\n    disposedWarning(this.id);\n    return;\n  }\n\n  if (!isObject(opt)) {\n    opt = {\n      silent: !!opt\n    };\n  }\n\n  if (!actions[payload.type]) {\n    return;\n  } // Avoid dispatch action before setOption. Especially in `connect`.\n\n\n  if (!this._model) {\n    return;\n  } // May dispatchAction in rendering procedure\n\n\n  if (this[IN_MAIN_PROCESS]) {\n    this._pendingActions.push(payload);\n\n    return;\n  }\n\n  doDispatchAction.call(this, payload, opt.silent);\n\n  if (opt.flush) {\n    this._zr.flush(true);\n  } else if (opt.flush !== false && env.browser.weChat) {\n    // In WeChat embeded browser, `requestAnimationFrame` and `setInterval`\n    // hang when sliding page (on touch event), which cause that zr does not\n    // refresh util user interaction finished, which is not expected.\n    // But `dispatchAction` may be called too frequently when pan on touch\n    // screen, which impacts performance if do not throttle them.\n    this._throttledZrFlush();\n  }\n\n  flushPendingActions.call(this, opt.silent);\n  triggerUpdatedEvent.call(this, opt.silent);\n};\n\nfunction doDispatchAction(payload, silent) {\n  var payloadType = payload.type;\n  var escapeConnect = payload.escapeConnect;\n  var actionWrap = actions[payloadType];\n  var actionInfo = actionWrap.actionInfo;\n  var cptType = (actionInfo.update || 'update').split(':');\n  var updateMethod = cptType.pop();\n  cptType = cptType[0] != null && parseClassType(cptType[0]);\n  this[IN_MAIN_PROCESS] = true;\n  var payloads = [payload];\n  var batched = false; // Batch action\n\n  if (payload.batch) {\n    batched = true;\n    payloads = zrUtil.map(payload.batch, function (item) {\n      item = zrUtil.defaults(zrUtil.extend({}, item), payload);\n      item.batch = null;\n      return item;\n    });\n  }\n\n  var eventObjBatch = [];\n  var eventObj;\n  var isHighDown = payloadType === 'highlight' || payloadType === 'downplay';\n  each(payloads, function (batchItem) {\n    // Action can specify the event by return it.\n    eventObj = actionWrap.action(batchItem, this._model, this._api); // Emit event outside\n\n    eventObj = eventObj || zrUtil.extend({}, batchItem); // Convert type to eventType\n\n    eventObj.type = actionInfo.event || eventObj.type;\n    eventObjBatch.push(eventObj); // light update does not perform data process, layout and visual.\n\n    if (isHighDown) {\n      // method, payload, mainType, subType\n      updateDirectly(this, updateMethod, batchItem, 'series');\n    } else if (cptType) {\n      updateDirectly(this, updateMethod, batchItem, cptType.main, cptType.sub);\n    }\n  }, this);\n\n  if (updateMethod !== 'none' && !isHighDown && !cptType) {\n    // Still dirty\n    if (this[OPTION_UPDATED]) {\n      // FIXME Pass payload ?\n      prepare(this);\n      updateMethods.update.call(this, payload);\n      this[OPTION_UPDATED] = false;\n    } else {\n      updateMethods[updateMethod].call(this, payload);\n    }\n  } // Follow the rule of action batch\n\n\n  if (batched) {\n    eventObj = {\n      type: actionInfo.event || payloadType,\n      escapeConnect: escapeConnect,\n      batch: eventObjBatch\n    };\n  } else {\n    eventObj = eventObjBatch[0];\n  }\n\n  this[IN_MAIN_PROCESS] = false;\n  !silent && this._messageCenter.trigger(eventObj.type, eventObj);\n}\n\nfunction flushPendingActions(silent) {\n  var pendingActions = this._pendingActions;\n\n  while (pendingActions.length) {\n    var payload = pendingActions.shift();\n    doDispatchAction.call(this, payload, silent);\n  }\n}\n\nfunction triggerUpdatedEvent(silent) {\n  !silent && this.trigger('updated');\n}\n/**\n * Event `rendered` is triggered when zr\n * rendered. It is useful for realtime\n * snapshot (reflect animation).\n *\n * Event `finished` is triggered when:\n * (1) zrender rendering finished.\n * (2) initial animation finished.\n * (3) progressive rendering finished.\n * (4) no pending action.\n * (5) no delayed setOption needs to be processed.\n */\n\n\nfunction bindRenderedEvent(zr, ecIns) {\n  zr.on('rendered', function () {\n    ecIns.trigger('rendered'); // The `finished` event should not be triggered repeatly,\n    // so it should only be triggered when rendering indeed happend\n    // in zrender. (Consider the case that dipatchAction is keep\n    // triggering when mouse move).\n\n    if ( // Although zr is dirty if initial animation is not finished\n    // and this checking is called on frame, we also check\n    // animation finished for robustness.\n    zr.animation.isFinished() && !ecIns[OPTION_UPDATED] && !ecIns._scheduler.unfinished && !ecIns._pendingActions.length) {\n      ecIns.trigger('finished');\n    }\n  });\n}\n/**\n * @param {Object} params\n * @param {number} params.seriesIndex\n * @param {Array|TypedArray} params.data\n */\n\n\nechartsProto.appendData = function (params) {\n  if (this._disposed) {\n    disposedWarning(this.id);\n    return;\n  }\n\n  var seriesIndex = params.seriesIndex;\n  var ecModel = this.getModel();\n  var seriesModel = ecModel.getSeriesByIndex(seriesIndex);\n  seriesModel.appendData(params); // Note: `appendData` does not support that update extent of coordinate\n  // system, util some scenario require that. In the expected usage of\n  // `appendData`, the initial extent of coordinate system should better\n  // be fixed by axis `min`/`max` setting or initial data, otherwise if\n  // the extent changed while `appendData`, the location of the painted\n  // graphic elements have to be changed, which make the usage of\n  // `appendData` meaningless.\n\n  this._scheduler.unfinished = true;\n};\n/**\n * Register event\n * @method\n */\n\n\nechartsProto.on = createRegisterEventWithLowercaseName('on', false);\nechartsProto.off = createRegisterEventWithLowercaseName('off', false);\nechartsProto.one = createRegisterEventWithLowercaseName('one', false);\n/**\n * Prepare view instances of charts and components\n * @param  {module:echarts/model/Global} ecModel\n * @private\n */\n\nfunction prepareView(ecIns, type, ecModel, scheduler) {\n  var isComponent = type === 'component';\n  var viewList = isComponent ? ecIns._componentsViews : ecIns._chartsViews;\n  var viewMap = isComponent ? ecIns._componentsMap : ecIns._chartsMap;\n  var zr = ecIns._zr;\n  var api = ecIns._api;\n\n  for (var i = 0; i < viewList.length; i++) {\n    viewList[i].__alive = false;\n  }\n\n  isComponent ? ecModel.eachComponent(function (componentType, model) {\n    componentType !== 'series' && doPrepare(model);\n  }) : ecModel.eachSeries(doPrepare);\n\n  function doPrepare(model) {\n    // Consider: id same and type changed.\n    var viewId = '_ec_' + model.id + '_' + model.type;\n    var view = viewMap[viewId];\n\n    if (!view) {\n      var classType = parseClassType(model.type);\n      var Clazz = isComponent ? ComponentView.getClass(classType.main, classType.sub) : ChartView.getClass(classType.sub);\n      view = new Clazz();\n      view.init(ecModel, api);\n      viewMap[viewId] = view;\n      viewList.push(view);\n      zr.add(view.group);\n    }\n\n    model.__viewId = view.__id = viewId;\n    view.__alive = true;\n    view.__model = model;\n    view.group.__ecComponentInfo = {\n      mainType: model.mainType,\n      index: model.componentIndex\n    };\n    !isComponent && scheduler.prepareView(view, model, ecModel, api);\n  }\n\n  for (var i = 0; i < viewList.length;) {\n    var view = viewList[i];\n\n    if (!view.__alive) {\n      !isComponent && view.renderTask.dispose();\n      zr.remove(view.group);\n      view.dispose(ecModel, api);\n      viewList.splice(i, 1);\n      delete viewMap[view.__id];\n      view.__id = view.group.__ecComponentInfo = null;\n    } else {\n      i++;\n    }\n  }\n} // /**\n//  * Encode visual infomation from data after data processing\n//  *\n//  * @param {module:echarts/model/Global} ecModel\n//  * @param {object} layout\n//  * @param {boolean} [layoutFilter] `true`: only layout,\n//  *                                 `false`: only not layout,\n//  *                                 `null`/`undefined`: all.\n//  * @param {string} taskBaseTag\n//  * @private\n//  */\n// function startVisualEncoding(ecIns, ecModel, api, payload, layoutFilter) {\n//     each(visualFuncs, function (visual, index) {\n//         var isLayout = visual.isLayout;\n//         if (layoutFilter == null\n//             || (layoutFilter === false && !isLayout)\n//             || (layoutFilter === true && isLayout)\n//         ) {\n//             visual.func(ecModel, api, payload);\n//         }\n//     });\n// }\n\n\nfunction clearColorPalette(ecModel) {\n  ecModel.clearColorPalette();\n  ecModel.eachSeries(function (seriesModel) {\n    seriesModel.clearColorPalette();\n  });\n}\n\nfunction render(ecIns, ecModel, api, payload) {\n  renderComponents(ecIns, ecModel, api, payload);\n  each(ecIns._chartsViews, function (chart) {\n    chart.__alive = false;\n  });\n  renderSeries(ecIns, ecModel, api, payload); // Remove groups of unrendered charts\n\n  each(ecIns._chartsViews, function (chart) {\n    if (!chart.__alive) {\n      chart.remove(ecModel, api);\n    }\n  });\n}\n\nfunction renderComponents(ecIns, ecModel, api, payload, dirtyList) {\n  each(dirtyList || ecIns._componentsViews, function (componentView) {\n    var componentModel = componentView.__model;\n    componentView.render(componentModel, ecModel, api, payload);\n    updateZ(componentModel, componentView);\n  });\n}\n/**\n * Render each chart and component\n * @private\n */\n\n\nfunction renderSeries(ecIns, ecModel, api, payload, dirtyMap) {\n  // Render all charts\n  var scheduler = ecIns._scheduler;\n  var unfinished;\n  ecModel.eachSeries(function (seriesModel) {\n    var chartView = ecIns._chartsMap[seriesModel.__viewId];\n    chartView.__alive = true;\n    var renderTask = chartView.renderTask;\n    scheduler.updatePayload(renderTask, payload);\n\n    if (dirtyMap && dirtyMap.get(seriesModel.uid)) {\n      renderTask.dirty();\n    }\n\n    unfinished |= renderTask.perform(scheduler.getPerformArgs(renderTask));\n    chartView.group.silent = !!seriesModel.get('silent');\n    updateZ(seriesModel, chartView);\n    updateBlend(seriesModel, chartView);\n  });\n  scheduler.unfinished |= unfinished; // If use hover layer\n\n  updateHoverLayerStatus(ecIns, ecModel); // Add aria\n\n  aria(ecIns._zr.dom, ecModel);\n}\n\nfunction performPostUpdateFuncs(ecModel, api) {\n  each(postUpdateFuncs, function (func) {\n    func(ecModel, api);\n  });\n}\n\nvar MOUSE_EVENT_NAMES = ['click', 'dblclick', 'mouseover', 'mouseout', 'mousemove', 'mousedown', 'mouseup', 'globalout', 'contextmenu'];\n/**\n * @private\n */\n\nechartsProto._initEvents = function () {\n  each(MOUSE_EVENT_NAMES, function (eveName) {\n    var handler = function (e) {\n      var ecModel = this.getModel();\n      var el = e.target;\n      var params;\n      var isGlobalOut = eveName === 'globalout'; // no e.target when 'globalout'.\n\n      if (isGlobalOut) {\n        params = {};\n      } else if (el && el.dataIndex != null) {\n        var dataModel = el.dataModel || ecModel.getSeriesByIndex(el.seriesIndex);\n        params = dataModel && dataModel.getDataParams(el.dataIndex, el.dataType, el) || {};\n      } // If element has custom eventData of components\n      else if (el && el.eventData) {\n          params = zrUtil.extend({}, el.eventData);\n        } // Contract: if params prepared in mouse event,\n      // these properties must be specified:\n      // {\n      //    componentType: string (component main type)\n      //    componentIndex: number\n      // }\n      // Otherwise event query can not work.\n\n\n      if (params) {\n        var componentType = params.componentType;\n        var componentIndex = params.componentIndex; // Special handling for historic reason: when trigger by\n        // markLine/markPoint/markArea, the componentType is\n        // 'markLine'/'markPoint'/'markArea', but we should better\n        // enable them to be queried by seriesIndex, since their\n        // option is set in each series.\n\n        if (componentType === 'markLine' || componentType === 'markPoint' || componentType === 'markArea') {\n          componentType = 'series';\n          componentIndex = params.seriesIndex;\n        }\n\n        var model = componentType && componentIndex != null && ecModel.getComponent(componentType, componentIndex);\n        var view = model && this[model.mainType === 'series' ? '_chartsMap' : '_componentsMap'][model.__viewId];\n        params.event = e;\n        params.type = eveName;\n        this._ecEventProcessor.eventInfo = {\n          targetEl: el,\n          packedEvent: params,\n          model: model,\n          view: view\n        };\n        this.trigger(eveName, params);\n      }\n    }; // Consider that some component (like tooltip, brush, ...)\n    // register zr event handler, but user event handler might\n    // do anything, such as call `setOption` or `dispatchAction`,\n    // which probably update any of the content and probably\n    // cause problem if it is called previous other inner handlers.\n\n\n    handler.zrEventfulCallAtLast = true;\n\n    this._zr.on(eveName, handler, this);\n  }, this);\n  each(eventActionMap, function (actionType, eventType) {\n    this._messageCenter.on(eventType, function (event) {\n      this.trigger(eventType, event);\n    }, this);\n  }, this);\n};\n/**\n * @return {boolean}\n */\n\n\nechartsProto.isDisposed = function () {\n  return this._disposed;\n};\n/**\n * Clear\n */\n\n\nechartsProto.clear = function () {\n  if (this._disposed) {\n    disposedWarning(this.id);\n    return;\n  }\n\n  this.setOption({\n    series: []\n  }, true);\n};\n/**\n * Dispose instance\n */\n\n\nechartsProto.dispose = function () {\n  if (this._disposed) {\n    disposedWarning(this.id);\n    return;\n  }\n\n  this._disposed = true;\n  modelUtil.setAttribute(this.getDom(), DOM_ATTRIBUTE_KEY, '');\n  var api = this._api;\n  var ecModel = this._model;\n  each(this._componentsViews, function (component) {\n    component.dispose(ecModel, api);\n  });\n  each(this._chartsViews, function (chart) {\n    chart.dispose(ecModel, api);\n  }); // Dispose after all views disposed\n\n  this._zr.dispose();\n\n  delete instances[this.id];\n};\n\nzrUtil.mixin(ECharts, Eventful);\n\nfunction disposedWarning(id) {}\n\nfunction updateHoverLayerStatus(ecIns, ecModel) {\n  var zr = ecIns._zr;\n  var storage = zr.storage;\n  var elCount = 0;\n  storage.traverse(function (el) {\n    elCount++;\n  });\n\n  if (elCount > ecModel.get('hoverLayerThreshold') && !env.node) {\n    ecModel.eachSeries(function (seriesModel) {\n      if (seriesModel.preventUsingHoverLayer) {\n        return;\n      }\n\n      var chartView = ecIns._chartsMap[seriesModel.__viewId];\n\n      if (chartView.__alive) {\n        chartView.group.traverse(function (el) {\n          // Don't switch back.\n          el.useHoverLayer = true;\n        });\n      }\n    });\n  }\n}\n/**\n * Update chart progressive and blend.\n * @param {module:echarts/model/Series|module:echarts/model/Component} model\n * @param {module:echarts/view/Component|module:echarts/view/Chart} view\n */\n\n\nfunction updateBlend(seriesModel, chartView) {\n  var blendMode = seriesModel.get('blendMode') || null;\n  chartView.group.traverse(function (el) {\n    // FIXME marker and other components\n    if (!el.isGroup) {\n      // Only set if blendMode is changed. In case element is incremental and don't wan't to rerender.\n      if (el.style.blend !== blendMode) {\n        el.setStyle('blend', blendMode);\n      }\n    }\n\n    if (el.eachPendingDisplayable) {\n      el.eachPendingDisplayable(function (displayable) {\n        displayable.setStyle('blend', blendMode);\n      });\n    }\n  });\n}\n/**\n * @param {module:echarts/model/Series|module:echarts/model/Component} model\n * @param {module:echarts/view/Component|module:echarts/view/Chart} view\n */\n\n\nfunction updateZ(model, view) {\n  var z = model.get('z');\n  var zlevel = model.get('zlevel'); // Set z and zlevel\n\n  view.group.traverse(function (el) {\n    if (el.type !== 'group') {\n      z != null && (el.z = z);\n      zlevel != null && (el.zlevel = zlevel);\n    }\n  });\n}\n\nfunction createExtensionAPI(ecInstance) {\n  var coordSysMgr = ecInstance._coordSysMgr;\n  return zrUtil.extend(new ExtensionAPI(ecInstance), {\n    // Inject methods\n    getCoordinateSystems: zrUtil.bind(coordSysMgr.getCoordinateSystems, coordSysMgr),\n    getComponentByElement: function (el) {\n      while (el) {\n        var modelInfo = el.__ecComponentInfo;\n\n        if (modelInfo != null) {\n          return ecInstance._model.getComponent(modelInfo.mainType, modelInfo.index);\n        }\n\n        el = el.parent;\n      }\n    }\n  });\n}\n/**\n * @class\n * Usage of query:\n * `chart.on('click', query, handler);`\n * The `query` can be:\n * + The component type query string, only `mainType` or `mainType.subType`,\n *   like: 'xAxis', 'series', 'xAxis.category' or 'series.line'.\n * + The component query object, like:\n *   `{seriesIndex: 2}`, `{seriesName: 'xx'}`, `{seriesId: 'some'}`,\n *   `{xAxisIndex: 2}`, `{xAxisName: 'xx'}`, `{xAxisId: 'some'}`.\n * + The data query object, like:\n *   `{dataIndex: 123}`, `{dataType: 'link'}`, `{name: 'some'}`.\n * + The other query object (cmponent customized query), like:\n *   `{element: 'some'}` (only available in custom series).\n *\n * Caveat: If a prop in the `query` object is `null/undefined`, it is the\n * same as there is no such prop in the `query` object.\n */\n\n\nfunction EventProcessor() {\n  // These info required: targetEl, packedEvent, model, view\n  this.eventInfo;\n}\n\nEventProcessor.prototype = {\n  constructor: EventProcessor,\n  normalizeQuery: function (query) {\n    var cptQuery = {};\n    var dataQuery = {};\n    var otherQuery = {}; // `query` is `mainType` or `mainType.subType` of component.\n\n    if (zrUtil.isString(query)) {\n      var condCptType = parseClassType(query); // `.main` and `.sub` may be ''.\n\n      cptQuery.mainType = condCptType.main || null;\n      cptQuery.subType = condCptType.sub || null;\n    } // `query` is an object, convert to {mainType, index, name, id}.\n    else {\n        // `xxxIndex`, `xxxName`, `xxxId`, `name`, `dataIndex`, `dataType` is reserved,\n        // can not be used in `compomentModel.filterForExposedEvent`.\n        var suffixes = ['Index', 'Name', 'Id'];\n        var dataKeys = {\n          name: 1,\n          dataIndex: 1,\n          dataType: 1\n        };\n        zrUtil.each(query, function (val, key) {\n          var reserved = false;\n\n          for (var i = 0; i < suffixes.length; i++) {\n            var propSuffix = suffixes[i];\n            var suffixPos = key.lastIndexOf(propSuffix);\n\n            if (suffixPos > 0 && suffixPos === key.length - propSuffix.length) {\n              var mainType = key.slice(0, suffixPos); // Consider `dataIndex`.\n\n              if (mainType !== 'data') {\n                cptQuery.mainType = mainType;\n                cptQuery[propSuffix.toLowerCase()] = val;\n                reserved = true;\n              }\n            }\n          }\n\n          if (dataKeys.hasOwnProperty(key)) {\n            dataQuery[key] = val;\n            reserved = true;\n          }\n\n          if (!reserved) {\n            otherQuery[key] = val;\n          }\n        });\n      }\n\n    return {\n      cptQuery: cptQuery,\n      dataQuery: dataQuery,\n      otherQuery: otherQuery\n    };\n  },\n  filter: function (eventType, query, args) {\n    // They should be assigned before each trigger call.\n    var eventInfo = this.eventInfo;\n\n    if (!eventInfo) {\n      return true;\n    }\n\n    var targetEl = eventInfo.targetEl;\n    var packedEvent = eventInfo.packedEvent;\n    var model = eventInfo.model;\n    var view = eventInfo.view; // For event like 'globalout'.\n\n    if (!model || !view) {\n      return true;\n    }\n\n    var cptQuery = query.cptQuery;\n    var dataQuery = query.dataQuery;\n    return check(cptQuery, model, 'mainType') && check(cptQuery, model, 'subType') && check(cptQuery, model, 'index', 'componentIndex') && check(cptQuery, model, 'name') && check(cptQuery, model, 'id') && check(dataQuery, packedEvent, 'name') && check(dataQuery, packedEvent, 'dataIndex') && check(dataQuery, packedEvent, 'dataType') && (!view.filterForExposedEvent || view.filterForExposedEvent(eventType, query.otherQuery, targetEl, packedEvent));\n\n    function check(query, host, prop, propOnHost) {\n      return query[prop] == null || host[propOnHost || prop] === query[prop];\n    }\n  },\n  afterTrigger: function () {\n    // Make sure the eventInfo wont be used in next trigger.\n    this.eventInfo = null;\n  }\n};\n/**\n * @type {Object} key: actionType.\n * @inner\n */\n\nvar actions = {};\n/**\n * Map eventType to actionType\n * @type {Object}\n */\n\nvar eventActionMap = {};\n/**\n * Data processor functions of each stage\n * @type {Array.<Object.<string, Function>>}\n * @inner\n */\n\nvar dataProcessorFuncs = [];\n/**\n * @type {Array.<Function>}\n * @inner\n */\n\nvar optionPreprocessorFuncs = [];\n/**\n * @type {Array.<Function>}\n * @inner\n */\n\nvar postUpdateFuncs = [];\n/**\n * Visual encoding functions of each stage\n * @type {Array.<Object.<string, Function>>}\n */\n\nvar visualFuncs = [];\n/**\n * Theme storage\n * @type {Object.<key, Object>}\n */\n\nvar themeStorage = {};\n/**\n * Loading effects\n */\n\nvar loadingEffects = {};\nvar instances = {};\nvar connectedGroups = {};\nvar idBase = new Date() - 0;\nvar groupIdBase = new Date() - 0;\nvar DOM_ATTRIBUTE_KEY = '_echarts_instance_';\n\nfunction enableConnect(chart) {\n  var STATUS_PENDING = 0;\n  var STATUS_UPDATING = 1;\n  var STATUS_UPDATED = 2;\n  var STATUS_KEY = '__connectUpdateStatus';\n\n  function updateConnectedChartsStatus(charts, status) {\n    for (var i = 0; i < charts.length; i++) {\n      var otherChart = charts[i];\n      otherChart[STATUS_KEY] = status;\n    }\n  }\n\n  each(eventActionMap, function (actionType, eventType) {\n    chart._messageCenter.on(eventType, function (event) {\n      if (connectedGroups[chart.group] && chart[STATUS_KEY] !== STATUS_PENDING) {\n        if (event && event.escapeConnect) {\n          return;\n        }\n\n        var action = chart.makeActionFromEvent(event);\n        var otherCharts = [];\n        each(instances, function (otherChart) {\n          if (otherChart !== chart && otherChart.group === chart.group) {\n            otherCharts.push(otherChart);\n          }\n        });\n        updateConnectedChartsStatus(otherCharts, STATUS_PENDING);\n        each(otherCharts, function (otherChart) {\n          if (otherChart[STATUS_KEY] !== STATUS_UPDATING) {\n            otherChart.dispatchAction(action);\n          }\n        });\n        updateConnectedChartsStatus(otherCharts, STATUS_UPDATED);\n      }\n    });\n  });\n}\n/**\n * @param {HTMLElement} dom\n * @param {Object} [theme]\n * @param {Object} opts\n * @param {number} [opts.devicePixelRatio] Use window.devicePixelRatio by default\n * @param {string} [opts.renderer] Can choose 'canvas' or 'svg' to render the chart.\n * @param {number} [opts.width] Use clientWidth of the input `dom` by default.\n *                              Can be 'auto' (the same as null/undefined)\n * @param {number} [opts.height] Use clientHeight of the input `dom` by default.\n *                               Can be 'auto' (the same as null/undefined)\n */\n\n\nfunction init(dom, theme, opts) {\n  var existInstance = getInstanceByDom(dom);\n\n  if (existInstance) {\n    return existInstance;\n  }\n\n  var chart = new ECharts(dom, theme, opts);\n  chart.id = 'ec_' + idBase++;\n  instances[chart.id] = chart;\n  modelUtil.setAttribute(dom, DOM_ATTRIBUTE_KEY, chart.id);\n  enableConnect(chart);\n  return chart;\n}\n/**\n * @return {string|Array.<module:echarts~ECharts>} groupId\n */\n\n\nfunction connect(groupId) {\n  // Is array of charts\n  if (zrUtil.isArray(groupId)) {\n    var charts = groupId;\n    groupId = null; // If any chart has group\n\n    each(charts, function (chart) {\n      if (chart.group != null) {\n        groupId = chart.group;\n      }\n    });\n    groupId = groupId || 'g_' + groupIdBase++;\n    each(charts, function (chart) {\n      chart.group = groupId;\n    });\n  }\n\n  connectedGroups[groupId] = true;\n  return groupId;\n}\n/**\n * @DEPRECATED\n * @return {string} groupId\n */\n\n\nfunction disConnect(groupId) {\n  connectedGroups[groupId] = false;\n}\n/**\n * @return {string} groupId\n */\n\n\nvar disconnect = disConnect;\n/**\n * Dispose a chart instance\n * @param  {module:echarts~ECharts|HTMLDomElement|string} chart\n */\n\nfunction dispose(chart) {\n  if (typeof chart === 'string') {\n    chart = instances[chart];\n  } else if (!(chart instanceof ECharts)) {\n    // Try to treat as dom\n    chart = getInstanceByDom(chart);\n  }\n\n  if (chart instanceof ECharts && !chart.isDisposed()) {\n    chart.dispose();\n  }\n}\n/**\n * @param  {HTMLElement} dom\n * @return {echarts~ECharts}\n */\n\n\nfunction getInstanceByDom(dom) {\n  return instances[modelUtil.getAttribute(dom, DOM_ATTRIBUTE_KEY)];\n}\n/**\n * @param {string} key\n * @return {echarts~ECharts}\n */\n\n\nfunction getInstanceById(key) {\n  return instances[key];\n}\n/**\n * Register theme\n */\n\n\nfunction registerTheme(name, theme) {\n  themeStorage[name] = theme;\n}\n/**\n * Register option preprocessor\n * @param {Function} preprocessorFunc\n */\n\n\nfunction registerPreprocessor(preprocessorFunc) {\n  optionPreprocessorFuncs.push(preprocessorFunc);\n}\n/**\n * @param {number} [priority=1000]\n * @param {Object|Function} processor\n */\n\n\nfunction registerProcessor(priority, processor) {\n  normalizeRegister(dataProcessorFuncs, priority, processor, PRIORITY_PROCESSOR_FILTER);\n}\n/**\n * Register postUpdater\n * @param {Function} postUpdateFunc\n */\n\n\nfunction registerPostUpdate(postUpdateFunc) {\n  postUpdateFuncs.push(postUpdateFunc);\n}\n/**\n * Usage:\n * registerAction('someAction', 'someEvent', function () { ... });\n * registerAction('someAction', function () { ... });\n * registerAction(\n *     {type: 'someAction', event: 'someEvent', update: 'updateView'},\n *     function () { ... }\n * );\n *\n * @param {(string|Object)} actionInfo\n * @param {string} actionInfo.type\n * @param {string} [actionInfo.event]\n * @param {string} [actionInfo.update]\n * @param {string} [eventName]\n * @param {Function} action\n */\n\n\nfunction registerAction(actionInfo, eventName, action) {\n  if (typeof eventName === 'function') {\n    action = eventName;\n    eventName = '';\n  }\n\n  var actionType = isObject(actionInfo) ? actionInfo.type : [actionInfo, actionInfo = {\n    event: eventName\n  }][0]; // Event name is all lowercase\n\n  actionInfo.event = (actionInfo.event || actionType).toLowerCase();\n  eventName = actionInfo.event; // Validate action type and event name.\n\n  assert(ACTION_REG.test(actionType) && ACTION_REG.test(eventName));\n\n  if (!actions[actionType]) {\n    actions[actionType] = {\n      action: action,\n      actionInfo: actionInfo\n    };\n  }\n\n  eventActionMap[eventName] = actionType;\n}\n/**\n * @param {string} type\n * @param {*} CoordinateSystem\n */\n\n\nfunction registerCoordinateSystem(type, CoordinateSystem) {\n  CoordinateSystemManager.register(type, CoordinateSystem);\n}\n/**\n * Get dimensions of specified coordinate system.\n * @param {string} type\n * @return {Array.<string|Object>}\n */\n\n\nfunction getCoordinateSystemDimensions(type) {\n  var coordSysCreator = CoordinateSystemManager.get(type);\n\n  if (coordSysCreator) {\n    return coordSysCreator.getDimensionsInfo ? coordSysCreator.getDimensionsInfo() : coordSysCreator.dimensions.slice();\n  }\n}\n/**\n * Layout is a special stage of visual encoding\n * Most visual encoding like color are common for different chart\n * But each chart has it's own layout algorithm\n *\n * @param {number} [priority=1000]\n * @param {Function} layoutTask\n */\n\n\nfunction registerLayout(priority, layoutTask) {\n  normalizeRegister(visualFuncs, priority, layoutTask, PRIORITY_VISUAL_LAYOUT, 'layout');\n}\n/**\n * @param {number} [priority=3000]\n * @param {module:echarts/stream/Task} visualTask\n */\n\n\nfunction registerVisual(priority, visualTask) {\n  normalizeRegister(visualFuncs, priority, visualTask, PRIORITY_VISUAL_CHART, 'visual');\n}\n/**\n * @param {Object|Function} fn: {seriesType, createOnAllSeries, performRawSeries, reset}\n */\n\n\nfunction normalizeRegister(targetList, priority, fn, defaultPriority, visualType) {\n  if (isFunction(priority) || isObject(priority)) {\n    fn = priority;\n    priority = defaultPriority;\n  }\n\n  var stageHandler = Scheduler.wrapStageHandler(fn, visualType);\n  stageHandler.__prio = priority;\n  stageHandler.__raw = fn;\n  targetList.push(stageHandler);\n  return stageHandler;\n}\n/**\n * @param {string} name\n */\n\n\nfunction registerLoading(name, loadingFx) {\n  loadingEffects[name] = loadingFx;\n}\n/**\n * @param {Object} opts\n * @param {string} [superClass]\n */\n\n\nfunction extendComponentModel(opts\n/*, superClass*/\n) {\n  // var Clazz = ComponentModel;\n  // if (superClass) {\n  //     var classType = parseClassType(superClass);\n  //     Clazz = ComponentModel.getClass(classType.main, classType.sub, true);\n  // }\n  return ComponentModel.extend(opts);\n}\n/**\n * @param {Object} opts\n * @param {string} [superClass]\n */\n\n\nfunction extendComponentView(opts\n/*, superClass*/\n) {\n  // var Clazz = ComponentView;\n  // if (superClass) {\n  //     var classType = parseClassType(superClass);\n  //     Clazz = ComponentView.getClass(classType.main, classType.sub, true);\n  // }\n  return ComponentView.extend(opts);\n}\n/**\n * @param {Object} opts\n * @param {string} [superClass]\n */\n\n\nfunction extendSeriesModel(opts\n/*, superClass*/\n) {\n  // var Clazz = SeriesModel;\n  // if (superClass) {\n  //     superClass = 'series.' + superClass.replace('series.', '');\n  //     var classType = parseClassType(superClass);\n  //     Clazz = ComponentModel.getClass(classType.main, classType.sub, true);\n  // }\n  return SeriesModel.extend(opts);\n}\n/**\n * @param {Object} opts\n * @param {string} [superClass]\n */\n\n\nfunction extendChartView(opts\n/*, superClass*/\n) {\n  // var Clazz = ChartView;\n  // if (superClass) {\n  //     superClass = superClass.replace('series.', '');\n  //     var classType = parseClassType(superClass);\n  //     Clazz = ChartView.getClass(classType.main, true);\n  // }\n  return ChartView.extend(opts);\n}\n/**\n * ZRender need a canvas context to do measureText.\n * But in node environment canvas may be created by node-canvas.\n * So we need to specify how to create a canvas instead of using document.createElement('canvas')\n *\n * Be careful of using it in the browser.\n *\n * @param {Function} creator\n * @example\n *     var Canvas = require('canvas');\n *     var echarts = require('echarts');\n *     echarts.setCanvasCreator(function () {\n *         // Small size is enough.\n *         return new Canvas(32, 32);\n *     });\n */\n\n\nfunction setCanvasCreator(creator) {\n  zrUtil.$override('createCanvas', creator);\n}\n/**\n * @param {string} mapName\n * @param {Array.<Object>|Object|string} geoJson\n * @param {Object} [specialAreas]\n *\n * @example GeoJSON\n *     $.get('USA.json', function (geoJson) {\n *         echarts.registerMap('USA', geoJson);\n *         // Or\n *         echarts.registerMap('USA', {\n *             geoJson: geoJson,\n *             specialAreas: {}\n *         })\n *     });\n *\n *     $.get('airport.svg', function (svg) {\n *         echarts.registerMap('airport', {\n *             svg: svg\n *         }\n *     });\n *\n *     echarts.registerMap('eu', [\n *         {svg: eu-topographic.svg},\n *         {geoJSON: eu.json}\n *     ])\n */\n\n\nfunction registerMap(mapName, geoJson, specialAreas) {\n  mapDataStorage.registerMap(mapName, geoJson, specialAreas);\n}\n/**\n * @param {string} mapName\n * @return {Object}\n */\n\n\nfunction getMap(mapName) {\n  // For backward compatibility, only return the first one.\n  var records = mapDataStorage.retrieveMap(mapName);\n  return records && records[0] && {\n    geoJson: records[0].geoJSON,\n    specialAreas: records[0].specialAreas\n  };\n}\n\nregisterVisual(PRIORITY_VISUAL_GLOBAL, seriesColor);\nregisterPreprocessor(backwardCompat);\nregisterProcessor(PRIORITY_PROCESSOR_DATASTACK, dataStack);\nregisterLoading('default', loadingDefault); // Default actions\n\nregisterAction({\n  type: 'highlight',\n  event: 'highlight',\n  update: 'highlight'\n}, zrUtil.noop);\nregisterAction({\n  type: 'downplay',\n  event: 'downplay',\n  update: 'downplay'\n}, zrUtil.noop); // Default theme\n\nregisterTheme('light', lightTheme);\nregisterTheme('dark', darkTheme); // For backward compatibility, where the namespace `dataTool` will\n// be mounted on `echarts` is the extension `dataTool` is imported.\n\nvar dataTool = {};\nexports.version = version;\nexports.dependencies = dependencies;\nexports.PRIORITY = PRIORITY;\nexports.init = init;\nexports.connect = connect;\nexports.disConnect = disConnect;\nexports.disconnect = disconnect;\nexports.dispose = dispose;\nexports.getInstanceByDom = getInstanceByDom;\nexports.getInstanceById = getInstanceById;\nexports.registerTheme = registerTheme;\nexports.registerPreprocessor = registerPreprocessor;\nexports.registerProcessor = registerProcessor;\nexports.registerPostUpdate = registerPostUpdate;\nexports.registerAction = registerAction;\nexports.registerCoordinateSystem = registerCoordinateSystem;\nexports.getCoordinateSystemDimensions = getCoordinateSystemDimensions;\nexports.registerLayout = registerLayout;\nexports.registerVisual = registerVisual;\nexports.registerLoading = registerLoading;\nexports.extendComponentModel = extendComponentModel;\nexports.extendComponentView = extendComponentView;\nexports.extendSeriesModel = extendSeriesModel;\nexports.extendChartView = extendChartView;\nexports.setCanvasCreator = setCanvasCreator;\nexports.registerMap = registerMap;\nexports.getMap = getMap;\nexports.dataTool = dataTool;\nvar ___ec_export = require(\"./export\");\n(function () {\n    for (var key in ___ec_export) {\n        if (___ec_export.hasOwnProperty(key)) {\n            exports[key] = ___ec_export[key];\n        }\n    }\n})();"]}]}